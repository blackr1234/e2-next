<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="/e2-next/blog/2024-03/spring-boot-micrometer-tracing/kibana-search-logs-with-traceId.png"/><link rel="stylesheet" href="/e2-next/_next/static/css/e7797664af107298.css" data-precedence="next"/><link rel="stylesheet" href="/e2-next/_next/static/css/d3df112486f97f47.css" data-precedence="next"/><link rel="stylesheet" href="/e2-next/_next/static/css/666038510c08556c.css" data-precedence="next"/><link rel="stylesheet" href="/e2-next/_next/static/css/c388c53a0b0c1807.css" data-precedence="next"/><link rel="stylesheet" href="/e2-next/_next/static/css/f4caa29e750fdc73.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/e2-next/_next/static/chunks/webpack-2a34f9abe90e8c80.js"/><script src="/e2-next/_next/static/chunks/4bd1b696-0937feffdffed3be.js" async=""></script><script src="/e2-next/_next/static/chunks/1517-d97f3428bfe40563.js" async=""></script><script src="/e2-next/_next/static/chunks/main-app-05c45cc8f30d6cea.js" async=""></script><script src="/e2-next/_next/static/chunks/9967-83c48e6c14f3f0b6.js" async=""></script><script src="/e2-next/_next/static/chunks/app/layout-013b886b5a2b69dd.js" async=""></script><script src="/e2-next/_next/static/chunks/app/page-709d1dcf2418e267.js" async=""></script><script src="/e2-next/_next/static/chunks/13b76428-e7d338032a603c0d.js" async=""></script><script src="/e2-next/_next/static/chunks/5359-de44857e204496a3.js" async=""></script><script src="/e2-next/_next/static/chunks/app/blog/(blogPosts)/layout-8d294fce928e4e37.js" async=""></script><title>Michael Chung&#x27;s e-Portfolio</title><meta name="description" content="Powered by Next.js and React"/><link rel="icon" href="/e2-next/favicon.ico" type="image/x-icon" sizes="48x48"/><link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&amp;display=swap" rel="stylesheet"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"/><script src="/e2-next/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><div class="vstack gap-5"><div class="text-center vstack gap-5"><div><code class="SiteHeader_name__cwQmL">Chung Cheuk Hang Michael</code><code class="SiteHeader_title__CCfvI">Java Web Developer</code></div><nav class="justify-content-center navbar navbar-expand-md navbar-dark"><button type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="justify-content-center navbar-collapse collapse"><div class="justify-content-center navbar-nav nav-underline"><div class="nav-item"><a href="/e2-next/" draggable="false" data-rr-ui-event-key="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/e2-next/work" draggable="false" data-rr-ui-event-key="/work" class="nav-link">Work</a></div><div class="nav-item"><a href="/e2-next/hobbyProjects" draggable="false" data-rr-ui-event-key="/hobbyProjects" class="nav-link">Hobby projects</a></div><div class="nav-item"><a href="/e2-next/personality" draggable="false" data-rr-ui-event-key="/personality" class="nav-link">Personality</a></div><div class="nav-item"><a href="/e2-next/blog" draggable="false" data-rr-ui-event-key="/blog" class="nav-link">Blog</a></div></div></div></nav></div><div class="vstack gap-5"><div class="justify-content-center row"><h1 class="text-center" style="margin-bottom:1rem"><strong>Spring Boot 3 micrometer tracing</strong></h1></div><div class="justify-content-center row"><img loading="lazy" src="/e2-next/blog/2024-03/spring-boot-micrometer-tracing/thumbnail.svg?v=202412" class="object-fit-contain layout_image__iOEk8"/></div><div class="row"><div style="word-wrap:break-word"><h1 id="1-spring-boot-3-既-micrometer-tracing" class="mdx-components_heading__HrNl3" style="z-index:1000000">1 Spring Boot 3 既 micrometer tracing</h1>
<div class="mdx-components_paragraph__AUxxF">Spring Boot 3 既其中一個比較大既改變，就係唔再支援 Spring Boot Sleuth（又或者話 Spring Boot Sleuth 唔支援 Spring Boot 3）。</div>
<div class="mdx-components_paragraph__AUxxF">根據 <span><a href="https://docs.spring.io/spring-cloud-sleuth/docs/current/reference/html/" target="_blank" rel="external nofollow noopener noreferrer" class="mdx-components_anchor__j2fDs">Spring Cloud Sleuth 官方文檔</a></span>：</div>
<blockquote>
<div class="mdx-components_paragraph__AUxxF">!!!! IMPORTANT !!!!</div>
<div class="mdx-components_paragraph__AUxxF">Spring Cloud Sleuth’s last minor version is 3.1. You can check the 3.1.x branch for the latest commits.
Spring Cloud Sleuth will not work with Spring Boot 3.x onward. The last major version of Spring Boot that Sleuth will support is 2.x.</div>
<div class="mdx-components_paragraph__AUxxF">The core of this project got moved to <span><a href="https://micrometer.io/docs/tracing" target="_blank" rel="external nofollow noopener noreferrer" class="mdx-components_anchor__j2fDs">Micrometer Tracing</a></span> project and the instrumentations will be moved to <span><a href="https://micrometer.io/" target="_blank" rel="external nofollow noopener noreferrer" class="mdx-components_anchor__j2fDs">Micrometer</a></span> and all respective projects (no longer all instrumentations will be done in a single repository.</div>
<div class="mdx-components_paragraph__AUxxF">You can check the <span><a href="https://github.com/micrometer-metrics/tracing/wiki/Spring-Cloud-Sleuth-3.1-Migration-Guide" target="_blank" rel="external nofollow noopener noreferrer" class="mdx-components_anchor__j2fDs">Micrometer Tracing migration guide</a></span> to learn how to migrate from Spring Cloud Sleuth to Micrometer Tracing.</div>
</blockquote>
<div class="mdx-components_paragraph__AUxxF">即係話，如果我地想繼續喺 HTTP requests 度加入 trace ID、span ID，我地要改用 micrometer tracing。</div>
<hr class="mdx-components_hr__o_oFr"/>
<h1 id="2-定義" class="mdx-components_heading__HrNl3" style="z-index:2000000">2 定義</h1>
<div class="mdx-components_paragraph__AUxxF">喺 distributed tracing 裡面，我地有 trace ID、span ID 呢兩個 terms。</div>
<h2 id="21-trace-id" class="mdx-components_heading__HrNl3" style="z-index:2010000">2.1 Trace ID</h2>
<div class="mdx-components_paragraph__AUxxF">Trace ID 代表緊一個 distributed 既 request workflow，而呢個 request 會訪問好幾個 back-end microservices。利用同一個 trace ID 可以幫我地串連呢啲 back-end microservices，方便我地將同一個 request 既所有 microservices 既所有 application logs 搵出黎 troubleshoot 或者 debug。</div>
<div class="mdx-components_paragraph__AUxxF">進入一個新既 request workflow 既第一個 microservice 會負責生成 trace ID，然後當佢 send HTTP request 去佢既 downstream microservice 既時候，佢會喺個 HTTP request 加入一個 <code class="undefined mdx-components_normal-code__lOvs9">traceparent</code> request header，而個 header value 既格式應該要符合 W3C 既 Trace Context 標準。</div>
<hr class="mdx-components_hr__o_oFr"/>
<h2 id="22-span-id" class="mdx-components_heading__HrNl3" style="z-index:2020000">2.2 Span ID</h2>
<div class="mdx-components_paragraph__AUxxF">Span ID 代表緊一個 request workflow 裡面既其中一小個 operation，係某一個 microservice 既某一個 operation unit。</div>
<hr class="mdx-components_hr__o_oFr"/>
<h1 id="3-動手寫" class="mdx-components_heading__HrNl3" style="z-index:3000000">3 動手寫</h1>
<h2 id="31-maven-dependencies" class="mdx-components_heading__HrNl3" style="z-index:3010000">3.1 Maven dependencies</h2>
<div class="mdx-components_paragraph__AUxxF">所有 microservices 都要有以下既 Maven dependencies：</div>
<pre><div class="mdx-components_code__3gNm1" style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-xml" style="white-space:pre;color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">parent</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>	</span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">groupId</span><span class="token" style="color:#999">&gt;</span><span>org.springframework.boot</span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">groupId</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>	</span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">artifactId</span><span class="token" style="color:#999">&gt;</span><span>spring-boot-starter-parent</span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">artifactId</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>	</span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">version</span><span class="token" style="color:#999">&gt;</span><span>3.2.3</span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">version</span><span class="token" style="color:#999">&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">parent</span><span class="token" style="color:#999">&gt;</span><span>
</span>
<span></span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">dependency</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>	</span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">groupId</span><span class="token" style="color:#999">&gt;</span><span>io.micrometer</span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">groupId</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>	</span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">artifactId</span><span class="token" style="color:#999">&gt;</span><span>micrometer-registry-prometheus</span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">artifactId</span><span class="token" style="color:#999">&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">dependency</span><span class="token" style="color:#999">&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">dependency</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>	</span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">groupId</span><span class="token" style="color:#999">&gt;</span><span>io.micrometer</span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">groupId</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>	</span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">artifactId</span><span class="token" style="color:#999">&gt;</span><span>micrometer-tracing-bridge-brave</span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">artifactId</span><span class="token" style="color:#999">&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">dependency</span><span class="token" style="color:#999">&gt;</span><span>
</span>
<span></span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">dependency</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>	</span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">groupId</span><span class="token" style="color:#999">&gt;</span><span>net.logstash.logback</span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">groupId</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>	</span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">artifactId</span><span class="token" style="color:#999">&gt;</span><span>logstash-logback-encoder</span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">artifactId</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>	</span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">version</span><span class="token" style="color:#999">&gt;</span><span>7.2</span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">version</span><span class="token" style="color:#999">&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">dependency</span><span class="token" style="color:#999">&gt;</span></code></div></pre>
<div class="mdx-components_paragraph__AUxxF">如果需要用 <code class="undefined mdx-components_normal-code__lOvs9">WebClient</code> 去 call downstream microservice 既話就加：</div>
<pre><div class="mdx-components_code__3gNm1" style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-xml" style="white-space:pre;color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">dependency</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>	</span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">groupId</span><span class="token" style="color:#999">&gt;</span><span>org.springframework</span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">groupId</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>	</span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">artifactId</span><span class="token" style="color:#999">&gt;</span><span>spring-webflux</span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">artifactId</span><span class="token" style="color:#999">&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">dependency</span><span class="token" style="color:#999">&gt;</span></code></div></pre>
<div class="mdx-components_paragraph__AUxxF">如果需要用 OpenFeign 去 call downstream microservice 既話就加：</div>
<pre><div class="mdx-components_code__3gNm1" style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-xml" style="white-space:pre;color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">dependency</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>	</span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">groupId</span><span class="token" style="color:#999">&gt;</span><span>org.springframework.cloud</span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">groupId</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>	</span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">artifactId</span><span class="token" style="color:#999">&gt;</span><span>spring-cloud-starter-openfeign</span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">artifactId</span><span class="token" style="color:#999">&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">dependency</span><span class="token" style="color:#999">&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">dependency</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>	</span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">groupId</span><span class="token" style="color:#999">&gt;</span><span>io.github.openfeign</span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">groupId</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>	</span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">artifactId</span><span class="token" style="color:#999">&gt;</span><span>feign-micrometer</span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">artifactId</span><span class="token" style="color:#999">&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">dependency</span><span class="token" style="color:#999">&gt;</span></code></div></pre>
<hr class="mdx-components_hr__o_oFr"/>
<h2 id="32-寫-java-code" class="mdx-components_heading__HrNl3" style="z-index:3020000">3.2 寫 Java code</h2>
<h3 id="321-spring-resttemplate" class="mdx-components_heading__HrNl3" style="z-index:3020100">3.2.1 Spring <code class="undefined mdx-components_normal-code__lOvs9">RestTemplate</code></h3>
<div class="mdx-components_paragraph__AUxxF">如果要令到 <code class="undefined mdx-components_normal-code__lOvs9">RestTemplate</code> 識得喺 request header 度 forward micrometer tracing 既 data 去 downstream microservice 度，就要用 <code class="undefined mdx-components_normal-code__lOvs9">RestTemplateBuilder</code> bean 去創建 <code class="undefined mdx-components_normal-code__lOvs9">RestTemplate</code>：</div>
<pre><div class="mdx-components_code__3gNm1" style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="white-space:pre;color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token annotation" style="color:#999">@Configuration</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">RestTemplateConfig</span><span> </span><span class="token" style="color:#999">{</span><span>
</span>
<span>    </span><span class="token annotation" style="color:#999">@Bean</span><span>
</span><span>    </span><span class="token" style="color:#DD4A68">RestTemplate</span><span> </span><span class="token" style="color:#DD4A68">restTemplate</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">RestTemplateBuilder</span><span> builder</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span>
<span>        </span><span class="token" style="color:#07a">final</span><span> </span><span class="token" style="color:#DD4A68">RestTemplate</span><span> restTemplate </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> builder
</span><span>            </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">setConnectTimeout</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">Duration</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">ofSeconds</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">10</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span>
</span><span>            </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">basicAuthentication</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;username&quot;</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#690">&quot;password&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>            </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">defaultHeader</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;header1&quot;</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#690">&quot;header1-value&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>            </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">defaultHeader</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;header2&quot;</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#690">&quot;header2-value&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>            </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">build</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>
<span>        </span><span class="token" style="color:slategray">// 如果加入左 jackson-dataformat-xml</span><span>
</span><span>        </span><span class="token" style="color:slategray">// 令 RestTemplate 唔好喺 Accept request header 度加入 application/xml 或相關既 values</span><span>
</span><span>        restTemplate</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">getMessageConverters</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span>
</span><span>            </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">removeIf</span><span class="token" style="color:#999">(</span><span>e </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">-&gt;</span><span> e</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">getClass</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">==</span><span class="token" style="color:#DD4A68">MappingJackson2XmlHttpMessageConverter</span><span class="token" style="color:#999">.</span><span class="token" style="color:#07a">class</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>
<span>        </span><span class="token" style="color:#07a">return</span><span> restTemplate</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<hr class="mdx-components_hr__o_oFr"/>
<h3 id="322-spring-webflux-webclient" class="mdx-components_heading__HrNl3" style="z-index:3020200">3.2.2 Spring Webflux <code class="undefined mdx-components_normal-code__lOvs9">WebClient</code></h3>
<div class="mdx-components_paragraph__AUxxF">如果要令到 <code class="undefined mdx-components_normal-code__lOvs9">WebClient</code> 識得喺 request header 度 forward micrometer tracing 既 data 去 downstream microservice 度，就要用 <code class="undefined mdx-components_normal-code__lOvs9">WebClient.Builder</code> bean 去創建 <code class="undefined mdx-components_normal-code__lOvs9">WebClient</code>：</div>
<pre><div class="mdx-components_code__3gNm1" style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="white-space:pre;color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token annotation" style="color:#999">@Configuration</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">WebClientConfig</span><span> </span><span class="token" style="color:#999">{</span><span>
</span>
<span>    </span><span class="token annotation" style="color:#999">@Bean</span><span>
</span><span>    </span><span class="token" style="color:#DD4A68">WebClient</span><span> </span><span class="token" style="color:#DD4A68">webClient</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">WebClient</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">Builder</span><span> builder</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span>
<span>        </span><span class="token" style="color:#07a">final</span><span> </span><span class="token" style="color:#DD4A68">HttpClient</span><span> httpClient </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#DD4A68">HttpClient</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">newBuilder</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span>
</span><span>            </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">version</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">Version</span><span class="token" style="color:#999">.</span><span>HTTP_1_1</span><span class="token" style="color:#999">)</span><span>
</span><span>            </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">connectTimeout</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">Duration</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">ofSeconds</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">10</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span>
</span><span>            </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">build</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>
<span>        </span><span class="token" style="color:#07a">final</span><span> </span><span class="token" style="color:#DD4A68">WebClient</span><span> client </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> builder
</span><span>                </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">clientConnector</span><span class="token" style="color:#999">(</span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">JdkClientHttpConnector</span><span class="token" style="color:#999">(</span><span>httpClient</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span>
</span><span>                </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">defaultHeader</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">HttpHeaders</span><span class="token" style="color:#999">.</span><span>CONTENT_TYPE</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">MediaType</span><span class="token" style="color:#999">.</span><span>APPLICATION_JSON_VALUE</span><span class="token" style="color:#999">)</span><span>
</span><span>                </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">defaultHeader</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;header1&quot;</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#690">&quot;header1-value&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>                </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">defaultHeader</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;header2&quot;</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#690">&quot;header2-value&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>                </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">build</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>
<span>        </span><span class="token" style="color:#07a">return</span><span> client</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<hr class="mdx-components_hr__o_oFr"/>
<h3 id="323-spring-61-restclient" class="mdx-components_heading__HrNl3" style="z-index:3020300">3.2.3 Spring 6.1 <code class="undefined mdx-components_normal-code__lOvs9">RestClient</code></h3>
<div class="mdx-components_paragraph__AUxxF">如果要令到 <code class="undefined mdx-components_normal-code__lOvs9">RestClient</code> 識得喺 request header 度 forward micrometer tracing 既 data 去 downstream microservice 度，就要用 <code class="undefined mdx-components_normal-code__lOvs9">RestClient.Builder</code> bean 去創建 <code class="undefined mdx-components_normal-code__lOvs9">RestClient</code>：</div>
<pre><div class="mdx-components_code__3gNm1" style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="white-space:pre;color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token annotation" style="color:#999">@Configuration</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">RestClientConfig</span><span> </span><span class="token" style="color:#999">{</span><span>
</span>
<span>    </span><span class="token annotation" style="color:#999">@Bean</span><span>
</span><span>    </span><span class="token" style="color:#DD4A68">RestClient</span><span> </span><span class="token" style="color:#DD4A68">restClient</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">RestClient</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">Builder</span><span> builder</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span>
<span>        </span><span class="token" style="color:#07a">final</span><span> </span><span class="token" style="color:#DD4A68">RestClient</span><span> client </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> builder
</span><span>                </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">defaultHeader</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">HttpHeaders</span><span class="token" style="color:#999">.</span><span>CONTENT_TYPE</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">MediaType</span><span class="token" style="color:#999">.</span><span>APPLICATION_JSON_VALUE</span><span class="token" style="color:#999">)</span><span>
</span><span>                </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">defaultHeader</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;header1&quot;</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#690">&quot;header1-value&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>                </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">defaultHeader</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;header2&quot;</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#690">&quot;header2-value&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>                </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">build</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>
<span>        </span><span class="token" style="color:#07a">return</span><span> client</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<hr class="mdx-components_hr__o_oFr"/>
<h3 id="324-spring-cloud-openfeign" class="mdx-components_heading__HrNl3" style="z-index:3020400">3.2.4 Spring Cloud OpenFeign</h3>
<div class="mdx-components_paragraph__AUxxF">如果要令到 OpenFeign 識得喺 request header 度 forward micrometer tracing 既 data 去目標既 microservice 度，只需要喺 <code class="undefined mdx-components_normal-code__lOvs9">pom.xml</code> 加入 <code class="undefined mdx-components_normal-code__lOvs9">io.github.openfeign:feign-micrometer</code> 既 Maven dependency。</div>
<div class="mdx-components_paragraph__AUxxF">呢個 dependency 既版本由以下既 dependency management BOMs 控制。</div>
<ul class="mdx-components_list__QQ4ZN">
<li class="mdx-components_list-item__fJ1NL"><code class="undefined mdx-components_normal-code__lOvs9">org.springframework.cloud:spring-cloud-dependencies</code>
<ul class="mdx-components_list__QQ4ZN">
<li class="mdx-components_list-item__fJ1NL"><code class="undefined mdx-components_normal-code__lOvs9">org.springframework.cloud:spring-cloud-openfeign-dependencies</code>
<ul class="mdx-components_list__QQ4ZN">
<li class="mdx-components_list-item__fJ1NL"><code class="undefined mdx-components_normal-code__lOvs9">io.github.openfeign:feign-bom</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr class="mdx-components_hr__o_oFr"/>
<h2 id="33-logback-配置" class="mdx-components_heading__HrNl3" style="z-index:3030000">3.3 Logback 配置</h2>
<div class="mdx-components_paragraph__AUxxF">最後一步，我地需要喺 <code class="undefined mdx-components_normal-code__lOvs9">logback.xml</code> 裡面加入 trace ID 以及 span ID 既 MDC fields，咁喺 application logs 度就可以睇到佢地。</div>
<div class="mdx-components_paragraph__AUxxF">因為係 distributed microservices 既關係，我地如果用好似 ELK 咁既 centralized logging platform 既話，一定要可以分得到唔同既 microservices 既 logs，咁就要喺 <code class="undefined mdx-components_normal-code__lOvs9">logback.xml</code> 既 encoders 度配置好：</div>
<ul class="mdx-components_list__QQ4ZN">
<li class="mdx-components_list-item__fJ1NL">Host name，可以直接用 <code class="undefined mdx-components_normal-code__lOvs9">${HOSTNAME:-}</code> 或者 <code class="undefined mdx-components_normal-code__lOvs9">${hostname:-}</code>。</li>
<li class="mdx-components_list-item__fJ1NL">Spring application name，可以加入以下既配置，之後就可以用 <code class="undefined mdx-components_normal-code__lOvs9">${app_name:-}</code>：<!-- -->
<ul class="mdx-components_list__QQ4ZN">
<li class="mdx-components_list-item__fJ1NL">
<pre><div class="mdx-components_code__3gNm1" style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-xml" style="white-space:pre;color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:slategray">&lt;!-- 喺 configuration 裡面 --&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">springProperty</span><span class="token" style="color:#905"> </span><span class="token" style="color:#690">scope</span><span class="token attr-equals" style="color:#999">=</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#07a">context</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#905"> </span><span class="token" style="color:#690">name</span><span class="token attr-equals" style="color:#999">=</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#07a">app_name</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#905"> </span><span class="token" style="color:#690">source</span><span class="token attr-equals" style="color:#999">=</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#07a">spring.application.name</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#905"> </span><span class="token" style="color:#999">/&gt;</span></code></div></pre>
</li>
</ul>
</li>
</ul>
<div class="mdx-components_paragraph__AUxxF">詳情可以睇返呢篇：<span><a href="/e2-next/blog/spring-boot-elk-logging" class="mdx-components_anchor__j2fDs">Spring 項目使用 ELK 做 logging</a></span>。</div>
<h3 id="331-自定義-encoder-pattern" class="mdx-components_heading__HrNl3" style="z-index:3030100">3.3.1 自定義 encoder pattern</h3>
<div class="mdx-components_paragraph__AUxxF">如果要喺自定義既 encoder pattern 裡面加入 trace ID 以及 span ID，我地可以用：</div>
<ul class="mdx-components_list__QQ4ZN">
<li class="mdx-components_list-item__fJ1NL"><code class="undefined mdx-components_normal-code__lOvs9">%X{traceId:-}</code></li>
<li class="mdx-components_list-item__fJ1NL"><code class="undefined mdx-components_normal-code__lOvs9">%X{spanId:-}</code></li>
</ul>
<div class="mdx-components_paragraph__AUxxF">例子：</div>
<pre><div class="mdx-components_code__3gNm1" style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-xml" style="white-space:pre;color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:slategray">&lt;!-- 喺 appender 裡面 --&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">encoder</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>	</span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">pattern</span><span class="token" style="color:#999">&gt;</span><span>[${hostname:-} ${app_name:-}] [%X{traceId:-} %X{spanId:-}] %d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} (%file:%line\) - %msg%n</span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">pattern</span><span class="token" style="color:#999">&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">encoder</span><span class="token" style="color:#999">&gt;</span></code></div></pre>
<div class="mdx-components_paragraph__AUxxF">註：</div>
<ul class="mdx-components_list__QQ4ZN">
<li class="mdx-components_list-item__fJ1NL">呢度既 <code class="undefined mdx-components_normal-code__lOvs9">:-</code> 係用黎分隔 key、value 既字符，佢既前面係 MDC key，後面係 value。<!-- -->
<ul class="mdx-components_list__QQ4ZN">
<li class="mdx-components_list-item__fJ1NL">佢同 Spring 既 <code class="undefined mdx-components_normal-code__lOvs9">:</code> 一樣意思，只不過係 Logback 揀左用 <code class="undefined mdx-components_normal-code__lOvs9">:-</code>。</li>
<li class="mdx-components_list-item__fJ1NL"><code class="undefined mdx-components_normal-code__lOvs9">%X{key:-}</code> 既意思係如果 <code class="undefined mdx-components_normal-code__lOvs9">key</code> 呢個 MDC key 未有 data 既話就會出 empty string（唔好誤以為會出 <code class="undefined mdx-components_normal-code__lOvs9">-</code>）。</li>
<li class="mdx-components_list-item__fJ1NL"><code class="undefined mdx-components_normal-code__lOvs9">%X{key:-foo}</code> 既意思係如果 <code class="undefined mdx-components_normal-code__lOvs9">key</code> 呢個 MDC key 未有 data 既話就會出 <code class="undefined mdx-components_normal-code__lOvs9">foo</code>。</li>
</ul>
</li>
</ul>
<hr class="mdx-components_hr__o_oFr"/>
<h3 id="332-logstash-logback-encoder" class="mdx-components_heading__HrNl3" style="z-index:3030200">3.3.2 Logstash Logback Encoder</h3>
<div class="mdx-components_paragraph__AUxxF">如果係用 Logstash Logback Encoder，亦即係 <code class="undefined mdx-components_normal-code__lOvs9">net.logstash.logback:logstash-logback-encoder</code> 既 Maven dependency，咁我地就要用佢既 <code class="undefined mdx-components_normal-code__lOvs9">includeMdcKeyName</code> XML element 去加入 trace ID 以及 span ID：</div>
<pre><div class="mdx-components_code__3gNm1" style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-xml" style="white-space:pre;color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:slategray">&lt;!-- 喺 appender 裡面 --&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">encoder</span><span class="token" style="color:#905"> </span><span class="token" style="color:#690">class</span><span class="token attr-equals" style="color:#999">=</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#07a">net.logstash.logback.encoder.LogstashEncoder</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>	</span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">includeContext</span><span class="token" style="color:#999">&gt;</span><span>false</span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">includeContext</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>	</span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">includeMdcKeyName</span><span class="token" style="color:#999">&gt;</span><span>traceId</span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">includeMdcKeyName</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>	</span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">includeMdcKeyName</span><span class="token" style="color:#999">&gt;</span><span>spanId</span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">includeMdcKeyName</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>	</span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">customFields</span><span class="token" style="color:#999">&gt;</span><span>{ &quot;host&quot;: &quot;${hostname:-}&quot;, &quot;app_name&quot;: &quot;${app_name:-}&quot; }</span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">customFields</span><span class="token" style="color:#999">&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">encoder</span><span class="token" style="color:#999">&gt;</span></code></div></pre>
<div class="mdx-components_paragraph__AUxxF">加左之後，每一個 log entry 既 JSON data 裡面都會多左 <code class="undefined mdx-components_normal-code__lOvs9">traceId</code> 以及 <code class="undefined mdx-components_normal-code__lOvs9">spanId</code> 既 key-value pairs。</div>
<hr class="mdx-components_hr__o_oFr"/>
<h1 id="4-測試" class="mdx-components_heading__HrNl3" style="z-index:4000000">4 測試</h1>
<h2 id="41-本地測試" class="mdx-components_heading__HrNl3" style="z-index:4010000">4.1 本地測試</h2>
<ol class="mdx-components_list__QQ4ZN">
<li class="mdx-components_list-item__fJ1NL">我地需要 set up 至少兩個 Spring Boot microservices。</li>
<li class="mdx-components_list-item__fJ1NL">全部 microservices 都要 expose 至少一個 HTTP REST endpoints。</li>
<li class="mdx-components_list-item__fJ1NL">除左最後一個只會被 call 但唔會 initiate call 既 microservice，我地要為所有作為 upstream 既其他 microservices 寫 HTTP call 既 code。<!-- -->
<ul class="mdx-components_list__QQ4ZN">
<li class="mdx-components_list-item__fJ1NL">HTTP REST call flow：Service A ➜ Service B ➜ Service C 等等。</li>
<li class="mdx-components_list-item__fJ1NL">HTTP REST call 既 implementation 可以係 <code class="undefined mdx-components_normal-code__lOvs9">RestTemplate</code>、<code class="undefined mdx-components_normal-code__lOvs9">WebClient</code>、<code class="undefined mdx-components_normal-code__lOvs9">RestClient</code> 或者 OpenFeign。</li>
</ul>
</li>
<li class="mdx-components_list-item__fJ1NL">用 cURL call Service A 既 HTTP REST endpoint。</li>
<li class="mdx-components_list-item__fJ1NL">檢查所有 microservices 既 console logs。<!-- -->
<ul class="mdx-components_list__QQ4ZN">
<li class="mdx-components_list-item__fJ1NL">應該會見到只有一個 <code class="undefined mdx-components_normal-code__lOvs9">32</code> 個位長度 alphanumeric 既 trace ID。</li>
<li class="mdx-components_list-item__fJ1NL">應該會見到每個 microservice 都有啲唔同既 <code class="undefined mdx-components_normal-code__lOvs9">16</code> 個位長度 alphanumeric 既 span IDs。</li>
</ul>
</li>
<li class="mdx-components_list-item__fJ1NL">再用 cURL call Service A 既 HTTP REST endpoint。</li>
<li class="mdx-components_list-item__fJ1NL">再檢查所有 microservices 既 console logs。<!-- -->
<ul class="mdx-components_list__QQ4ZN">
<li class="mdx-components_list-item__fJ1NL">應該會見到一個完全唔同既 trace ID。</li>
<li class="mdx-components_list-item__fJ1NL">應該會見到每個 microservice 又有啲唔同既 span IDs。</li>
</ul>
</li>
</ol>
<hr class="mdx-components_hr__o_oFr"/>
<h2 id="42-測試發送-logs-去-elk" class="mdx-components_heading__HrNl3" style="z-index:4020000">4.2 測試發送 logs 去 ELK</h2>
<ol class="mdx-components_list__QQ4ZN">
<li class="mdx-components_list-item__fJ1NL">我地需要 set up 至少兩個 Spring Boot microservices。</li>
<li class="mdx-components_list-item__fJ1NL">我地要配置好全部 microservices 既 <code class="undefined mdx-components_normal-code__lOvs9">logback.xml</code>，將 <code class="undefined mdx-components_normal-code__lOvs9">&lt;appender&gt;</code> 既 <code class="undefined mdx-components_normal-code__lOvs9">&lt;destination&gt;</code> 配置為 <code class="undefined mdx-components_normal-code__lOvs9">127.0.0.1:5000</code>，咁啲 logs 就會發送到本地部署既 Logstash。</li>
<li class="mdx-components_list-item__fJ1NL">全部 microservices 都要 expose 至少一個 HTTP REST endpoints。</li>
<li class="mdx-components_list-item__fJ1NL">除左最後一個只會被 call 但唔會 initiate call 既 microservice，我地要為所有作為 upstream 既其他 microservices 寫 HTTP call 既 code。<!-- -->
<ul class="mdx-components_list__QQ4ZN">
<li class="mdx-components_list-item__fJ1NL">HTTP REST call flow：Service A ➜ Service B ➜ Service C 等等。</li>
<li class="mdx-components_list-item__fJ1NL">HTTP REST call 既 implementation 可以係 <code class="undefined mdx-components_normal-code__lOvs9">RestTemplate</code>、<code class="undefined mdx-components_normal-code__lOvs9">WebClient</code>、<code class="undefined mdx-components_normal-code__lOvs9">RestClient</code> 或者 OpenFeign。</li>
</ul>
</li>
<li class="mdx-components_list-item__fJ1NL">用 cURL call Service A 既 HTTP REST endpoint。</li>
<li class="mdx-components_list-item__fJ1NL">打開 <span><a href="http://localhost:5601" target="_blank" rel="external nofollow noopener noreferrer" class="mdx-components_anchor__j2fDs">http://localhost:5601</a></span> 檢查我地喺 Kibana 既 data view。<!-- -->
<ul class="mdx-components_list__QQ4ZN">
<li class="mdx-components_list-item__fJ1NL">應該會見到只有一個 <code class="undefined mdx-components_normal-code__lOvs9">32</code> 個位長度 alphanumeric 既 trace ID。</li>
<li class="mdx-components_list-item__fJ1NL">應該會見到每個 microservice 都有啲唔同既 <code class="undefined mdx-components_normal-code__lOvs9">16</code> 個位長度 alphanumeric 既 span IDs。</li>
</ul>
</li>
<li class="mdx-components_list-item__fJ1NL">再用 cURL call Service A 既 HTTP REST endpoint。</li>
<li class="mdx-components_list-item__fJ1NL">再打開 <span><a href="http://localhost:5601" target="_blank" rel="external nofollow noopener noreferrer" class="mdx-components_anchor__j2fDs">http://localhost:5601</a></span> 檢查我地喺 Kibana 既 data view。<!-- -->
<ul class="mdx-components_list__QQ4ZN">
<li class="mdx-components_list-item__fJ1NL">應該會見到一個完全唔同既 trace ID。</li>
<li class="mdx-components_list-item__fJ1NL">應該會見到每個 microservice 又有啲唔同既 span IDs。</li>
</ul>
</li>
<li class="mdx-components_list-item__fJ1NL">我地可以撳落 <code class="undefined mdx-components_normal-code__lOvs9">traceId</code> column 既某一個 cell value 隔籬既 <code class="undefined mdx-components_normal-code__lOvs9">⊕</code> 號（「Filter for this traceId」），咁就可以睇曬所有同呢個 trace ID 有關係既 logs。</li>
</ol>
<div class="mdx-components_paragraph__AUxxF"><img src="/e2-next/blog/2024-03/spring-boot-micrometer-tracing/kibana-search-logs-with-traceId.png" class="mdx-components_image__4jSiz"/></div>
<hr class="mdx-components_hr__o_oFr"/>
<h1 id="5-參考資料" class="mdx-components_heading__HrNl3" style="z-index:5000000">5 參考資料</h1>
<ul class="mdx-components_list__QQ4ZN">
<li class="mdx-components_list-item__fJ1NL"><span><a href="https://spring.io/blog/2022/10/12/observability-with-spring-boot-3" target="_blank" rel="external nofollow noopener noreferrer" class="mdx-components_anchor__j2fDs">Spring 官方 blog - Observability with Spring Boot 3</a></span></li>
<li class="mdx-components_list-item__fJ1NL"><span><a href="https://docs.spring.io/spring-framework/reference/integration/observability.html" target="_blank" rel="external nofollow noopener noreferrer" class="mdx-components_anchor__j2fDs">Spring 官方文檔 - Observability Support</a></span></li>
<li class="mdx-components_list-item__fJ1NL"><span><a href="https://github.com/logfellow/logstash-logback-encoder?tab=readme-ov-file#mdc-fields" target="_blank" rel="external nofollow noopener noreferrer" class="mdx-components_anchor__j2fDs">GitHub - logfellow/logstash-logback-encoder - Logstash Logback Encoder - MDC fields</a></span></li>
<li class="mdx-components_list-item__fJ1NL"><span><a href="https://opentelemetry.io/docs/concepts/signals/traces/" target="_blank" rel="external nofollow noopener noreferrer" class="mdx-components_anchor__j2fDs">OpenTelemetry - Traces</a></span></li>
<li class="mdx-components_list-item__fJ1NL"><span><a href="https://github.com/w3c/trace-context/blob/main/spec/20-http_request_header_format.md" target="_blank" rel="external nofollow noopener noreferrer" class="mdx-components_anchor__j2fDs">GitHub - w3c/trace-context - Trace Context HTTP Request Headers Format</a></span></li>
</ul></div></div></div><hr/><div class="vstack gap-3"><div class="text-center container"><div class="justify-content-center g-3 row row-cols-md-3 row-cols-sm-2 row-cols-1"><div class="col"><a href="tel:+85263301333" target="_blank" rel="external nofollow noopener noreferrer" class="SiteFooter_contact-item__2JRRr card"><div class="card-body"><div class="card-title h5"><i class="fa-solid fa-phone" style="color:#009688"></i></div><p class="text-muted card-text">6330 1333<!-- --> </p></div></a></div><div class="col"><a href="mailto:michaelboyboy@gmail.com" target="_blank" rel="external nofollow noopener noreferrer" class="SiteFooter_contact-item__2JRRr card"><div class="card-body"><div class="card-title h5"><i class="fa-solid fa-envelope" style="color:#f44336"></i></div><p class="text-muted card-text">michaelboyboy@gmail.com<!-- --> </p></div></a></div><div class="col"><a href="https://www.linkedin.com/in/mickchung" target="_blank" rel="external nofollow noopener noreferrer" class="SiteFooter_contact-item__2JRRr card"><div class="card-body"><div class="card-title h5"><i class="fa-brands fa-linkedin" style="color:#2196f3"></i></div><p class="text-muted card-text">www.linkedin.com/in/mickchung<!-- --> </p></div></a></div></div></div><div class="SiteFooter_misc__h36v0"><div>Copyright © <!-- -->2024<!-- --> Chung Cheuk Hang Michael. All rights reserved.</div></div></div></div><script src="/e2-next/_next/static/chunks/webpack-2a34f9abe90e8c80.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[8287,[\"9967\",\"static/chunks/9967-83c48e6c14f3f0b6.js\",\"7177\",\"static/chunks/app/layout-013b886b5a2b69dd.js\"],\"default\"]\n3:I[3339,[\"8974\",\"static/chunks/app/page-709d1dcf2418e267.js\"],\"default\"]\n4:I[1367,[\"9967\",\"static/chunks/9967-83c48e6c14f3f0b6.js\",\"7177\",\"static/chunks/app/layout-013b886b5a2b69dd.js\"],\"default\"]\n5:I[5244,[],\"\"]\n6:I[3866,[],\"\"]\n7:I[7868,[\"9967\",\"static/chunks/9967-83c48e6c14f3f0b6.js\",\"7177\",\"static/chunks/app/layout-013b886b5a2b69dd.js\"],\"default\"]\n8:I[4547,[],\"ClientSegmentRoot\"]\n9:I[5211,[\"586\",\"static/chunks/13b76428-e7d338032a603c0d.js\",\"5359\",\"static/chunks/5359-de44857e204496a3.js\",\"8329\",\"static/chunks/app/blog/(blogPosts)/layout-8d294fce928e4e37.js\"],\"default\"]\nb:I[6213,[],\"OutletBoundary\"]\nd:I[6213,[],\"MetadataBoundary\"]\nf:I[6213,[],\"ViewportBoundary\"]\n11:I[4835,[],\"\"]\n:HL[\"/e2-next/_next/static/css/e7797664af107298.css\",\"style\"]\n:HL[\"/e2-next/_next/static/css/d3df112486f97f47.css\",\"style\"]\n:HL[\"/e2-next/_next/static/css/666038510c08556c.css\",\"style\"]\n:HL[\"/e2-next/_next/static/css/c388c53a0b0c1807.css\",\"style\"]\n:HL[\"/e2-next/_next/static/css/f4caa29e750fdc73.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"47MFCChj4Cmkr0rFJOghq\",\"p\":\"/e2-next\",\"c\":[\"\",\"blog\",\"spring-boot-micrometer-tracing\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[\"(blogPosts)\",{\"children\":[\"(2024-03)\",{\"children\":[\"spring-boot-micrometer-tracing\",{\"children\":[\"__PAGE__\",{}]}]}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/e2-next/_next/static/css/e7797664af107298.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/e2-next/_next/static/css/d3df112486f97f47.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"2\",{\"rel\":\"stylesheet\",\"href\":\"/e2-next/_next/static/css/666038510c08556c.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"href\":\"https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900\u0026display=swap\",\"rel\":\"stylesheet\"}],[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css\"}]]}],[\"$\",\"body\",null,{\"children\":[\"$\",\"$L2\",null,{\"children\":[\"$\",\"$L3\",null,{\"gap\":5,\"children\":[[\"$\",\"$L3\",null,{\"gap\":5,\"className\":\"text-center\",\"children\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"code\",null,{\"className\":\"SiteHeader_name__cwQmL\",\"children\":\"Chung Cheuk Hang Michael\"}],[\"$\",\"code\",null,{\"className\":\"SiteHeader_title__CCfvI\",\"children\":\"Java Web Developer\"}]]}],[\"$\",\"$L4\",null,{}]]}],[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}],[\"$\",\"hr\",null,{}],[\"$\",\"$L7\",null,{}]]}]}]}]]}]]}],{\"children\":[\"blog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"(blogPosts)\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/e2-next/_next/static/css/c388c53a0b0c1807.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L8\",null,{\"Component\":\"$9\",\"slots\":{\"children\":[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"(blogPosts)\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]},\"params\":{},\"promise\":\"$@a\"}]]}],{\"children\":[\"(2024-03)\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"(blogPosts)\",\"children\",\"(2024-03)\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"spring-boot-micrometer-tracing\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"(blogPosts)\",\"children\",\"(2024-03)\",\"children\",\"spring-boot-micrometer-tracing\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"h1\",null,{\"id\":\"1-spring-boot-3-既-micrometer-tracing\",\"className\":\"mdx-components_heading__HrNl3\",\"style\":{\"zIndex\":1000000},\"children\":\"1 Spring Boot 3 既 micrometer tracing\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":\"Spring Boot 3 既其中一個比較大既改變，就係唔再支援 Spring Boot Sleuth（又或者話 Spring Boot Sleuth 唔支援 Spring Boot 3）。\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":[\"根據 \",[\"$\",\"span\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://docs.spring.io/spring-cloud-sleuth/docs/current/reference/html/\",\"target\":\"_blank\",\"rel\":\"external nofollow noopener noreferrer\",\"className\":\"mdx-components_anchor__j2fDs\",\"children\":\"Spring Cloud Sleuth 官方文檔\"}]}],\"：\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":\"!!!! IMPORTANT !!!!\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":\"Spring Cloud Sleuth’s last minor version is 3.1. You can check the 3.1.x branch for the latest commits.\\r\\nSpring Cloud Sleuth will not work with Spring Boot 3.x onward. The last major version of Spring Boot that Sleuth will support is 2.x.\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":[\"The core of this project got moved to \",[\"$\",\"span\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://micrometer.io/docs/tracing\",\"target\":\"_blank\",\"rel\":\"external nofollow noopener noreferrer\",\"className\":\"mdx-components_anchor__j2fDs\",\"children\":\"Micrometer Tracing\"}]}],\" project and the instrumentations will be moved to \",[\"$\",\"span\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://micrometer.io/\",\"target\":\"_blank\",\"rel\":\"external nofollow noopener noreferrer\",\"className\":\"mdx-components_anchor__j2fDs\",\"children\":\"Micrometer\"}]}],\" and all respective projects (no longer all instrumentations will be done in a single repository.\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":[\"You can check the \",[\"$\",\"span\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/micrometer-metrics/tracing/wiki/Spring-Cloud-Sleuth-3.1-Migration-Guide\",\"target\":\"_blank\",\"rel\":\"external nofollow noopener noreferrer\",\"className\":\"mdx-components_anchor__j2fDs\",\"children\":\"Micrometer Tracing migration guide\"}]}],\" to learn how to migrate from Spring Cloud Sleuth to Micrometer Tracing.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":\"即係話，如果我地想繼續喺 HTTP requests 度加入 trace ID、span ID，我地要改用 micrometer tracing。\"}],\"\\n\",[\"$\",\"hr\",null,{\"className\":\"mdx-components_hr__o_oFr\"}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"2-定義\",\"className\":\"mdx-components_heading__HrNl3\",\"style\":{\"zIndex\":2000000},\"children\":\"2 定義\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":\"喺 distributed tracing 裡面，我地有 trace ID、span ID 呢兩個 terms。\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"21-trace-id\",\"className\":\"mdx-components_heading__HrNl3\",\"style\":{\"zIndex\":2010000},\"children\":\"2.1 Trace ID\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":\"Trace ID 代表緊一個 distributed 既 request workflow，而呢個 request 會訪問好幾個 back-end microservices。利用同一個 trace ID 可以幫我地串連呢啲 back-end microservices，方便我地將同一個 request 既所有 microservices 既所有 application logs 搵出黎 troubleshoot 或者 debug。\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":[\"進入一個新既 request workflow 既第一個 microservice 會負責生成 trace ID，然後當佢 send HTTP request 去佢既 downstream microservice 既時候，佢會喺個 HTTP request 加入一個 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"traceparent\"}],\" request header，而個 header value 既格式應該要符合 W3C 既 Trace Context 標準。\"]}],\"\\n\",[\"$\",\"hr\",null,{\"className\":\"mdx-components_hr__o_oFr\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"22-span-id\",\"className\":\"mdx-components_heading__HrNl3\",\"style\":{\"zIndex\":2020000},\"children\":\"2.2 Span ID\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":\"Span ID 代表緊一個 request workflow 裡面既其中一小個 operation，係某一個 microservice 既某一個 operation unit。\"}],\"\\n\",[\"$\",\"hr\",null,{\"className\":\"mdx-components_hr__o_oFr\"}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"3-動手寫\",\"className\":\"mdx-components_heading__HrNl3\",\"style\":{\"zIndex\":3000000},\"children\":\"3 動手寫\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"31-maven-dependencies\",\"className\":\"mdx-components_heading__HrNl3\",\"style\":{\"zIndex\":3010000},\"children\":\"3.1 Maven dependencies\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":\"所有 microservices 都要有以下既 Maven dependencies：\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"mdx-components_code__3gNm1\",\"style\":{\"color\":\"black\",\"background\":\"#f5f2f0\",\"textShadow\":\"0 1px white\",\"fontFamily\":\"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace\",\"fontSize\":\"1em\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"wordWrap\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"4\",\"OTabSize\":\"4\",\"tabSize\":\"4\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\",\"padding\":\"1em\",\"margin\":\".5em 0\",\"overflow\":\"auto\"},\"children\":[\"$\",\"code\",null,{\"className\":\"language-xml\",\"style\":{\"whiteSpace\":\"pre\",\"color\":\"black\",\"background\":\"none\",\"textShadow\":\"0 1px white\",\"fontFamily\":\"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace\",\"fontSize\":\"1em\",\"textAlign\":\"left\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"wordWrap\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"4\",\"OTabSize\":\"4\",\"tabSize\":\"4\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\"},\"children\":[false,[[\"$\",\"span\",\"code-segement0\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement1\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"parent\"]}],[\"$\",\"span\",\"code-segement2\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement3\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement4\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\t\"]}],[\"$\",\"span\",\"code-segement5\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement6\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"groupId\"]}],[\"$\",\"span\",\"code-segement7\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement8\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"org.springframework.boot\"]}],[\"$\",\"span\",\"code-segement9\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement10\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"groupId\"]}],[\"$\",\"span\",\"code-segement11\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement12\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement13\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\t\"]}],[\"$\",\"span\",\"code-segement14\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement15\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"artifactId\"]}],[\"$\",\"span\",\"code-segement16\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement17\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"spring-boot-starter-parent\"]}],[\"$\",\"span\",\"code-segement18\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement19\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"artifactId\"]}],[\"$\",\"span\",\"code-segement20\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement21\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement22\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\t\"]}],[\"$\",\"span\",\"code-segement23\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement24\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"version\"]}],[\"$\",\"span\",\"code-segement25\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement26\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"3.2.3\"]}],[\"$\",\"span\",\"code-segement27\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement28\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"version\"]}],[\"$\",\"span\",\"code-segement29\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement30\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement31\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement32\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement33\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"parent\"]}],[\"$\",\"span\",\"code-segement34\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement35\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],\"\\r\\n\",[\"$\",\"span\",\"code-segement37\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement38\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement39\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"dependency\"]}],[\"$\",\"span\",\"code-segement40\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement41\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement42\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\t\"]}],[\"$\",\"span\",\"code-segement43\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement44\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"groupId\"]}],[\"$\",\"span\",\"code-segement45\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement46\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"io.micrometer\"]}],[\"$\",\"span\",\"code-segement47\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement48\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"groupId\"]}],[\"$\",\"span\",\"code-segement49\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement50\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement51\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\t\"]}],[\"$\",\"span\",\"code-segement52\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement53\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"artifactId\"]}],[\"$\",\"span\",\"code-segement54\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement55\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"micrometer-registry-prometheus\"]}],[\"$\",\"span\",\"code-segement56\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement57\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"artifactId\"]}],[\"$\",\"span\",\"code-segement58\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement59\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement60\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement61\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement62\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"dependency\"]}],[\"$\",\"span\",\"code-segement63\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement64\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement65\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement66\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement67\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"dependency\"]}],[\"$\",\"span\",\"code-segement68\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement69\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement70\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\t\"]}],[\"$\",\"span\",\"code-segement71\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement72\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"groupId\"]}],[\"$\",\"span\",\"code-segement73\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement74\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"io.micrometer\"]}],[\"$\",\"span\",\"code-segement75\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement76\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"groupId\"]}],[\"$\",\"span\",\"code-segement77\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement78\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement79\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\t\"]}],[\"$\",\"span\",\"code-segement80\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement81\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"artifactId\"]}],[\"$\",\"span\",\"code-segement82\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement83\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"micrometer-tracing-bridge-brave\"]}],[\"$\",\"span\",\"code-segement84\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement85\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"artifactId\"]}],[\"$\",\"span\",\"code-segement86\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement87\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement88\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement89\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement90\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"dependency\"]}],[\"$\",\"span\",\"code-segement91\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement92\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],\"\\r\\n\",[\"$\",\"span\",\"code-segement94\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement95\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement96\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"dependency\"]}],[\"$\",\"span\",\"code-segement97\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement98\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement99\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\t\"]}],[\"$\",\"span\",\"code-segement100\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement101\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"groupId\"]}],[\"$\",\"span\",\"code-segement102\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement103\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"net.logstash.logback\"]}],[\"$\",\"span\",\"code-segement104\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement105\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"groupId\"]}],[\"$\",\"span\",\"code-segement106\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement107\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement108\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\t\"]}],[\"$\",\"span\",\"code-segement109\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement110\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"artifactId\"]}],[\"$\",\"span\",\"code-segement111\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement112\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"logstash-logback-encoder\"]}],[\"$\",\"span\",\"code-segement113\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement114\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"artifactId\"]}],[\"$\",\"span\",\"code-segement115\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement116\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement117\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\t\"]}],[\"$\",\"span\",\"code-segement118\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement119\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"version\"]}],[\"$\",\"span\",\"code-segement120\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement121\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"7.2\"]}],[\"$\",\"span\",\"code-segement122\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement123\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"version\"]}],[\"$\",\"span\",\"code-segement124\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement125\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement126\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement127\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement128\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"dependency\"]}],[\"$\",\"span\",\"code-segement129\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}]]]}]}]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":[\"如果需要用 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"WebClient\"}],\" 去 call downstream microservice 既話就加：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"mdx-components_code__3gNm1\",\"style\":{\"color\":\"black\",\"background\":\"#f5f2f0\",\"textShadow\":\"0 1px white\",\"fontFamily\":\"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace\",\"fontSize\":\"1em\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"wordWrap\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"4\",\"OTabSize\":\"4\",\"tabSize\":\"4\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\",\"padding\":\"1em\",\"margin\":\".5em 0\",\"overflow\":\"auto\"},\"children\":[\"$\",\"code\",null,{\"className\":\"language-xml\",\"style\":{\"whiteSpace\":\"pre\",\"color\":\"black\",\"background\":\"none\",\"textShadow\":\"0 1px white\",\"fontFamily\":\"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace\",\"fontSize\":\"1em\",\"textAlign\":\"left\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"wordWrap\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"4\",\"OTabSize\":\"4\",\"tabSize\":\"4\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\"},\"children\":[false,[[\"$\",\"span\",\"code-segement0\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement1\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"dependency\"]}],[\"$\",\"span\",\"code-segement2\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement3\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement4\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\t\"]}],[\"$\",\"span\",\"code-segement5\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement6\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"groupId\"]}],[\"$\",\"span\",\"code-segement7\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement8\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"org.springframework\"]}],[\"$\",\"span\",\"code-segement9\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement10\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"groupId\"]}],[\"$\",\"span\",\"code-segement11\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement12\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement13\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\t\"]}],[\"$\",\"span\",\"code-segement14\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement15\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"artifactId\"]}],[\"$\",\"span\",\"code-segement16\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement17\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"spring-webflux\"]}],[\"$\",\"span\",\"code-segement18\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement19\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"artifactId\"]}],[\"$\",\"span\",\"code-segement20\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement21\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement22\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement23\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement24\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"dependency\"]}],[\"$\",\"span\",\"code-segement25\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}]]]}]}]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":\"如果需要用 OpenFeign 去 call downstream microservice 既話就加：\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"mdx-components_code__3gNm1\",\"style\":{\"color\":\"black\",\"background\":\"#f5f2f0\",\"textShadow\":\"0 1px white\",\"fontFamily\":\"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace\",\"fontSize\":\"1em\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"wordWrap\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"4\",\"OTabSize\":\"4\",\"tabSize\":\"4\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\",\"padding\":\"1em\",\"margin\":\".5em 0\",\"overflow\":\"auto\"},\"children\":[\"$\",\"code\",null,{\"className\":\"language-xml\",\"style\":{\"whiteSpace\":\"pre\",\"color\":\"black\",\"background\":\"none\",\"textShadow\":\"0 1px white\",\"fontFamily\":\"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace\",\"fontSize\":\"1em\",\"textAlign\":\"left\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"wordWrap\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"4\",\"OTabSize\":\"4\",\"tabSize\":\"4\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\"},\"children\":[false,[[\"$\",\"span\",\"code-segement0\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement1\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"dependency\"]}],[\"$\",\"span\",\"code-segement2\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement3\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement4\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\t\"]}],[\"$\",\"span\",\"code-segement5\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement6\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"groupId\"]}],[\"$\",\"span\",\"code-segement7\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement8\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"org.springframework.cloud\"]}],[\"$\",\"span\",\"code-segement9\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement10\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"groupId\"]}],[\"$\",\"span\",\"code-segement11\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement12\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement13\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\t\"]}],[\"$\",\"span\",\"code-segement14\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement15\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"artifactId\"]}],[\"$\",\"span\",\"code-segement16\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement17\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"spring-cloud-starter-openfeign\"]}],[\"$\",\"span\",\"code-segement18\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement19\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"artifactId\"]}],[\"$\",\"span\",\"code-segement20\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement21\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement22\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement23\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement24\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"dependency\"]}],[\"$\",\"span\",\"code-segement25\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement26\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement27\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement28\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement29\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"dependency\"]}],[\"$\",\"span\",\"code-segement30\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement31\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement32\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\t\"]}],[\"$\",\"span\",\"code-segement33\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement34\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"groupId\"]}],[\"$\",\"span\",\"code-segement35\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement36\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"io.github.openfeign\"]}],[\"$\",\"span\",\"code-segement37\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement38\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"groupId\"]}],[\"$\",\"span\",\"code-segement39\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement40\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement41\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\t\"]}],[\"$\",\"span\",\"code-segement42\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement43\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"artifactId\"]}],[\"$\",\"span\",\"code-segement44\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement45\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"feign-micrometer\"]}],[\"$\",\"span\",\"code-segement46\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement47\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"artifactId\"]}],[\"$\",\"span\",\"code-segement48\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement49\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement50\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement51\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement52\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"dependency\"]}],[\"$\",\"span\",\"code-segement53\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}]]]}]}]}],\"\\n\",[\"$\",\"hr\",null,{\"className\":\"mdx-components_hr__o_oFr\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"32-寫-java-code\",\"className\":\"mdx-components_heading__HrNl3\",\"style\":{\"zIndex\":3020000},\"children\":\"3.2 寫 Java code\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"321-spring-resttemplate\",\"className\":\"mdx-components_heading__HrNl3\",\"style\":{\"zIndex\":3020100},\"children\":[\"3.2.1 Spring \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"RestTemplate\"}]]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":[\"如果要令到 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"RestTemplate\"}],\" 識得喺 request header 度 forward micrometer tracing 既 data 去 downstream microservice 度，就要用 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"RestTemplateBuilder\"}],\" bean 去創建 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"RestTemplate\"}],\"：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"mdx-components_code__3gNm1\",\"style\":{\"color\":\"black\",\"background\":\"#f5f2f0\",\"textShadow\":\"0 1px white\",\"fontFamily\":\"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace\",\"fontSize\":\"1em\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"wordWrap\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"4\",\"OTabSize\":\"4\",\"tabSize\":\"4\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\",\"padding\":\"1em\",\"margin\":\".5em 0\",\"overflow\":\"auto\"},\"children\":[\"$\",\"code\",null,{\"className\":\"language-java\",\"style\":{\"whiteSpace\":\"pre\",\"color\":\"black\",\"background\":\"none\",\"textShadow\":\"0 1px white\",\"fontFamily\":\"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace\",\"fontSize\":\"1em\",\"textAlign\":\"left\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"wordWrap\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"4\",\"OTabSize\":\"4\",\"tabSize\":\"4\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\"},\"children\":[false,[[\"$\",\"span\",\"code-segement0\",{\"className\":\"token annotation\",\"style\":{\"color\":\"#999\"},\"children\":[\"@Configuration\"]}],[\"$\",\"span\",\"code-segement1\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement2\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement3\",{\"className\":\"token\",\"style\":{\"color\":\"#07a\"},\"children\":[\"public\"]}],[\"$\",\"span\",\"code-segement4\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement5\",{\"className\":\"token\",\"style\":{\"color\":\"#07a\"},\"children\":[\"class\"]}],[\"$\",\"span\",\"code-segement6\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement7\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"RestTemplateConfig\"]}],[\"$\",\"span\",\"code-segement8\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement9\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"{\"]}],[\"$\",\"span\",\"code-segement10\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],\"\\r\\n\",[\"$\",\"span\",\"code-segement12\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"    \"]}],[\"$\",\"span\",\"code-segement13\",{\"className\":\"token annotation\",\"style\":{\"color\":\"#999\"},\"children\":[\"@Bean\"]}],[\"$\",\"span\",\"code-segement14\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement15\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"    \"]}],[\"$\",\"span\",\"code-segement16\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"RestTemplate\"]}],[\"$\",\"span\",\"code-segement17\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement18\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"restTemplate\"]}],[\"$\",\"span\",\"code-segement19\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement20\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"RestTemplateBuilder\"]}],[\"$\",\"span\",\"code-segement21\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" builder\"]}],[\"$\",\"span\",\"code-segement22\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement23\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement24\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"{\"]}],[\"$\",\"span\",\"code-segement25\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],\"\\r\\n\",[\"$\",\"span\",\"code-segement27\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"        \"]}],[\"$\",\"span\",\"code-segement28\",{\"className\":\"token\",\"style\":{\"color\":\"#07a\"},\"children\":[\"final\"]}],[\"$\",\"span\",\"code-segement29\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement30\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"RestTemplate\"]}],[\"$\",\"span\",\"code-segement31\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" restTemplate \"]}],[\"$\",\"span\",\"code-segement32\",{\"className\":\"token\",\"style\":{\"color\":\"#9a6e3a\",\"background\":\"hsla(0, 0%, 100%, .5)\"},\"children\":[\"=\"]}],[\"$\",\"span\",\"code-segement33\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" builder\\r\\n\"]}],[\"$\",\"span\",\"code-segement34\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"            \"]}],[\"$\",\"span\",\"code-segement35\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement36\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"setConnectTimeout\"]}],[\"$\",\"span\",\"code-segement37\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement38\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"Duration\"]}],[\"$\",\"span\",\"code-segement39\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement40\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"ofSeconds\"]}],[\"$\",\"span\",\"code-segement41\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement42\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"10\"]}],[\"$\",\"span\",\"code-segement43\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement44\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement45\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement46\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"            \"]}],[\"$\",\"span\",\"code-segement47\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement48\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"basicAuthentication\"]}],[\"$\",\"span\",\"code-segement49\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement50\",{\"className\":\"token\",\"style\":{\"color\":\"#690\"},\"children\":[\"\\\"username\\\"\"]}],[\"$\",\"span\",\"code-segement51\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\",\"]}],[\"$\",\"span\",\"code-segement52\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement53\",{\"className\":\"token\",\"style\":{\"color\":\"#690\"},\"children\":[\"\\\"password\\\"\"]}],[\"$\",\"span\",\"code-segement54\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement55\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement56\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"            \"]}],[\"$\",\"span\",\"code-segement57\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement58\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"defaultHeader\"]}],[\"$\",\"span\",\"code-segement59\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement60\",{\"className\":\"token\",\"style\":{\"color\":\"#690\"},\"children\":[\"\\\"header1\\\"\"]}],[\"$\",\"span\",\"code-segement61\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\",\"]}],[\"$\",\"span\",\"code-segement62\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement63\",{\"className\":\"token\",\"style\":{\"color\":\"#690\"},\"children\":[\"\\\"header1-value\\\"\"]}],[\"$\",\"span\",\"code-segement64\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement65\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement66\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"            \"]}],[\"$\",\"span\",\"code-segement67\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement68\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"defaultHeader\"]}],[\"$\",\"span\",\"code-segement69\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement70\",{\"className\":\"token\",\"style\":{\"color\":\"#690\"},\"children\":[\"\\\"header2\\\"\"]}],[\"$\",\"span\",\"code-segement71\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\",\"]}],[\"$\",\"span\",\"code-segement72\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement73\",{\"className\":\"token\",\"style\":{\"color\":\"#690\"},\"children\":[\"\\\"header2-value\\\"\"]}],[\"$\",\"span\",\"code-segement74\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement75\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement76\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"            \"]}],[\"$\",\"span\",\"code-segement77\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement78\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"build\"]}],[\"$\",\"span\",\"code-segement79\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement80\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement81\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\";\"]}],[\"$\",\"span\",\"code-segement82\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],\"\\r\\n\",[\"$\",\"span\",\"code-segement84\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"        \"]}],[\"$\",\"span\",\"code-segement85\",{\"className\":\"token\",\"style\":{\"color\":\"slategray\"},\"children\":[\"// 如果加入左 jackson-dataformat-xml\"]}],[\"$\",\"span\",\"code-segement86\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement87\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"        \"]}],[\"$\",\"span\",\"code-segement88\",{\"className\":\"token\",\"style\":{\"color\":\"slategray\"},\"children\":[\"// 令 RestTemplate 唔好喺 Accept request header 度加入 application/xml 或相關既 values\"]}],[\"$\",\"span\",\"code-segement89\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement90\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"        restTemplate\"]}],[\"$\",\"span\",\"code-segement91\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement92\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"getMessageConverters\"]}],[\"$\",\"span\",\"code-segement93\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement94\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement95\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement96\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"            \"]}],[\"$\",\"span\",\"code-segement97\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement98\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"removeIf\"]}],[\"$\",\"span\",\"code-segement99\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement100\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"e \"]}],[\"$\",\"span\",\"code-segement101\",{\"className\":\"token\",\"style\":{\"color\":\"#9a6e3a\",\"background\":\"hsla(0, 0%, 100%, .5)\"},\"children\":[\"-\u003e\"]}],[\"$\",\"span\",\"code-segement102\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" e\"]}],[\"$\",\"span\",\"code-segement103\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement104\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"getClass\"]}],[\"$\",\"span\",\"code-segement105\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement106\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement107\",{\"className\":\"token\",\"style\":{\"color\":\"#9a6e3a\",\"background\":\"hsla(0, 0%, 100%, .5)\"},\"children\":[\"==\"]}],[\"$\",\"span\",\"code-segement108\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"MappingJackson2XmlHttpMessageConverter\"]}],[\"$\",\"span\",\"code-segement109\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement110\",{\"className\":\"token\",\"style\":{\"color\":\"#07a\"},\"children\":[\"class\"]}],[\"$\",\"span\",\"code-segement111\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement112\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\";\"]}],[\"$\",\"span\",\"code-segement113\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],\"\\r\\n\",[\"$\",\"span\",\"code-segement115\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"        \"]}],[\"$\",\"span\",\"code-segement116\",{\"className\":\"token\",\"style\":{\"color\":\"#07a\"},\"children\":[\"return\"]}],[\"$\",\"span\",\"code-segement117\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" restTemplate\"]}],[\"$\",\"span\",\"code-segement118\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\";\"]}],[\"$\",\"span\",\"code-segement119\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement120\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"    \"]}],[\"$\",\"span\",\"code-segement121\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"}\"]}],[\"$\",\"span\",\"code-segement122\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement123\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement124\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"}\"]}]]]}]}]}],\"\\n\",[\"$\",\"hr\",null,{\"className\":\"mdx-components_hr__o_oFr\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"322-spring-webflux-webclient\",\"className\":\"mdx-components_heading__HrNl3\",\"style\":{\"zIndex\":3020200},\"children\":[\"3.2.2 Spring Webflux \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"WebClient\"}]]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":[\"如果要令到 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"WebClient\"}],\" 識得喺 request header 度 forward micrometer tracing 既 data 去 downstream microservice 度，就要用 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"WebClient.Builder\"}],\" bean 去創建 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"WebClient\"}],\"：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"mdx-components_code__3gNm1\",\"style\":{\"color\":\"black\",\"background\":\"#f5f2f0\",\"textShadow\":\"0 1px white\",\"fontFamily\":\"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace\",\"fontSize\":\"1em\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"wordWrap\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"4\",\"OTabSize\":\"4\",\"tabSize\":\"4\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\",\"padding\":\"1em\",\"margin\":\".5em 0\",\"overflow\":\"auto\"},\"children\":[\"$\",\"code\",null,{\"className\":\"language-java\",\"style\":{\"whiteSpace\":\"pre\",\"color\":\"black\",\"background\":\"none\",\"textShadow\":\"0 1px white\",\"fontFamily\":\"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace\",\"fontSize\":\"1em\",\"textAlign\":\"left\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"wordWrap\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"4\",\"OTabSize\":\"4\",\"tabSize\":\"4\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\"},\"children\":[false,[[\"$\",\"span\",\"code-segement0\",{\"className\":\"token annotation\",\"style\":{\"color\":\"#999\"},\"children\":[\"@Configuration\"]}],[\"$\",\"span\",\"code-segement1\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement2\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement3\",{\"className\":\"token\",\"style\":{\"color\":\"#07a\"},\"children\":[\"public\"]}],[\"$\",\"span\",\"code-segement4\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement5\",{\"className\":\"token\",\"style\":{\"color\":\"#07a\"},\"children\":[\"class\"]}],[\"$\",\"span\",\"code-segement6\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement7\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"WebClientConfig\"]}],[\"$\",\"span\",\"code-segement8\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement9\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"{\"]}],[\"$\",\"span\",\"code-segement10\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],\"\\r\\n\",[\"$\",\"span\",\"code-segement12\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"    \"]}],[\"$\",\"span\",\"code-segement13\",{\"className\":\"token annotation\",\"style\":{\"color\":\"#999\"},\"children\":[\"@Bean\"]}],[\"$\",\"span\",\"code-segement14\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement15\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"    \"]}],[\"$\",\"span\",\"code-segement16\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"WebClient\"]}],[\"$\",\"span\",\"code-segement17\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement18\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"webClient\"]}],[\"$\",\"span\",\"code-segement19\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement20\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"WebClient\"]}],[\"$\",\"span\",\"code-segement21\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement22\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"Builder\"]}],[\"$\",\"span\",\"code-segement23\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" builder\"]}],[\"$\",\"span\",\"code-segement24\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement25\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement26\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"{\"]}],[\"$\",\"span\",\"code-segement27\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],\"\\r\\n\",[\"$\",\"span\",\"code-segement29\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"        \"]}],[\"$\",\"span\",\"code-segement30\",{\"className\":\"token\",\"style\":{\"color\":\"#07a\"},\"children\":[\"final\"]}],[\"$\",\"span\",\"code-segement31\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement32\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"HttpClient\"]}],[\"$\",\"span\",\"code-segement33\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" httpClient \"]}],[\"$\",\"span\",\"code-segement34\",{\"className\":\"token\",\"style\":{\"color\":\"#9a6e3a\",\"background\":\"hsla(0, 0%, 100%, .5)\"},\"children\":[\"=\"]}],[\"$\",\"span\",\"code-segement35\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement36\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"HttpClient\"]}],[\"$\",\"span\",\"code-segement37\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement38\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"newBuilder\"]}],[\"$\",\"span\",\"code-segement39\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement40\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement41\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement42\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"            \"]}],[\"$\",\"span\",\"code-segement43\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement44\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"version\"]}],[\"$\",\"span\",\"code-segement45\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement46\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"Version\"]}],[\"$\",\"span\",\"code-segement47\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement48\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"HTTP_1_1\"]}],[\"$\",\"span\",\"code-segement49\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement50\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement51\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"            \"]}],[\"$\",\"span\",\"code-segement52\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement53\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"connectTimeout\"]}],[\"$\",\"span\",\"code-segement54\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement55\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"Duration\"]}],[\"$\",\"span\",\"code-segement56\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement57\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"ofSeconds\"]}],[\"$\",\"span\",\"code-segement58\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement59\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"10\"]}],[\"$\",\"span\",\"code-segement60\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement61\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement62\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement63\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"            \"]}],[\"$\",\"span\",\"code-segement64\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement65\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"build\"]}],[\"$\",\"span\",\"code-segement66\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement67\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement68\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\";\"]}],[\"$\",\"span\",\"code-segement69\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],\"\\r\\n\",[\"$\",\"span\",\"code-segement71\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"        \"]}],[\"$\",\"span\",\"code-segement72\",{\"className\":\"token\",\"style\":{\"color\":\"#07a\"},\"children\":[\"final\"]}],[\"$\",\"span\",\"code-segement73\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement74\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"WebClient\"]}],[\"$\",\"span\",\"code-segement75\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" client \"]}],[\"$\",\"span\",\"code-segement76\",{\"className\":\"token\",\"style\":{\"color\":\"#9a6e3a\",\"background\":\"hsla(0, 0%, 100%, .5)\"},\"children\":[\"=\"]}],[\"$\",\"span\",\"code-segement77\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" builder\\r\\n\"]}],[\"$\",\"span\",\"code-segement78\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"                \"]}],[\"$\",\"span\",\"code-segement79\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement80\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"clientConnector\"]}],[\"$\",\"span\",\"code-segement81\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement82\",{\"className\":\"token\",\"style\":{\"color\":\"#07a\"},\"children\":[\"new\"]}],[\"$\",\"span\",\"code-segement83\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement84\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"JdkClientHttpConnector\"]}],[\"$\",\"span\",\"code-segement85\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement86\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"httpClient\"]}],[\"$\",\"span\",\"code-segement87\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement88\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement89\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement90\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"                \"]}],[\"$\",\"span\",\"code-segement91\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement92\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"defaultHeader\"]}],[\"$\",\"span\",\"code-segement93\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement94\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"HttpHeaders\"]}],[\"$\",\"span\",\"code-segement95\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement96\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"CONTENT_TYPE\"]}],[\"$\",\"span\",\"code-segement97\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\",\"]}],[\"$\",\"span\",\"code-segement98\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement99\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"MediaType\"]}],[\"$\",\"span\",\"code-segement100\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement101\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"APPLICATION_JSON_VALUE\"]}],[\"$\",\"span\",\"code-segement102\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement103\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement104\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"                \"]}],[\"$\",\"span\",\"code-segement105\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement106\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"defaultHeader\"]}],[\"$\",\"span\",\"code-segement107\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement108\",{\"className\":\"token\",\"style\":{\"color\":\"#690\"},\"children\":[\"\\\"header1\\\"\"]}],[\"$\",\"span\",\"code-segement109\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\",\"]}],[\"$\",\"span\",\"code-segement110\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement111\",{\"className\":\"token\",\"style\":{\"color\":\"#690\"},\"children\":[\"\\\"header1-value\\\"\"]}],[\"$\",\"span\",\"code-segement112\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement113\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement114\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"                \"]}],[\"$\",\"span\",\"code-segement115\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement116\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"defaultHeader\"]}],[\"$\",\"span\",\"code-segement117\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement118\",{\"className\":\"token\",\"style\":{\"color\":\"#690\"},\"children\":[\"\\\"header2\\\"\"]}],[\"$\",\"span\",\"code-segement119\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\",\"]}],[\"$\",\"span\",\"code-segement120\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement121\",{\"className\":\"token\",\"style\":{\"color\":\"#690\"},\"children\":[\"\\\"header2-value\\\"\"]}],[\"$\",\"span\",\"code-segement122\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement123\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement124\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"                \"]}],[\"$\",\"span\",\"code-segement125\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement126\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"build\"]}],[\"$\",\"span\",\"code-segement127\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement128\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement129\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\";\"]}],[\"$\",\"span\",\"code-segement130\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],\"\\r\\n\",[\"$\",\"span\",\"code-segement132\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"        \"]}],[\"$\",\"span\",\"code-segement133\",{\"className\":\"token\",\"style\":{\"color\":\"#07a\"},\"children\":[\"return\"]}],[\"$\",\"span\",\"code-segement134\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" client\"]}],[\"$\",\"span\",\"code-segement135\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\";\"]}],[\"$\",\"span\",\"code-segement136\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement137\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"    \"]}],[\"$\",\"span\",\"code-segement138\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"}\"]}],[\"$\",\"span\",\"code-segement139\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement140\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement141\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"}\"]}]]]}]}]}],\"\\n\",[\"$\",\"hr\",null,{\"className\":\"mdx-components_hr__o_oFr\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"323-spring-61-restclient\",\"className\":\"mdx-components_heading__HrNl3\",\"style\":{\"zIndex\":3020300},\"children\":[\"3.2.3 Spring 6.1 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"RestClient\"}]]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":[\"如果要令到 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"RestClient\"}],\" 識得喺 request header 度 forward micrometer tracing 既 data 去 downstream microservice 度，就要用 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"RestClient.Builder\"}],\" bean 去創建 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"RestClient\"}],\"：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"mdx-components_code__3gNm1\",\"style\":{\"color\":\"black\",\"background\":\"#f5f2f0\",\"textShadow\":\"0 1px white\",\"fontFamily\":\"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace\",\"fontSize\":\"1em\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"wordWrap\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"4\",\"OTabSize\":\"4\",\"tabSize\":\"4\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\",\"padding\":\"1em\",\"margin\":\".5em 0\",\"overflow\":\"auto\"},\"children\":[\"$\",\"code\",null,{\"className\":\"language-java\",\"style\":{\"whiteSpace\":\"pre\",\"color\":\"black\",\"background\":\"none\",\"textShadow\":\"0 1px white\",\"fontFamily\":\"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace\",\"fontSize\":\"1em\",\"textAlign\":\"left\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"wordWrap\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"4\",\"OTabSize\":\"4\",\"tabSize\":\"4\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\"},\"children\":[false,[[\"$\",\"span\",\"code-segement0\",{\"className\":\"token annotation\",\"style\":{\"color\":\"#999\"},\"children\":[\"@Configuration\"]}],[\"$\",\"span\",\"code-segement1\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement2\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement3\",{\"className\":\"token\",\"style\":{\"color\":\"#07a\"},\"children\":[\"public\"]}],[\"$\",\"span\",\"code-segement4\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement5\",{\"className\":\"token\",\"style\":{\"color\":\"#07a\"},\"children\":[\"class\"]}],[\"$\",\"span\",\"code-segement6\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement7\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"RestClientConfig\"]}],[\"$\",\"span\",\"code-segement8\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement9\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"{\"]}],[\"$\",\"span\",\"code-segement10\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],\"\\r\\n\",[\"$\",\"span\",\"code-segement12\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"    \"]}],[\"$\",\"span\",\"code-segement13\",{\"className\":\"token annotation\",\"style\":{\"color\":\"#999\"},\"children\":[\"@Bean\"]}],[\"$\",\"span\",\"code-segement14\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement15\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"    \"]}],[\"$\",\"span\",\"code-segement16\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"RestClient\"]}],[\"$\",\"span\",\"code-segement17\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement18\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"restClient\"]}],[\"$\",\"span\",\"code-segement19\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement20\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"RestClient\"]}],[\"$\",\"span\",\"code-segement21\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement22\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"Builder\"]}],[\"$\",\"span\",\"code-segement23\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" builder\"]}],[\"$\",\"span\",\"code-segement24\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement25\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement26\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"{\"]}],[\"$\",\"span\",\"code-segement27\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],\"\\r\\n\",[\"$\",\"span\",\"code-segement29\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"        \"]}],[\"$\",\"span\",\"code-segement30\",{\"className\":\"token\",\"style\":{\"color\":\"#07a\"},\"children\":[\"final\"]}],[\"$\",\"span\",\"code-segement31\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement32\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"RestClient\"]}],[\"$\",\"span\",\"code-segement33\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" client \"]}],[\"$\",\"span\",\"code-segement34\",{\"className\":\"token\",\"style\":{\"color\":\"#9a6e3a\",\"background\":\"hsla(0, 0%, 100%, .5)\"},\"children\":[\"=\"]}],[\"$\",\"span\",\"code-segement35\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" builder\\r\\n\"]}],[\"$\",\"span\",\"code-segement36\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"                \"]}],[\"$\",\"span\",\"code-segement37\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement38\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"defaultHeader\"]}],[\"$\",\"span\",\"code-segement39\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement40\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"HttpHeaders\"]}],[\"$\",\"span\",\"code-segement41\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement42\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"CONTENT_TYPE\"]}],[\"$\",\"span\",\"code-segement43\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\",\"]}],[\"$\",\"span\",\"code-segement44\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement45\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"MediaType\"]}],[\"$\",\"span\",\"code-segement46\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement47\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"APPLICATION_JSON_VALUE\"]}],[\"$\",\"span\",\"code-segement48\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement49\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement50\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"                \"]}],[\"$\",\"span\",\"code-segement51\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement52\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"defaultHeader\"]}],[\"$\",\"span\",\"code-segement53\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement54\",{\"className\":\"token\",\"style\":{\"color\":\"#690\"},\"children\":[\"\\\"header1\\\"\"]}],[\"$\",\"span\",\"code-segement55\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\",\"]}],[\"$\",\"span\",\"code-segement56\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement57\",{\"className\":\"token\",\"style\":{\"color\":\"#690\"},\"children\":[\"\\\"header1-value\\\"\"]}],[\"$\",\"span\",\"code-segement58\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement59\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement60\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"                \"]}],[\"$\",\"span\",\"code-segement61\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement62\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"defaultHeader\"]}],[\"$\",\"span\",\"code-segement63\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement64\",{\"className\":\"token\",\"style\":{\"color\":\"#690\"},\"children\":[\"\\\"header2\\\"\"]}],[\"$\",\"span\",\"code-segement65\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\",\"]}],[\"$\",\"span\",\"code-segement66\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement67\",{\"className\":\"token\",\"style\":{\"color\":\"#690\"},\"children\":[\"\\\"header2-value\\\"\"]}],[\"$\",\"span\",\"code-segement68\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement69\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement70\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"                \"]}],[\"$\",\"span\",\"code-segement71\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement72\",{\"className\":\"token\",\"style\":{\"color\":\"#DD4A68\"},\"children\":[\"build\"]}],[\"$\",\"span\",\"code-segement73\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement74\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement75\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\";\"]}],[\"$\",\"span\",\"code-segement76\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],\"\\r\\n\",[\"$\",\"span\",\"code-segement78\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"        \"]}],[\"$\",\"span\",\"code-segement79\",{\"className\":\"token\",\"style\":{\"color\":\"#07a\"},\"children\":[\"return\"]}],[\"$\",\"span\",\"code-segement80\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" client\"]}],[\"$\",\"span\",\"code-segement81\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\";\"]}],[\"$\",\"span\",\"code-segement82\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement83\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"    \"]}],[\"$\",\"span\",\"code-segement84\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"}\"]}],[\"$\",\"span\",\"code-segement85\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement86\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement87\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"}\"]}]]]}]}]}],\"\\n\",[\"$\",\"hr\",null,{\"className\":\"mdx-components_hr__o_oFr\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"324-spring-cloud-openfeign\",\"className\":\"mdx-components_heading__HrNl3\",\"style\":{\"zIndex\":3020400},\"children\":\"3.2.4 Spring Cloud OpenFeign\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":[\"如果要令到 OpenFeign 識得喺 request header 度 forward micrometer tracing 既 data 去目標既 microservice 度，只需要喺 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"pom.xml\"}],\" 加入 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"io.github.openfeign:feign-micrometer\"}],\" 既 Maven dependency。\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":\"呢個 dependency 既版本由以下既 dependency management BOMs 控制。\"}],\"\\n\",[\"$\",\"ul\",null,{\"className\":\"mdx-components_list__QQ4ZN\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"org.springframework.cloud:spring-cloud-dependencies\"}],\"\\n\",[\"$\",\"ul\",null,{\"className\":\"mdx-components_list__QQ4ZN\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"org.springframework.cloud:spring-cloud-openfeign-dependencies\"}],\"\\n\",[\"$\",\"ul\",null,{\"className\":\"mdx-components_list__QQ4ZN\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"io.github.openfeign:feign-bom\"}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"hr\",null,{\"className\":\"mdx-components_hr__o_oFr\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"33-logback-配置\",\"className\":\"mdx-components_heading__HrNl3\",\"style\":{\"zIndex\":3030000},\"children\":\"3.3 Logback 配置\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":[\"最後一步，我地需要喺 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"logback.xml\"}],\" 裡面加入 trace ID 以及 span ID 既 MDC fields，咁喺 application logs 度就可以睇到佢地。\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":[\"因為係 distributed microservices 既關係，我地如果用好似 ELK 咁既 centralized logging platform 既話，一定要可以分得到唔同既 microservices 既 logs，咁就要喺 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"logback.xml\"}],\" 既 encoders 度配置好：\"]}],\"\\n\",[\"$\",\"ul\",null,{\"className\":\"mdx-components_list__QQ4ZN\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"Host name，可以直接用 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"$${HOSTNAME:-}\"}],\" 或者 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"$${hostname:-}\"}],\"。\"]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"Spring application name，可以加入以下既配置，之後就可以用 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"$${app_name:-}\"}],\"：\",\"\\n\",[\"$\",\"ul\",null,{\"className\":\"mdx-components_list__QQ4ZN\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"mdx-components_code__3gNm1\",\"style\":{\"color\":\"black\",\"background\":\"#f5f2f0\",\"textShadow\":\"0 1px white\",\"fontFamily\":\"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace\",\"fontSize\":\"1em\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"wordWrap\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"4\",\"OTabSize\":\"4\",\"tabSize\":\"4\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\",\"padding\":\"1em\",\"margin\":\".5em 0\",\"overflow\":\"auto\"},\"children\":[\"$\",\"code\",null,{\"className\":\"language-xml\",\"style\":{\"whiteSpace\":\"pre\",\"color\":\"black\",\"background\":\"none\",\"textShadow\":\"0 1px white\",\"fontFamily\":\"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace\",\"fontSize\":\"1em\",\"textAlign\":\"left\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"wordWrap\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"4\",\"OTabSize\":\"4\",\"tabSize\":\"4\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\"},\"children\":[false,[[\"$\",\"span\",\"code-segement0\",{\"className\":\"token\",\"style\":{\"color\":\"slategray\"},\"children\":[\"\u003c!-- 喺 configuration 裡面 --\u003e\"]}],[\"$\",\"span\",\"code-segement1\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement2\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement3\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement4\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"springProperty\"]}],[\"$\",\"span\",\"code-segement5\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement6\",{\"className\":\"token\",\"style\":{\"color\":\"#690\"},\"children\":[\"scope\"]}],[\"$\",\"span\",\"code-segement7\",{\"className\":\"token attr-equals\",\"style\":{\"color\":\"#999\"},\"children\":[\"=\"]}],[\"$\",\"span\",\"code-segement8\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\\\"\"]}],[\"$\",\"span\",\"code-segement9\",{\"className\":\"token\",\"style\":{\"color\":\"#07a\"},\"children\":[\"context\"]}],[\"$\",\"span\",\"code-segement10\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\\\"\"]}],[\"$\",\"span\",\"code-segement11\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement12\",{\"className\":\"token\",\"style\":{\"color\":\"#690\"},\"children\":[\"name\"]}],[\"$\",\"span\",\"code-segement13\",{\"className\":\"token attr-equals\",\"style\":{\"color\":\"#999\"},\"children\":[\"=\"]}],[\"$\",\"span\",\"code-segement14\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\\\"\"]}],[\"$\",\"span\",\"code-segement15\",{\"className\":\"token\",\"style\":{\"color\":\"#07a\"},\"children\":[\"app_name\"]}],[\"$\",\"span\",\"code-segement16\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\\\"\"]}],[\"$\",\"span\",\"code-segement17\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement18\",{\"className\":\"token\",\"style\":{\"color\":\"#690\"},\"children\":[\"source\"]}],[\"$\",\"span\",\"code-segement19\",{\"className\":\"token attr-equals\",\"style\":{\"color\":\"#999\"},\"children\":[\"=\"]}],[\"$\",\"span\",\"code-segement20\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\\\"\"]}],[\"$\",\"span\",\"code-segement21\",{\"className\":\"token\",\"style\":{\"color\":\"#07a\"},\"children\":[\"spring.application.name\"]}],[\"$\",\"span\",\"code-segement22\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\\\"\"]}],[\"$\",\"span\",\"code-segement23\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement24\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"/\u003e\"]}]]]}]}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":[\"詳情可以睇返呢篇：\",[\"$\",\"span\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"/e2-next/blog/spring-boot-elk-logging\",\"className\":\"mdx-components_anchor__j2fDs\",\"children\":\"Spring 項目使用 ELK 做 logging\"}]}],\"。\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"331-自定義-encoder-pattern\",\"className\":\"mdx-components_heading__HrNl3\",\"style\":{\"zIndex\":3030100},\"children\":\"3.3.1 自定義 encoder pattern\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":\"如果要喺自定義既 encoder pattern 裡面加入 trace ID 以及 span ID，我地可以用：\"}],\"\\n\",[\"$\",\"ul\",null,{\"className\":\"mdx-components_list__QQ4ZN\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"%X{traceId:-}\"}]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"%X{spanId:-}\"}]}],\"\\n\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":\"例子：\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"mdx-components_code__3gNm1\",\"style\":{\"color\":\"black\",\"background\":\"#f5f2f0\",\"textShadow\":\"0 1px white\",\"fontFamily\":\"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace\",\"fontSize\":\"1em\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"wordWrap\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"4\",\"OTabSize\":\"4\",\"tabSize\":\"4\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\",\"padding\":\"1em\",\"margin\":\".5em 0\",\"overflow\":\"auto\"},\"children\":[\"$\",\"code\",null,{\"className\":\"language-xml\",\"style\":{\"whiteSpace\":\"pre\",\"color\":\"black\",\"background\":\"none\",\"textShadow\":\"0 1px white\",\"fontFamily\":\"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace\",\"fontSize\":\"1em\",\"textAlign\":\"left\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"wordWrap\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"4\",\"OTabSize\":\"4\",\"tabSize\":\"4\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\"},\"children\":[false,[[\"$\",\"span\",\"code-segement0\",{\"className\":\"token\",\"style\":{\"color\":\"slategray\"},\"children\":[\"\u003c!-- 喺 appender 裡面 --\u003e\"]}],[\"$\",\"span\",\"code-segement1\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement2\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement3\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement4\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"encoder\"]}],[\"$\",\"span\",\"code-segement5\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement6\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement7\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\t\"]}],[\"$\",\"span\",\"code-segement8\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement9\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"pattern\"]}],[\"$\",\"span\",\"code-segement10\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement11\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"[${hostname:-} ${app_name:-}] [%X{traceId:-} %X{spanId:-}] %d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} (%file:%line\\\\) - %msg%n\"]}],[\"$\",\"span\",\"code-segement12\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement13\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"pattern\"]}],[\"$\",\"span\",\"code-segement14\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement15\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement16\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement17\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement18\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"encoder\"]}],[\"$\",\"span\",\"code-segement19\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}]]]}]}]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":\"註：\"}],\"\\n\",[\"$\",\"ul\",null,{\"className\":\"mdx-components_list__QQ4ZN\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"呢度既 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\":-\"}],\" 係用黎分隔 key、value 既字符，佢既前面係 MDC key，後面係 value。\",\"\\n\",[\"$\",\"ul\",null,{\"className\":\"mdx-components_list__QQ4ZN\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"佢同 Spring 既 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\":\"}],\" 一樣意思，只不過係 Logback 揀左用 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\":-\"}],\"。\"]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"%X{key:-}\"}],\" 既意思係如果 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"key\"}],\" 呢個 MDC key 未有 data 既話就會出 empty string（唔好誤以為會出 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"-\"}],\"）。\"]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"%X{key:-foo}\"}],\" 既意思係如果 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"key\"}],\" 呢個 MDC key 未有 data 既話就會出 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"foo\"}],\"。\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"hr\",null,{\"className\":\"mdx-components_hr__o_oFr\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"332-logstash-logback-encoder\",\"className\":\"mdx-components_heading__HrNl3\",\"style\":{\"zIndex\":3030200},\"children\":\"3.3.2 Logstash Logback Encoder\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":[\"如果係用 Logstash Logback Encoder，亦即係 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"net.logstash.logback:logstash-logback-encoder\"}],\" 既 Maven dependency，咁我地就要用佢既 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"includeMdcKeyName\"}],\" XML element 去加入 trace ID 以及 span ID：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"mdx-components_code__3gNm1\",\"style\":{\"color\":\"black\",\"background\":\"#f5f2f0\",\"textShadow\":\"0 1px white\",\"fontFamily\":\"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace\",\"fontSize\":\"1em\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"wordWrap\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"4\",\"OTabSize\":\"4\",\"tabSize\":\"4\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\",\"padding\":\"1em\",\"margin\":\".5em 0\",\"overflow\":\"auto\"},\"children\":[\"$\",\"code\",null,{\"className\":\"language-xml\",\"style\":{\"whiteSpace\":\"pre\",\"color\":\"black\",\"background\":\"none\",\"textShadow\":\"0 1px white\",\"fontFamily\":\"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace\",\"fontSize\":\"1em\",\"textAlign\":\"left\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"wordWrap\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"4\",\"OTabSize\":\"4\",\"tabSize\":\"4\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\"},\"children\":[false,[[\"$\",\"span\",\"code-segement0\",{\"className\":\"token\",\"style\":{\"color\":\"slategray\"},\"children\":[\"\u003c!-- 喺 appender 裡面 --\u003e\"]}],[\"$\",\"span\",\"code-segement1\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement2\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement3\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement4\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"encoder\"]}],[\"$\",\"span\",\"code-segement5\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement6\",{\"className\":\"token\",\"style\":{\"color\":\"#690\"},\"children\":[\"class\"]}],[\"$\",\"span\",\"code-segement7\",{\"className\":\"token attr-equals\",\"style\":{\"color\":\"#999\"},\"children\":[\"=\"]}],[\"$\",\"span\",\"code-segement8\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\\\"\"]}],[\"$\",\"span\",\"code-segement9\",{\"className\":\"token\",\"style\":{\"color\":\"#07a\"},\"children\":[\"net.logstash.logback.encoder.LogstashEncoder\"]}],[\"$\",\"span\",\"code-segement10\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\\\"\"]}],[\"$\",\"span\",\"code-segement11\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement12\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement13\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\t\"]}],[\"$\",\"span\",\"code-segement14\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement15\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"includeContext\"]}],[\"$\",\"span\",\"code-segement16\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement17\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"false\"]}],[\"$\",\"span\",\"code-segement18\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement19\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"includeContext\"]}],[\"$\",\"span\",\"code-segement20\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement21\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement22\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\t\"]}],[\"$\",\"span\",\"code-segement23\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement24\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"includeMdcKeyName\"]}],[\"$\",\"span\",\"code-segement25\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement26\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"traceId\"]}],[\"$\",\"span\",\"code-segement27\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement28\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"includeMdcKeyName\"]}],[\"$\",\"span\",\"code-segement29\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement30\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement31\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\t\"]}],[\"$\",\"span\",\"code-segement32\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement33\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"includeMdcKeyName\"]}],[\"$\",\"span\",\"code-segement34\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement35\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"spanId\"]}],[\"$\",\"span\",\"code-segement36\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement37\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"includeMdcKeyName\"]}],[\"$\",\"span\",\"code-segement38\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement39\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement40\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\t\"]}],[\"$\",\"span\",\"code-segement41\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c\"]}],[\"$\",\"span\",\"code-segement42\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"customFields\"]}],[\"$\",\"span\",\"code-segement43\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement44\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"{ \\\"host\\\": \\\"${hostname:-}\\\", \\\"app_name\\\": \\\"${app_name:-}\\\" }\"]}],[\"$\",\"span\",\"code-segement45\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement46\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"customFields\"]}],[\"$\",\"span\",\"code-segement47\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}],[\"$\",\"span\",\"code-segement48\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\r\\n\"]}],[\"$\",\"span\",\"code-segement49\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement50\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003c/\"]}],[\"$\",\"span\",\"code-segement51\",{\"className\":\"token\",\"style\":{\"color\":\"#905\"},\"children\":[\"encoder\"]}],[\"$\",\"span\",\"code-segement52\",{\"className\":\"token\",\"style\":{\"color\":\"#999\"},\"children\":[\"\u003e\"]}]]]}]}]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":[\"加左之後，每一個 log entry 既 JSON data 裡面都會多左 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"traceId\"}],\" 以及 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"spanId\"}],\" 既 key-value pairs。\"]}],\"\\n\",[\"$\",\"hr\",null,{\"className\":\"mdx-components_hr__o_oFr\"}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"4-測試\",\"className\":\"mdx-components_heading__HrNl3\",\"style\":{\"zIndex\":4000000},\"children\":\"4 測試\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"41-本地測試\",\"className\":\"mdx-components_heading__HrNl3\",\"style\":{\"zIndex\":4010000},\"children\":\"4.1 本地測試\"}],\"\\n\",[\"$\",\"ol\",null,{\"className\":\"mdx-components_list__QQ4ZN\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":\"我地需要 set up 至少兩個 Spring Boot microservices。\"}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":\"全部 microservices 都要 expose 至少一個 HTTP REST endpoints。\"}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"除左最後一個只會被 call 但唔會 initiate call 既 microservice，我地要為所有作為 upstream 既其他 microservices 寫 HTTP call 既 code。\",\"\\n\",[\"$\",\"ul\",null,{\"className\":\"mdx-components_list__QQ4ZN\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":\"HTTP REST call flow：Service A ➜ Service B ➜ Service C 等等。\"}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"HTTP REST call 既 implementation 可以係 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"RestTemplate\"}],\"、\",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"WebClient\"}],\"、\",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"RestClient\"}],\" 或者 OpenFeign。\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":\"用 cURL call Service A 既 HTTP REST endpoint。\"}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"檢查所有 microservices 既 console logs。\",\"\\n\",[\"$\",\"ul\",null,{\"className\":\"mdx-components_list__QQ4ZN\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"應該會見到只有一個 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"32\"}],\" 個位長度 alphanumeric 既 trace ID。\"]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"應該會見到每個 microservice 都有啲唔同既 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"16\"}],\" 個位長度 alphanumeric 既 span IDs。\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":\"再用 cURL call Service A 既 HTTP REST endpoint。\"}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"再檢查所有 microservices 既 console logs。\",\"\\n\",[\"$\",\"ul\",null,{\"className\":\"mdx-components_list__QQ4ZN\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":\"應該會見到一個完全唔同既 trace ID。\"}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":\"應該會見到每個 microservice 又有啲唔同既 span IDs。\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"hr\",null,{\"className\":\"mdx-components_hr__o_oFr\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"42-測試發送-logs-去-elk\",\"className\":\"mdx-components_heading__HrNl3\",\"style\":{\"zIndex\":4020000},\"children\":\"4.2 測試發送 logs 去 ELK\"}],\"\\n\",[\"$\",\"ol\",null,{\"className\":\"mdx-components_list__QQ4ZN\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":\"我地需要 set up 至少兩個 Spring Boot microservices。\"}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"我地要配置好全部 microservices 既 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"logback.xml\"}],\"，將 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"\u003cappender\u003e\"}],\" 既 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"\u003cdestination\u003e\"}],\" 配置為 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"127.0.0.1:5000\"}],\"，咁啲 logs 就會發送到本地部署既 Logstash。\"]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":\"全部 microservices 都要 expose 至少一個 HTTP REST endpoints。\"}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"除左最後一個只會被 call 但唔會 initiate call 既 microservice，我地要為所有作為 upstream 既其他 microservices 寫 HTTP call 既 code。\",\"\\n\",[\"$\",\"ul\",null,{\"className\":\"mdx-components_list__QQ4ZN\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":\"HTTP REST call flow：Service A ➜ Service B ➜ Service C 等等。\"}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"HTTP REST call 既 implementation 可以係 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"RestTemplate\"}],\"、\",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"WebClient\"}],\"、\",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"RestClient\"}],\" 或者 OpenFeign。\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":\"用 cURL call Service A 既 HTTP REST endpoint。\"}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"打開 \",[\"$\",\"span\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"http://localhost:5601\",\"target\":\"_blank\",\"rel\":\"external nofollow noopener noreferrer\",\"className\":\"mdx-components_anchor__j2fDs\",\"children\":\"http://localhost:5601\"}]}],\" 檢查我地喺 Kibana 既 data view。\",\"\\n\",[\"$\",\"ul\",null,{\"className\":\"mdx-components_list__QQ4ZN\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"應該會見到只有一個 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"32\"}],\" 個位長度 alphanumeric 既 trace ID。\"]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"應該會見到每個 microservice 都有啲唔同既 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"16\"}],\" 個位長度 alphanumeric 既 span IDs。\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":\"再用 cURL call Service A 既 HTTP REST endpoint。\"}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"再打開 \",[\"$\",\"span\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"http://localhost:5601\",\"target\":\"_blank\",\"rel\":\"external nofollow noopener noreferrer\",\"className\":\"mdx-components_anchor__j2fDs\",\"children\":\"http://localhost:5601\"}]}],\" 檢查我地喺 Kibana 既 data view。\",\"\\n\",[\"$\",\"ul\",null,{\"className\":\"mdx-components_list__QQ4ZN\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":\"應該會見到一個完全唔同既 trace ID。\"}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":\"應該會見到每個 microservice 又有啲唔同既 span IDs。\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"我地可以撳落 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"traceId\"}],\" column 既某一個 cell value 隔籬既 \",[\"$\",\"code\",null,{\"className\":\"undefined mdx-components_normal-code__lOvs9\",\"children\":\"⊕\"}],\" 號（「Filter for this traceId」），咁就可以睇曬所有同呢個 trace ID 有關係既 logs。\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"mdx-components_paragraph__AUxxF\",\"children\":[\"$\",\"img\",null,{\"src\":\"/e2-next/blog/2024-03/spring-boot-micrometer-tracing/kibana-search-logs-with-traceId.png\",\"className\":\"mdx-components_image__4jSiz\"}]}],\"\\n\",[\"$\",\"hr\",null,{\"className\":\"mdx-components_hr__o_oFr\"}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"5-參考資料\",\"className\":\"mdx-components_heading__HrNl3\",\"style\":{\"zIndex\":5000000},\"children\":\"5 參考資料\"}],\"\\n\",[\"$\",\"ul\",null,{\"className\":\"mdx-components_list__QQ4ZN\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"$\",\"span\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://spring.io/blog/2022/10/12/observability-with-spring-boot-3\",\"target\":\"_blank\",\"rel\":\"external nofollow noopener noreferrer\",\"className\":\"mdx-components_anchor__j2fDs\",\"children\":\"Spring 官方 blog - Observability with Spring Boot 3\"}]}]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"$\",\"span\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://docs.spring.io/spring-framework/reference/integration/observability.html\",\"target\":\"_blank\",\"rel\":\"external nofollow noopener noreferrer\",\"className\":\"mdx-components_anchor__j2fDs\",\"children\":\"Spring 官方文檔 - Observability Support\"}]}]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"$\",\"span\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/logfellow/logstash-logback-encoder?tab=readme-ov-file#mdc-fields\",\"target\":\"_blank\",\"rel\":\"external nofollow noopener noreferrer\",\"className\":\"mdx-components_anchor__j2fDs\",\"children\":\"GitHub - logfellow/logstash-logback-encoder - Logstash Logback Encoder - MDC fields\"}]}]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"$\",\"span\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://opentelemetry.io/docs/concepts/signals/traces/\",\"target\":\"_blank\",\"rel\":\"external nofollow noopener noreferrer\",\"className\":\"mdx-components_anchor__j2fDs\",\"children\":\"OpenTelemetry - Traces\"}]}]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"mdx-components_list-item__fJ1NL\",\"children\":[\"$\",\"span\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/w3c/trace-context/blob/main/spec/20-http_request_header_format.md\",\"target\":\"_blank\",\"rel\":\"external nofollow noopener noreferrer\",\"className\":\"mdx-components_anchor__j2fDs\",\"children\":\"GitHub - w3c/trace-context - Trace Context HTTP Request Headers Format\"}]}]}],\"\\n\"]}]],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/e2-next/_next/static/css/f4caa29e750fdc73.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}]]}],{},null,false]},null,false]},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"h8MyZ__Rdjt07GadEPlZU\",{\"children\":[[\"$\",\"$Ld\",null,{\"children\":\"$Le\"}],[\"$\",\"$Lf\",null,{\"children\":\"$L10\"}],null]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$11\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"a:{}\n"])</script><script>self.__next_f.push([1,"10:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\ne:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Michael Chung's e-Portfolio\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Powered by Next.js and React\"}],[\"$\",\"link\",\"3\",{\"rel\":\"icon\",\"href\":\"/e2-next/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"48x48\"}]]\n"])</script><script>self.__next_f.push([1,"c:null\n"])</script></body></html>