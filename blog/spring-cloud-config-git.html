<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/e2-next/_next/static/css/d3df112486f97f47.css" data-precedence="next"/><link rel="stylesheet" href="/e2-next/_next/static/css/c3624a693ae5a0c4.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/e2-next/_next/static/chunks/webpack-f088da4552bcc253.js"/><script src="/e2-next/_next/static/chunks/4bd1b696-120f4d9c40d223dd.js" async=""></script><script src="/e2-next/_next/static/chunks/1517-c8d232d43a11224c.js" async=""></script><script src="/e2-next/_next/static/chunks/main-app-05c45cc8f30d6cea.js" async=""></script><script src="/e2-next/_next/static/chunks/7829-b7b9eb1dbe0d40e4.js" async=""></script><script src="/e2-next/_next/static/chunks/2153-45fd9844831c6348.js" async=""></script><script src="/e2-next/_next/static/chunks/app/layout-ea91c2d128ec48c2.js" async=""></script><script src="/e2-next/_next/static/chunks/app/page-c8b940db14fac9a0.js" async=""></script><title>Michael Chung&#x27;s e-Portfolio</title><meta name="description" content="Powered by Next.js and React"/><link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&amp;display=swap" rel="stylesheet"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"/><script src="/e2-next/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><div class="vstack gap-5"><div class="text-center vstack gap-5"><div><code class="SiteHeader_name__cwQmL">Chung Cheuk Hang Michael</code><code class="SiteHeader_title__CCfvI">Java Web Developer</code></div><nav class="justify-content-center navbar navbar-expand-md navbar-dark"><button type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="justify-content-center navbar-collapse collapse"><div class="justify-content-center navbar-nav nav-underline"><div class="nav-item"><a draggable="false" data-rr-ui-event-key="/" class="nav-link" href="/e2-next">Home</a></div><div class="nav-item"><a draggable="false" data-rr-ui-event-key="/work" class="nav-link" href="/e2-next/work">Work</a></div><div class="nav-item"><a draggable="false" data-rr-ui-event-key="/hobbyProjects" class="nav-link" href="/e2-next/hobbyProjects">Hobby projects</a></div><div class="nav-item"><a draggable="false" data-rr-ui-event-key="/personality" class="nav-link" href="/e2-next/personality">Personality</a></div><div class="nav-item"><a draggable="false" data-rr-ui-event-key="/blog" class="nav-link" href="/e2-next/blog">Blog</a></div></div></div></nav></div><h1>1 Spring Cloud Config 簡介</h1>
<p>Spring Cloud Config 既出現係為左針對喺雲端上運行既 apps 實現 config externalization，即係將 app 既配置綜合存放喺一個地方，例如係一個只負責存放 app 配置檔案既 Git repo，然後用一個 config server 去讀取呢個 Git repo 裡面既 app 配置檔案，當 app 開始運行，佢第一件會做既事就係從 config server 下載 app 配置，然後再用呢啲配置去初始化，例如係連接數據庫。</p>
<h2>1.1 Externalize 配置</h2>
<p>將配置檔案存放喺另一個 Git repo 既好處：</p>
<ul>
<li>配置係會因時間而改變，我地冇理由只係因為配置檔有改動而重新 build 過個 artifact。<!-- -->
<ul>
<li>視乎 CI pipeline（如 Jenkins）既步驟數量以及複雜程度，所需時間可以好長。<!-- -->
<ul>
<li>有啲大公司會喺 pipeline 加入 code scan plugins，例如 SonarQube、Snyk、Fortify，呢啲 code scan 工具都需要唔少時間，亦有可能會因為呢啲 code scan 工具既資料庫更新，突然多左一啲 vulnerabilities 而令 pipeline 執行失敗。</li>
<li>如果 pipeline 係 deploy 上 public cloud，視乎雲端平台、雲端技術以及雲端平台既硬件資源，部署所需時間可能需要幾分鐘，慢過喺本地用 JVM 運行個 app。</li>
</ul>
</li>
</ul>
</li>
<li>如果我地將配置存放喺另一個地方，咁我地只需要重新啟動個 app，或者 call Spring Boot Actuator 提供既 API，就可以刷新 app 既配置，方便快捷。</li>
</ul>
<p>參考資料：</p>
<ul>
<li><a href="https://reflectoring.io/externalize-configuration/#configuration-servers">Build Once, Run Anywhere: Externalize Your Configuration</a></li>
</ul>
<hr/>
<h2>1.2 關於 12-Factor 既 Config</h2>
<p>12-Factor App 係為現代既 cloud apps 而訂立既開發規範。有人認為 Spring Cloud Config 達到 12-Factor App 既其中一項規範——Config。</p>
<blockquote>
<p>12 Factor implies that you should not store your configuration in a file in your application.</p>
<p>But you can source those configs using other tools</p>
<ul>
<li>Puppet</li>
<li>Kubernetes ConfigMaps</li>
<li>Spring&#x27;s configuration server</li>
<li>Databases/Data</li>
</ul>
<p>Why bother? It reduces the likelihood of developers accidentally committing/sharing secret credentials. You ensure that your application/service does not have logic switching based on the environment.</p>
</blockquote>
<p>參考資料：</p>
<ul>
<li><a href="https://dkbrummitt.com/hw/2019/08/12/12-factor/">12 Factor Apps</a>（<a href="https://web.archive.org/web/20230503055645/https://dkbrummitt.com/hw/2019/08/12/12-factor/">備用一</a>／<a href="https://archive.ph/ki0JP">備用二</a>）</li>
</ul>
<hr/>
<h1>2 設定 Git 配置 repo</h1>
<h2>2.1 建立 GitHub repo</h2>
<p>先建立一個全新既 GitHub repo，內容如下：</p>
<ul>
<li><code>/spring-cloud-config-client-demo</code>
<ul>
<li><code>spring-cloud-config-client-demo-dev.yml</code></li>
</ul>
</li>
</ul>
<p><code>spring-cloud-config-client-demo-dev.yml</code>：</p>
<pre><code class="language-yaml">my:
    prop: Hello GitHub!
</code></pre>
<hr/>
<h2>2.2 使用 SSH</h2>
<pre><code class="language-bash">ssh-keyscan -t ecdsa github.com
ssh-keygen -t ecdsa -b 256 -m PEM -f keyfile
</code></pre>
<p>我地要將條 SSH public key（<code>keyfile.pub</code>）加落個 Git repo 度，而條 SSH private key（<code>keyfile</code>）就要放喺 config server 既配置度。</p>
<hr/>
<h2>2.3 Clone Git repo</h2>
<pre><code class="language-bat">:: Windows Command Prompt
SET &quot;GIT_SSH_COMMAND=ssh -i keyfile -o IdentitiesOnly=yes&quot;
git clone ssh://git@github.com/blackr1234/spring-cloud-config-demo.git
</code></pre>
<hr/>
<h1>3 動手寫</h1>
<p>我地會用到 Spring Cloud Dependencies 黎做 dependency management，而 Spring Cloud Config Server 又會引入 Spring Boot Starter Web 既 dependency。</p>
<h2>3.1 Config server</h2>
<p>Project structure：</p>
<ul>
<li><code>src/main/java</code>
<ul>
<li><code>/code</code>
<ul>
<li><code>MainConfigServerApp.java</code></li>
</ul>
</li>
</ul>
</li>
<li><code>src/main/resources</code>
<ul>
<li><code>application.yml</code></li>
<li><code>bootstrap.yml</code></li>
</ul>
</li>
</ul>
<h3>3.1.1 Maven dependencies</h3>
<pre><code class="language-xml">&lt;dependencyManagement&gt;
	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
			&lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
			&lt;version&gt;Hoxton.SR12&lt;/version&gt;
			&lt;type&gt;pom&lt;/type&gt;
			&lt;scope&gt;import&lt;/scope&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;
			&lt;version&gt;2.3.12.RELEASE&lt;/version&gt;
			&lt;type&gt;pom&lt;/type&gt;
			&lt;scope&gt;import&lt;/scope&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;
&lt;/dependencyManagement&gt;

&lt;dependencies&gt;
	&lt;dependency&gt;
		&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
		&lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt;
	&lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
<hr/>
<h3>3.1.2 Java code</h3>
<p><code>MainConfigServerApp.java</code>：</p>
<pre><code class="language-java">@EnableConfigServer
@SpringBootApplication
public class MainConfigServerApp {

    public static void main(String[] args) {
        SpringApplication.run(MainConfigServerApp.class);
    }
}
</code></pre>
<hr/>
<h3>3.1.3 Bootstrap 配置</h3>
<p><code>bootstrap.yml</code>：</p>
<pre><code class="language-yaml">encrypt:
    key: michael ## or use the ENCRYPT_KEY environment variable

spring:
    cloud:
        config:
            server:
                encrypt:
                    enabled: true
</code></pre>
<hr/>
<h3>3.1.4 Application 配置</h3>
<p><code>application.yml</code>：</p>
<pre><code class="language-yaml">server:
    port: 8889

spring:
    cloud:
        config:
            server:
                git:
                    clone-on-start: true
                    refresh-rate: 10
                    ignore-local-ssh-settings: true
                    uri: git@github.com:blackr1234/spring-cloud-config-demo.git
                    default-label: master
                    search-paths:
                        - &quot;{application}&quot;
                    host-key: &quot;AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEmKSENjQEezOmxkZMy7opKgwFB9nkt5YRrYMjNuG5N87uRgg6CLrbo5wAdT/y6v0mKV0U2w0WZ2YB/++Tpockg=&quot;
                    host-key-algorithm: ecdsa-sha2-nistp256
                    private-key: |
                        -----BEGIN EC PRIVATE KEY-----
                        MHcCAQEEIPnupl8oxl0Wj6xfOd/PobBG48m3pVkmubPem1XSyexEoAoGCCqGSM49
                        AwEHoUQDQgAEUGO+DDpbpsgp3C+H68iTTaklmcnk2MSbbh4bwQVnMws09eqFqvA4
                        RzcTRtAXt2IWkq4JHUg6rtjDnc/0zwSQyQ==
                        -----END EC PRIVATE KEY-----
</code></pre>
<p>註：</p>
<ul>
<li><code>spring.cloud.config.server.git.host-key</code> 係 GitHub 既 host key，除非改用 GitLab 或者用其他 host key algorithm。</li>
<li><code>spring.cloud.config.server.git.host-key-algorithm</code> 要對應返我地喺 <a href="#22-%E4%BD%BF%E7%94%A8-ssh">2.2 使用 SSH</a> 生成 key 所使用既 command。</li>
<li><code>spring.cloud.config.server.git.private-key</code> 係我地喺 <a href="#22-%E4%BD%BF%E7%94%A8-ssh">2.2 使用 SSH</a> 生成既 <code>keyfile</code> 既內容。</li>
</ul>
<hr/>
<h2>3.2 Config client</h2>
<p>Project structure：</p>
<ul>
<li><code>src/main/java</code>
<ul>
<li><code>/code</code>
<ul>
<li><code>MainConfigClientApp.java</code></li>
<li><code>MyComponent.java</code></li>
</ul>
</li>
</ul>
</li>
<li><code>src/main/resources</code>
<ul>
<li><code>application.yml</code></li>
<li><code>bootstrap.yml</code></li>
</ul>
</li>
</ul>
<h3>3.2.1 Maven dependencies</h3>
<pre><code class="language-xml">&lt;dependencyManagement&gt;
	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
			&lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
			&lt;version&gt;Hoxton.SR12&lt;/version&gt;
			&lt;type&gt;pom&lt;/type&gt;
			&lt;scope&gt;import&lt;/scope&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;
			&lt;version&gt;2.3.12.RELEASE&lt;/version&gt;
			&lt;type&gt;pom&lt;/type&gt;
			&lt;scope&gt;import&lt;/scope&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;
&lt;/dependencyManagement&gt;

&lt;dependencies&gt;
	&lt;dependency&gt;
		&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
		&lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;
	&lt;/dependency&gt;
	&lt;dependency&gt;
		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
		&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
	&lt;/dependency&gt;
	&lt;dependency&gt;
		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
		&lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
	&lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
<hr/>
<h3>3.2.2 Java code</h3>
<p><code>MainConfigClientApp.java</code>：</p>
<pre><code class="language-java">@SpringBootApplication
public class MainConfigClientApp {

    public static void main(String[] args) {
        SpringApplication.run(MainConfigClientApp.class);
    }
}
</code></pre>
<p><code>MyComponent.java</code>：</p>
<pre><code class="language-java">@Slf4j
@RefreshScope
@Component
public class MyComponent {

    @Value(&quot;${my.prop:not-found}&quot;)
    private String myProp;

    @PostConstruct
    public void init() {
        log.info(&quot;my.prop: {}&quot;, myProp);
    }

    @EventListener
    public void refresh(RefreshScopeRefreshedEvent event) {
        log.info(&quot;Refreshed class [{}].&quot;, getClass().getName());
    }
}
</code></pre>
<hr/>
<h3>3.2.3 Bootstrap 配置</h3>
<p><code>bootstrap.yml</code>：</p>
<pre><code class="language-yaml">spring:
    application:
        name: spring-cloud-config-client-demo
    profiles:
        active: dev ## should be externalized
    cloud:
        config:
            enabled: true
            uri: http://localhost:8889
</code></pre>
<hr/>
<h3>3.2.4 Application 配置</h3>
<p><code>application.yml</code>：</p>
<pre><code class="language-yaml">management:
    endpoints:
        web:
            exposure:
                include: refresh, env
</code></pre>
<hr/>
<h1>4 簡單測試</h1>
<h2>4.1 步驟</h2>
<ol>
<li>啟動 config server。</li>
<li>啟動 config client。</li>
<li>檢查 <code>my.prop</code> 既 value，應該係而家 Git 上面既 value。</li>
<li>更改 Git 上既 <code>my.prop</code> 既 value。</li>
<li>Call config client 既 <code>/actuator/refresh</code> API。<!-- -->
<ul>
<li>Response body 裡面會有一個 array，其中一個 string 就係 <code>my.prop</code>，意味住 <code>my.prop</code> 既 value 改變左。</li>
</ul>
</li>
<li>檢查 <code>my.prop</code> 既 value，應該係我地改成既新 value。</li>
</ol>
<hr/>
<h2>4.2 檢查 property value</h2>
<p>針對 <code>my.prop</code>，我地有以下既方法：</p>
<ol>
<li>Call config client 既 <code>/actuator/env</code> API，response body 會有 <code>my.prop</code> 既 value，呢個方法只需要配置好 Actuator 就可以用。</li>
<li>因為我地有特登寫 code 去做 logging，所以我地可以留意 config client 既 log 裡面 <code>my.prop</code> 既 value。</li>
</ol>
<hr/>
<h1>5 配置檔既應用次序</h1>
<p>喺 Spring，如果我地唔用 Spring Cloud Config 去 externalize 配置，咁我地個 artifact JAR 檔裡面可以有：</p>
<ol>
<li><code>application</code></li>
<li><code>application-{profile}</code></li>
</ol>
<p>因為 Spring 支援 YAML 以及 Java properties 既格式，而 YAML 格式又可以用 <code>.yaml</code> 以及 <code>.yml</code> 作為副檔名，咁我地其實最盡可以有 <code>6</code> 個檔案。</p>
<p>而如果我地用 Spring Cloud Config 去 externalize 配置，咁我地喺既 Git repo 就會有：</p>
<ol>
<li><code>application</code></li>
<li><code>{spring.application.name}</code></li>
<li><code>application-{profile}</code></li>
<li><code>{spring.application.name}-{profile}</code></li>
</ol>
<p>如果又各有 <code>yaml</code>、<code>.yml</code> 以及 <code>.properties</code> 副檔名，咁就可以有 <code>12</code> 個組合咁多既檔案。</p>
<p>經過反翻既測試，最後搵到 Spring Cloud Config 既 Git backend 讀取檔案既次序係：</p>
<ol>
<li><code>application.yaml</code></li>
<li><code>application.yml</code></li>
<li><code>application.properties</code></li>
<li><code>{spring.application.name}.yaml</code></li>
<li><code>{spring.application.name}.yml</code></li>
<li><code>{spring.application.name}.properties</code></li>
<li><code>application-{profile}.yaml</code></li>
<li><code>application-{profile}.yml</code></li>
<li><code>application-{profile}.properties</code></li>
<li><code>{spring.application.name}-{profile}.yaml</code></li>
<li><code>{spring.application.name}-{profile}.yml</code></li>
<li><code>{spring.application.name}-{profile}.properties</code></li>
</ol>
<p>解釋：</p>
<ul>
<li>呢個次序既意思係，當同一個名既配置（例如 <code>my.prop</code>）出現喺以上所有既檔案裡面，咁 Spring Cloud Config 係會以呢個次序去讀取檔案去取值，而較遲讀取既值係會覆蓋之前讀取既值。</li>
<li>Java properties 檔會「贏」過曬 YAML 格式，最終值會係黎自 Java properties 配置檔。</li>
<li>冇 <code>-{profile}</code> 既檔案就係 default profile，而特定既環境 profile 係一定會比較遲讀取，覆蓋默認既配置。</li>
</ul>
<hr/>
<h1>6 新版本</h1>
<h2>6.1 App 需要修改既地方</h2>
<h3>6.1.1 版本</h3>
<p>更新 config server 以及 config client 既 dependency managements 去以下既版本：</p>
<pre><code class="language-xml">&lt;dependencyManagement&gt;
	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;
			&lt;version&gt;2.7.0&lt;/version&gt;
			&lt;type&gt;pom&lt;/type&gt;
			&lt;scope&gt;import&lt;/scope&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
			&lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
			&lt;version&gt;2021.0.3&lt;/version&gt;
			&lt;type&gt;pom&lt;/type&gt;
			&lt;scope&gt;import&lt;/scope&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
</code></pre>
<hr/>
<h3>6.1.2 <code>bootstrap.yml</code> 合併入 <code>application.yml</code></h3>
<p>最新版既 Spring Cloud Config 已經唔再用 <code>bootstrap.yml</code> 檔，所以我地要將佢既 properties 搬去 <code>application.yml</code>。</p>
<p>不過如果真係想用返 <code>bootstrap.yml</code> 呢個舊既方式，可以加入呢個 dependency：</p>
<pre><code class="language-xml">&lt;dependency&gt;
	&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
	&lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<hr/>
<h3>6.1.3 新 <code>spring.config.import</code> 配置</h3>
<p>Spring Cloud Config client 既 <code>spring.cloud.config.uri</code> 已經被 <code>spring.config.import</code> 取代，而 value 都有所唔同：</p>
<pre><code class="language-yaml"># 舊配置，bootstrap.yml 檔
spring:
  cloud:
    config:
	  uri: http://localhost:8889

---

# 新配置，application.yml 檔
spring:
  config:
    import: &#x27;optional:configserver:http://localhost:8889&#x27;
</code></pre>
<p>註：</p>
<ul>
<li>如果唔加上 <code>optional:</code>，咁當 config client 啟動既時候連接唔到 config server，config client 就會 throw exception 並且終止運行。</li>
<li>如果加上 <code>optional:</code>
<ol>
<li>就算 config client 啟動果一刻連接唔到 config server，佢都唔會終止運行。</li>
<li>如果之後我地手動 call config client 既 <code>/actuator/refresh</code> API，而 config client 成功連接到 config server，咁佢會重新獲取配置，而有 <code>@RefreshScope</code> 既 components 都會獲得新既配置數值。</li>
</ol>
</li>
</ul>
<hr/>
<h1>7 連線容錯測試</h1>
<p>根據測試，Git backend 係可以容許連線失敗，因為 config server 會有 file cache。</p>
<h2>7.1 使用 Git backend 而 Git 連線失敗</h2>
<p>模擬連線失敗場景：</p>
<ol>
<li>啟動 config server。</li>
<li>啟動 config client。</li>
<li>呢個時候，我地可以見到 config server 會將個 Git repo clone 到一個叫 <code>config-repo-&lt;random numbers&gt;</code> 既 folder，呢個 folder 係喺我地既 JVM temp folder（e.g. <code>C:/Users/Michael/AppData/Local/Temp</code>）裡面。</li>
<li>喺 OS 層面斷開網絡。</li>
<li>重新啟動 config client，佢依然可以喺 config server 度拎到配置，咁係因為 config server 用左上面提到既 file cache。</li>
</ol>
<hr/>
<h1>8 參考資料</h1>
<ul>
<li><a href="https://blog.csdn.net/qq_20597727/article/details/82465069">Spring Cloud Config 使用與原理分析</a>（<a href="https://web.archive.org/web/20230503105421/https://blog.csdn.net/qq_20597727/article/details/82465069">備用一</a>／<a href="https://archive.ph/hTqbk">備用二</a>）</li>
<li><a href="https://medium.com/javarevisited/lets-learn-together-sessions-spring-cloud-config-server-17ecd171d86">Let’s Learn Together Sessions: Spring Cloud Config Server</a></li>
<li><a href="https://stackoverflow.com/questions/67507452/no-spring-config-import-property-has-been-defined/70813003#70813003">StackOverflow - No spring.config.import property has been defined</a></li>
<li><a href="https://spring.io/blog/2020/12/22/spring-cloud-2020-0-0-aka-ilford-is-available">Spring 官方 blog - Spring Cloud 2020.0.0 (aka Ilford) Is Available</a>
<ul>
<li>
<blockquote>
<p>NOTE: Bootstrap has been disabled by default. The new way of importing configuration is via the new <code>spring.config.import</code> functionality provided by Spring Boot 2.4.</p>
</blockquote>
</li>
<li>
<blockquote>
<p>If you require the legacy bootstrap functionality add the <code>org.springframework.cloud:spring-cloud-starter-bootstrap</code> dependency to your project.</p>
</blockquote>
</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-cloud-config/docs/current/reference/html/#config-first-bootstrap">Spring Cloud Config - Config First Bootstrap</a>
<ul>
<li>
<blockquote>
<p>Spring Boot 2.4 introduced a new way to import configuration data via the spring.config.import property. This is now the default way to bind to Config Server.</p>
<p>To optionally connect to config server set the following in application.properties:</p>
<p><strong>application.properties</strong></p>
<pre><code class="language-java">spring.config.import=optional:configserver:
</code></pre>
</blockquote>
</li>
</ul>
</li>
</ul>
<p>延伸閱讀：</p>
<ul>
<li><a href="https://spring.io/blog/2020/08/14/config-file-processing-in-spring-boot-2-4">Spring 官方 blog - Config file processing in Spring Boot 2.4</a></li>
</ul><hr/><div class="vstack gap-3"><div class="text-center container"><div class="justify-content-center g-3 row row-cols-md-3 row-cols-sm-2 row-cols-1"><div class="col"><a target="_blank" rel="external nofollow noopener noreferrer" class="SiteFooter_contact-item__2JRRr card" href="tel:+85263301333"><div class="card-body"><div class="card-title h5"><i class="fa-solid fa-phone" style="color:#009688"></i></div><p class="text-muted card-text">6330 1333<!-- --> </p></div></a></div><div class="col"><a target="_blank" rel="external nofollow noopener noreferrer" class="SiteFooter_contact-item__2JRRr card" href="mailto:michaelboyboy@gmail.com"><div class="card-body"><div class="card-title h5"><i class="fa-solid fa-envelope" style="color:#f44336"></i></div><p class="text-muted card-text">michaelboyboy@gmail.com<!-- --> </p></div></a></div><div class="col"><a target="_blank" rel="external nofollow noopener noreferrer" class="SiteFooter_contact-item__2JRRr card" href="https://www.linkedin.com/in/mickchung"><div class="card-body"><div class="card-title h5"><i class="fa-brands fa-linkedin" style="color:#2196f3"></i></div><p class="text-muted card-text">www.linkedin.com/in/mickchung<!-- --> </p></div></a></div></div></div></div></div><script src="/e2-next/_next/static/chunks/webpack-f088da4552bcc253.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[8287,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"2153\",\"static/chunks/2153-45fd9844831c6348.js\",\"7177\",\"static/chunks/app/layout-ea91c2d128ec48c2.js\"],\"default\"]\n3:I[3339,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"8974\",\"static/chunks/app/page-c8b940db14fac9a0.js\"],\"default\"]\n4:I[1367,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"2153\",\"static/chunks/2153-45fd9844831c6348.js\",\"7177\",\"static/chunks/app/layout-ea91c2d128ec48c2.js\"],\"default\"]\n5:I[5244,[],\"\"]\n6:I[3866,[],\"\"]\n7:I[4798,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"8974\",\"static/chunks/app/page-c8b940db14fac9a0.js\"],\"default\"]\n8:I[6121,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"8974\",\"static/chunks/app/page-c8b940db14fac9a0.js\"],\"default\"]\n9:I[3667,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"8974\",\"static/chunks/app/page-c8b940db14fac9a0.js\"],\"default\"]\na:I[8407,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"2153\",\"static/chunks/2153-45fd9844831c6348.js\",\"7177\",\"static/chunks/app/layout-ea91c2d128ec48c2.js\"],\"default\"]\nb:I[8173,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"8974\",\"static/chunks/app/page-c8b940db14fac9a0.js\"],\"\"]\nc:I[3197,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"2153\",\"static/chunks/2153-45fd9844831c6348.js\",\"7177\",\"static/chunks/app/layout-ea91c2d128ec48c2.js\"],\"default\"]\nd:I[7933,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"2153\",\"static/chunks/2153-45fd9844831c6348.js\",\"7177\",\"static/chunks/app/layout-ea91c2d128ec48c2.js\"],\"default\"]\ne:I[3800,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"2153\",\"static/chunks/2153-45fd9844831c6348.js\",\"7177\",\"static/chunks/app/layout-ea91c2d128ec48c2.js\"],\"default\"]\n10:I[6213,[],\"OutletBoundary\"]\n12:I[6213,[],\"MetadataBoundary\"]\n14:I[6213,[],\"ViewportBoundary\"]\n16:I[4835,[],\"\"]\n:HL[\"/e2-next/_next/static/css/d3df112486f97f47.css\",\"style\"]\n:HL[\"/e2-next/_next/static/css/c3624a693ae5a0c4.css\",\"style\"]\nf:T429,server:\r\n    port: 8889\r\n\r\nspring:\r\n    cloud:\r\n        config:\r\n            server:\r\n                git:\r\n       "])</script><script>self.__next_f.push([1,"             clone-on-start: true\r\n                    refresh-rate: 10\r\n                    ignore-local-ssh-settings: true\r\n                    uri: git@github.com:blackr1234/spring-cloud-config-demo.git\r\n                    default-label: master\r\n                    search-paths:\r\n                        - \"{application}\"\r\n                    host-key: \"AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEmKSENjQEezOmxkZMy7opKgwFB9nkt5YRrYMjNuG5N87uRgg6CLrbo5wAdT/y6v0mKV0U2w0WZ2YB/++Tpockg=\"\r\n                    host-key-algorithm: ecdsa-sha2-nistp256\r\n                    private-key: |\r\n                        -----BEGIN EC PRIVATE KEY-----\r\n                        MHcCAQEEIPnupl8oxl0Wj6xfOd/PobBG48m3pVkmubPem1XSyexEoAoGCCqGSM49\r\n                        AwEHoUQDQgAEUGO+DDpbpsgp3C+H68iTTaklmcnk2MSbbh4bwQVnMws09eqFqvA4\r\n                        RzcTRtAXt2IWkq4JHUg6rtjDnc/0zwSQyQ==\r\n                        -----END EC PRIVATE KEY-----\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"wfZ4FdS4ntgGvzjeKJhfw\",\"p\":\"/e2-next\",\"c\":[\"\",\"blog\",\"spring-cloud-config-git\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[\"(2022-06)\",{\"children\":[\"spring-cloud-config-git\",{\"children\":[\"__PAGE__\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/e2-next/_next/static/css/d3df112486f97f47.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/e2-next/_next/static/css/c3624a693ae5a0c4.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"href\":\"https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900\u0026display=swap\",\"rel\":\"stylesheet\"}],[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css\"}]]}],[\"$\",\"body\",null,{\"children\":[\"$\",\"$L2\",null,{\"children\":[\"$\",\"$L3\",null,{\"gap\":5,\"children\":[[\"$\",\"$L3\",null,{\"gap\":5,\"className\":\"text-center\",\"children\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"code\",null,{\"className\":\"SiteHeader_name__cwQmL\",\"children\":\"Chung Cheuk Hang Michael\"}],[\"$\",\"code\",null,{\"className\":\"SiteHeader_title__CCfvI\",\"children\":\"Java Web Developer\"}]]}],[\"$\",\"$L4\",null,{}]]}],[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}],[\"$\",\"hr\",null,{}],[\"$\",\"$L3\",null,{\"gap\":3,\"children\":[\"$\",\"$L7\",null,{\"className\":\"text-center\",\"children\":[\"$\",\"$L8\",null,{\"xs\":1,\"sm\":2,\"md\":3,\"className\":\"justify-content-center g-3\",\"children\":[[\"$\",\"$L9\",\"0\",{\"children\":[\"$\",\"$La\",null,{\"as\":\"$b\",\"href\":\"tel:+85263301333\",\"target\":\"_blank\",\"rel\":\"external nofollow noopener noreferrer\",\"className\":\"SiteFooter_contact-item__2JRRr\",\"children\":[\"$\",\"$Lc\",null,{\"children\":[[\"$\",\"$Ld\",null,{\"children\":[\"$\",\"i\",null,{\"className\":\"fa-solid fa-phone\",\"style\":{\"color\":\"#009688\"}}]}],[\"$\",\"$Le\",null,{\"className\":\"text-muted\",\"children\":[\"6330 1333\",\" \"]}]]}]}]}],[\"$\",\"$L9\",\"1\",{\"children\":[\"$\",\"$La\",null,{\"as\":\"$b\",\"href\":\"mailto:michaelboyboy@gmail.com\",\"target\":\"_blank\",\"rel\":\"external nofollow noopener noreferrer\",\"className\":\"SiteFooter_contact-item__2JRRr\",\"children\":[\"$\",\"$Lc\",null,{\"children\":[[\"$\",\"$Ld\",null,{\"children\":[\"$\",\"i\",null,{\"className\":\"fa-solid fa-envelope\",\"style\":{\"color\":\"#f44336\"}}]}],[\"$\",\"$Le\",null,{\"className\":\"text-muted\",\"children\":[\"michaelboyboy@gmail.com\",\" \"]}]]}]}]}],[\"$\",\"$L9\",\"2\",{\"children\":[\"$\",\"$La\",null,{\"as\":\"$b\",\"href\":\"https://www.linkedin.com/in/mickchung\",\"target\":\"_blank\",\"rel\":\"external nofollow noopener noreferrer\",\"className\":\"SiteFooter_contact-item__2JRRr\",\"children\":[\"$\",\"$Lc\",null,{\"children\":[[\"$\",\"$Ld\",null,{\"children\":[\"$\",\"i\",null,{\"className\":\"fa-brands fa-linkedin\",\"style\":{\"color\":\"#2196f3\"}}]}],[\"$\",\"$Le\",null,{\"className\":\"text-muted\",\"children\":[\"www.linkedin.com/in/mickchung\",\" \"]}]]}]}]}]]}]}]}]]}]}]}]]}]]}],{\"children\":[\"blog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"(2022-06)\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"(2022-06)\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"spring-cloud-config-git\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"(2022-06)\",\"children\",\"spring-cloud-config-git\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"h1\",null,{\"children\":\"1 Spring Cloud Config 簡介\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Spring Cloud Config 既出現係為左針對喺雲端上運行既 apps 實現 config externalization，即係將 app 既配置綜合存放喺一個地方，例如係一個只負責存放 app 配置檔案既 Git repo，然後用一個 config server 去讀取呢個 Git repo 裡面既 app 配置檔案，當 app 開始運行，佢第一件會做既事就係從 config server 下載 app 配置，然後再用呢啲配置去初始化，例如係連接數據庫。\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"1.1 Externalize 配置\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"將配置檔案存放喺另一個 Git repo 既好處：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"配置係會因時間而改變，我地冇理由只係因為配置檔有改動而重新 build 過個 artifact。\",\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"視乎 CI pipeline（如 Jenkins）既步驟數量以及複雜程度，所需時間可以好長。\",\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"有啲大公司會喺 pipeline 加入 code scan plugins，例如 SonarQube、Snyk、Fortify，呢啲 code scan 工具都需要唔少時間，亦有可能會因為呢啲 code scan 工具既資料庫更新，突然多左一啲 vulnerabilities 而令 pipeline 執行失敗。\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"如果 pipeline 係 deploy 上 public cloud，視乎雲端平台、雲端技術以及雲端平台既硬件資源，部署所需時間可能需要幾分鐘，慢過喺本地用 JVM 運行個 app。\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"如果我地將配置存放喺另一個地方，咁我地只需要重新啟動個 app，或者 call Spring Boot Actuator 提供既 API，就可以刷新 app 既配置，方便快捷。\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"參考資料：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://reflectoring.io/externalize-configuration/#configuration-servers\",\"children\":\"Build Once, Run Anywhere: Externalize Your Configuration\"}]}],\"\\n\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"1.2 關於 12-Factor 既 Config\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"12-Factor App 係為現代既 cloud apps 而訂立既開發規範。有人認為 Spring Cloud Config 達到 12-Factor App 既其中一項規範——Config。\"}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"12 Factor implies that you should not store your configuration in a file in your application.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"But you can source those configs using other tools\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Puppet\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Kubernetes ConfigMaps\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Spring's configuration server\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Databases/Data\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Why bother? It reduces the likelihood of developers accidentally committing/sharing secret credentials. You ensure that your application/service does not have logic switching based on the environment.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"參考資料：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"https://dkbrummitt.com/hw/2019/08/12/12-factor/\",\"children\":\"12 Factor Apps\"}],\"（\",[\"$\",\"a\",null,{\"href\":\"https://web.archive.org/web/20230503055645/https://dkbrummitt.com/hw/2019/08/12/12-factor/\",\"children\":\"備用一\"}],\"／\",[\"$\",\"a\",null,{\"href\":\"https://archive.ph/ki0JP\",\"children\":\"備用二\"}],\"）\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"2 設定 Git 配置 repo\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"2.1 建立 GitHub repo\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"先建立一個全新既 GitHub repo，內容如下：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"/spring-cloud-config-client-demo\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"spring-cloud-config-client-demo-dev.yml\"}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"spring-cloud-config-client-demo-dev.yml\"}],\"：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-yaml\",\"children\":\"my:\\r\\n    prop: Hello GitHub!\\n\"}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"2.2 使用 SSH\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-bash\",\"children\":\"ssh-keyscan -t ecdsa github.com\\r\\nssh-keygen -t ecdsa -b 256 -m PEM -f keyfile\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"我地要將條 SSH public key（\",[\"$\",\"code\",null,{\"children\":\"keyfile.pub\"}],\"）加落個 Git repo 度，而條 SSH private key（\",[\"$\",\"code\",null,{\"children\":\"keyfile\"}],\"）就要放喺 config server 既配置度。\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"2.3 Clone Git repo\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-bat\",\"children\":\":: Windows Command Prompt\\r\\nSET \\\"GIT_SSH_COMMAND=ssh -i keyfile -o IdentitiesOnly=yes\\\"\\r\\ngit clone ssh://git@github.com/blackr1234/spring-cloud-config-demo.git\\n\"}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"3 動手寫\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"我地會用到 Spring Cloud Dependencies 黎做 dependency management，而 Spring Cloud Config Server 又會引入 Spring Boot Starter Web 既 dependency。\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"3.1 Config server\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Project structure：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"src/main/java\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"/code\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"MainConfigServerApp.java\"}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"src/main/resources\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"application.yml\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"bootstrap.yml\"}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"3.1.1 Maven dependencies\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-xml\",\"children\":\"\u003cdependencyManagement\u003e\\r\\n\\t\u003cdependencies\u003e\\r\\n\\t\\t\u003cdependency\u003e\\r\\n\\t\\t\\t\u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e\\r\\n\\t\\t\\t\u003cartifactId\u003espring-cloud-dependencies\u003c/artifactId\u003e\\r\\n\\t\\t\\t\u003cversion\u003eHoxton.SR12\u003c/version\u003e\\r\\n\\t\\t\\t\u003ctype\u003epom\u003c/type\u003e\\r\\n\\t\\t\\t\u003cscope\u003eimport\u003c/scope\u003e\\r\\n\\t\\t\u003c/dependency\u003e\\r\\n\\t\\t\u003cdependency\u003e\\r\\n\\t\\t\\t\u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e\\r\\n\\t\\t\\t\u003cartifactId\u003espring-boot-dependencies\u003c/artifactId\u003e\\r\\n\\t\\t\\t\u003cversion\u003e2.3.12.RELEASE\u003c/version\u003e\\r\\n\\t\\t\\t\u003ctype\u003epom\u003c/type\u003e\\r\\n\\t\\t\\t\u003cscope\u003eimport\u003c/scope\u003e\\r\\n\\t\\t\u003c/dependency\u003e\\r\\n\\t\u003c/dependencies\u003e\\r\\n\u003c/dependencyManagement\u003e\\r\\n\\r\\n\u003cdependencies\u003e\\r\\n\\t\u003cdependency\u003e\\r\\n\\t\\t\u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e\\r\\n\\t\\t\u003cartifactId\u003espring-cloud-config-server\u003c/artifactId\u003e\\r\\n\\t\u003c/dependency\u003e\\r\\n\u003c/dependencies\u003e\\n\"}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"3.1.2 Java code\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"MainConfigServerApp.java\"}],\"：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-java\",\"children\":\"@EnableConfigServer\\r\\n@SpringBootApplication\\r\\npublic class MainConfigServerApp {\\r\\n\\r\\n    public static void main(String[] args) {\\r\\n        SpringApplication.run(MainConfigServerApp.class);\\r\\n    }\\r\\n}\\n\"}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"3.1.3 Bootstrap 配置\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"bootstrap.yml\"}],\"：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-yaml\",\"children\":\"encrypt:\\r\\n    key: michael ## or use the ENCRYPT_KEY environment variable\\r\\n\\r\\nspring:\\r\\n    cloud:\\r\\n        config:\\r\\n            server:\\r\\n                encrypt:\\r\\n                    enabled: true\\n\"}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"3.1.4 Application 配置\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"application.yml\"}],\"：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-yaml\",\"children\":\"$f\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"註：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"spring.cloud.config.server.git.host-key\"}],\" 係 GitHub 既 host key，除非改用 GitLab 或者用其他 host key algorithm。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"spring.cloud.config.server.git.host-key-algorithm\"}],\" 要對應返我地喺 \",[\"$\",\"a\",null,{\"href\":\"#22-%E4%BD%BF%E7%94%A8-ssh\",\"children\":\"2.2 使用 SSH\"}],\" 生成 key 所使用既 command。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"spring.cloud.config.server.git.private-key\"}],\" 係我地喺 \",[\"$\",\"a\",null,{\"href\":\"#22-%E4%BD%BF%E7%94%A8-ssh\",\"children\":\"2.2 使用 SSH\"}],\" 生成既 \",[\"$\",\"code\",null,{\"children\":\"keyfile\"}],\" 既內容。\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"3.2 Config client\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Project structure：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"src/main/java\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"/code\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"MainConfigClientApp.java\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"MyComponent.java\"}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"src/main/resources\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"application.yml\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"bootstrap.yml\"}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"3.2.1 Maven dependencies\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-xml\",\"children\":\"\u003cdependencyManagement\u003e\\r\\n\\t\u003cdependencies\u003e\\r\\n\\t\\t\u003cdependency\u003e\\r\\n\\t\\t\\t\u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e\\r\\n\\t\\t\\t\u003cartifactId\u003espring-cloud-dependencies\u003c/artifactId\u003e\\r\\n\\t\\t\\t\u003cversion\u003eHoxton.SR12\u003c/version\u003e\\r\\n\\t\\t\\t\u003ctype\u003epom\u003c/type\u003e\\r\\n\\t\\t\\t\u003cscope\u003eimport\u003c/scope\u003e\\r\\n\\t\\t\u003c/dependency\u003e\\r\\n\\t\\t\u003cdependency\u003e\\r\\n\\t\\t\\t\u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e\\r\\n\\t\\t\\t\u003cartifactId\u003espring-boot-dependencies\u003c/artifactId\u003e\\r\\n\\t\\t\\t\u003cversion\u003e2.3.12.RELEASE\u003c/version\u003e\\r\\n\\t\\t\\t\u003ctype\u003epom\u003c/type\u003e\\r\\n\\t\\t\\t\u003cscope\u003eimport\u003c/scope\u003e\\r\\n\\t\\t\u003c/dependency\u003e\\r\\n\\t\u003c/dependencies\u003e\\r\\n\u003c/dependencyManagement\u003e\\r\\n\\r\\n\u003cdependencies\u003e\\r\\n\\t\u003cdependency\u003e\\r\\n\\t\\t\u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e\\r\\n\\t\\t\u003cartifactId\u003espring-cloud-starter-config\u003c/artifactId\u003e\\r\\n\\t\u003c/dependency\u003e\\r\\n\\t\u003cdependency\u003e\\r\\n\\t\\t\u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e\\r\\n\\t\\t\u003cartifactId\u003espring-boot-starter-web\u003c/artifactId\u003e\\r\\n\\t\u003c/dependency\u003e\\r\\n\\t\u003cdependency\u003e\\r\\n\\t\\t\u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e\\r\\n\\t\\t\u003cartifactId\u003espring-boot-starter-actuator\u003c/artifactId\u003e\\r\\n\\t\u003c/dependency\u003e\\r\\n\u003c/dependencies\u003e\\n\"}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"3.2.2 Java code\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"MainConfigClientApp.java\"}],\"：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-java\",\"children\":\"@SpringBootApplication\\r\\npublic class MainConfigClientApp {\\r\\n\\r\\n    public static void main(String[] args) {\\r\\n        SpringApplication.run(MainConfigClientApp.class);\\r\\n    }\\r\\n}\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"MyComponent.java\"}],\"：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-java\",\"children\":\"@Slf4j\\r\\n@RefreshScope\\r\\n@Component\\r\\npublic class MyComponent {\\r\\n\\r\\n    @Value(\\\"${my.prop:not-found}\\\")\\r\\n    private String myProp;\\r\\n\\r\\n    @PostConstruct\\r\\n    public void init() {\\r\\n        log.info(\\\"my.prop: {}\\\", myProp);\\r\\n    }\\r\\n\\r\\n    @EventListener\\r\\n    public void refresh(RefreshScopeRefreshedEvent event) {\\r\\n        log.info(\\\"Refreshed class [{}].\\\", getClass().getName());\\r\\n    }\\r\\n}\\n\"}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"3.2.3 Bootstrap 配置\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"bootstrap.yml\"}],\"：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-yaml\",\"children\":\"spring:\\r\\n    application:\\r\\n        name: spring-cloud-config-client-demo\\r\\n    profiles:\\r\\n        active: dev ## should be externalized\\r\\n    cloud:\\r\\n        config:\\r\\n            enabled: true\\r\\n            uri: http://localhost:8889\\n\"}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"3.2.4 Application 配置\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"application.yml\"}],\"：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-yaml\",\"children\":\"management:\\r\\n    endpoints:\\r\\n        web:\\r\\n            exposure:\\r\\n                include: refresh, env\\n\"}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"4 簡單測試\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"4.1 步驟\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"啟動 config server。\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"啟動 config client。\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"檢查 \",[\"$\",\"code\",null,{\"children\":\"my.prop\"}],\" 既 value，應該係而家 Git 上面既 value。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"更改 Git 上既 \",[\"$\",\"code\",null,{\"children\":\"my.prop\"}],\" 既 value。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Call config client 既 \",[\"$\",\"code\",null,{\"children\":\"/actuator/refresh\"}],\" API。\",\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Response body 裡面會有一個 array，其中一個 string 就係 \",[\"$\",\"code\",null,{\"children\":\"my.prop\"}],\"，意味住 \",[\"$\",\"code\",null,{\"children\":\"my.prop\"}],\" 既 value 改變左。\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"檢查 \",[\"$\",\"code\",null,{\"children\":\"my.prop\"}],\" 既 value，應該係我地改成既新 value。\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"4.2 檢查 property value\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"針對 \",[\"$\",\"code\",null,{\"children\":\"my.prop\"}],\"，我地有以下既方法：\"]}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Call config client 既 \",[\"$\",\"code\",null,{\"children\":\"/actuator/env\"}],\" API，response body 會有 \",[\"$\",\"code\",null,{\"children\":\"my.prop\"}],\" 既 value，呢個方法只需要配置好 Actuator 就可以用。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"因為我地有特登寫 code 去做 logging，所以我地可以留意 config client 既 log 裡面 \",[\"$\",\"code\",null,{\"children\":\"my.prop\"}],\" 既 value。\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"5 配置檔既應用次序\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"喺 Spring，如果我地唔用 Spring Cloud Config 去 externalize 配置，咁我地個 artifact JAR 檔裡面可以有：\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"application\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"application-{profile}\"}]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"因為 Spring 支援 YAML 以及 Java properties 既格式，而 YAML 格式又可以用 \",[\"$\",\"code\",null,{\"children\":\".yaml\"}],\" 以及 \",[\"$\",\"code\",null,{\"children\":\".yml\"}],\" 作為副檔名，咁我地其實最盡可以有 \",[\"$\",\"code\",null,{\"children\":\"6\"}],\" 個檔案。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"而如果我地用 Spring Cloud Config 去 externalize 配置，咁我地喺既 Git repo 就會有：\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"application\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"{spring.application.name}\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"application-{profile}\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"{spring.application.name}-{profile}\"}]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"如果又各有 \",[\"$\",\"code\",null,{\"children\":\"yaml\"}],\"、\",[\"$\",\"code\",null,{\"children\":\".yml\"}],\" 以及 \",[\"$\",\"code\",null,{\"children\":\".properties\"}],\" 副檔名，咁就可以有 \",[\"$\",\"code\",null,{\"children\":\"12\"}],\" 個組合咁多既檔案。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"經過反翻既測試，最後搵到 Spring Cloud Config 既 Git backend 讀取檔案既次序係：\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"application.yaml\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"application.yml\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"application.properties\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"{spring.application.name}.yaml\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"{spring.application.name}.yml\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"{spring.application.name}.properties\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"application-{profile}.yaml\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"application-{profile}.yml\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"application-{profile}.properties\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"{spring.application.name}-{profile}.yaml\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"{spring.application.name}-{profile}.yml\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"{spring.application.name}-{profile}.properties\"}]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"解釋：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"呢個次序既意思係，當同一個名既配置（例如 \",[\"$\",\"code\",null,{\"children\":\"my.prop\"}],\"）出現喺以上所有既檔案裡面，咁 Spring Cloud Config 係會以呢個次序去讀取檔案去取值，而較遲讀取既值係會覆蓋之前讀取既值。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Java properties 檔會「贏」過曬 YAML 格式，最終值會係黎自 Java properties 配置檔。\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"冇 \",[\"$\",\"code\",null,{\"children\":\"-{profile}\"}],\" 既檔案就係 default profile，而特定既環境 profile 係一定會比較遲讀取，覆蓋默認既配置。\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"6 新版本\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"6.1 App 需要修改既地方\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"6.1.1 版本\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"更新 config server 以及 config client 既 dependency managements 去以下既版本：\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-xml\",\"children\":\"\u003cdependencyManagement\u003e\\r\\n\\t\u003cdependencies\u003e\\r\\n\\t\\t\u003cdependency\u003e\\r\\n\\t\\t\\t\u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e\\r\\n\\t\\t\\t\u003cartifactId\u003espring-boot-dependencies\u003c/artifactId\u003e\\r\\n\\t\\t\\t\u003cversion\u003e2.7.0\u003c/version\u003e\\r\\n\\t\\t\\t\u003ctype\u003epom\u003c/type\u003e\\r\\n\\t\\t\\t\u003cscope\u003eimport\u003c/scope\u003e\\r\\n\\t\\t\u003c/dependency\u003e\\r\\n\\t\\t\u003cdependency\u003e\\r\\n\\t\\t\\t\u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e\\r\\n\\t\\t\\t\u003cartifactId\u003espring-cloud-dependencies\u003c/artifactId\u003e\\r\\n\\t\\t\\t\u003cversion\u003e2021.0.3\u003c/version\u003e\\r\\n\\t\\t\\t\u003ctype\u003epom\u003c/type\u003e\\r\\n\\t\\t\\t\u003cscope\u003eimport\u003c/scope\u003e\\r\\n\\t\\t\u003c/dependency\u003e\\r\\n\\t\u003c/dependencies\u003e\\r\\n\u003c/dependencyManagement\u003e\\n\"}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"children\":[\"6.1.2 \",[\"$\",\"code\",null,{\"children\":\"bootstrap.yml\"}],\" 合併入 \",[\"$\",\"code\",null,{\"children\":\"application.yml\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"最新版既 Spring Cloud Config 已經唔再用 \",[\"$\",\"code\",null,{\"children\":\"bootstrap.yml\"}],\" 檔，所以我地要將佢既 properties 搬去 \",[\"$\",\"code\",null,{\"children\":\"application.yml\"}],\"。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"不過如果真係想用返 \",[\"$\",\"code\",null,{\"children\":\"bootstrap.yml\"}],\" 呢個舊既方式，可以加入呢個 dependency：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-xml\",\"children\":\"\u003cdependency\u003e\\r\\n\\t\u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e\\r\\n\\t\u003cartifactId\u003espring-cloud-starter-config\u003c/artifactId\u003e\\r\\n\u003c/dependency\u003e\\n\"}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"children\":[\"6.1.3 新 \",[\"$\",\"code\",null,{\"children\":\"spring.config.import\"}],\" 配置\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Spring Cloud Config client 既 \",[\"$\",\"code\",null,{\"children\":\"spring.cloud.config.uri\"}],\" 已經被 \",[\"$\",\"code\",null,{\"children\":\"spring.config.import\"}],\" 取代，而 value 都有所唔同：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-yaml\",\"children\":\"# 舊配置，bootstrap.yml 檔\\r\\nspring:\\r\\n  cloud:\\r\\n    config:\\r\\n\\t  uri: http://localhost:8889\\r\\n\\r\\n---\\r\\n\\r\\n# 新配置，application.yml 檔\\r\\nspring:\\r\\n  config:\\r\\n    import: 'optional:configserver:http://localhost:8889'\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"註：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"如果唔加上 \",[\"$\",\"code\",null,{\"children\":\"optional:\"}],\"，咁當 config client 啟動既時候連接唔到 config server，config client 就會 throw exception 並且終止運行。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"如果加上 \",[\"$\",\"code\",null,{\"children\":\"optional:\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"就算 config client 啟動果一刻連接唔到 config server，佢都唔會終止運行。\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"如果之後我地手動 call config client 既 \",[\"$\",\"code\",null,{\"children\":\"/actuator/refresh\"}],\" API，而 config client 成功連接到 config server，咁佢會重新獲取配置，而有 \",[\"$\",\"code\",null,{\"children\":\"@RefreshScope\"}],\" 既 components 都會獲得新既配置數值。\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"7 連線容錯測試\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"根據測試，Git backend 係可以容許連線失敗，因為 config server 會有 file cache。\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"7.1 使用 Git backend 而 Git 連線失敗\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"模擬連線失敗場景：\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"啟動 config server。\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"啟動 config client。\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"呢個時候，我地可以見到 config server 會將個 Git repo clone 到一個叫 \",[\"$\",\"code\",null,{\"children\":\"config-repo-\u003crandom numbers\u003e\"}],\" 既 folder，呢個 folder 係喺我地既 JVM temp folder（e.g. \",[\"$\",\"code\",null,{\"children\":\"C:/Users/Michael/AppData/Local/Temp\"}],\"）裡面。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"喺 OS 層面斷開網絡。\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"重新啟動 config client，佢依然可以喺 config server 度拎到配置，咁係因為 config server 用左上面提到既 file cache。\"}],\"\\n\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"8 參考資料\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"https://blog.csdn.net/qq_20597727/article/details/82465069\",\"children\":\"Spring Cloud Config 使用與原理分析\"}],\"（\",[\"$\",\"a\",null,{\"href\":\"https://web.archive.org/web/20230503105421/https://blog.csdn.net/qq_20597727/article/details/82465069\",\"children\":\"備用一\"}],\"／\",[\"$\",\"a\",null,{\"href\":\"https://archive.ph/hTqbk\",\"children\":\"備用二\"}],\"）\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://medium.com/javarevisited/lets-learn-together-sessions-spring-cloud-config-server-17ecd171d86\",\"children\":\"Let’s Learn Together Sessions: Spring Cloud Config Server\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://stackoverflow.com/questions/67507452/no-spring-config-import-property-has-been-defined/70813003#70813003\",\"children\":\"StackOverflow - No spring.config.import property has been defined\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"https://spring.io/blog/2020/12/22/spring-cloud-2020-0-0-aka-ilford-is-available\",\"children\":\"Spring 官方 blog - Spring Cloud 2020.0.0 (aka Ilford) Is Available\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"NOTE: Bootstrap has been disabled by default. The new way of importing configuration is via the new \",[\"$\",\"code\",null,{\"children\":\"spring.config.import\"}],\" functionality provided by Spring Boot 2.4.\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"If you require the legacy bootstrap functionality add the \",[\"$\",\"code\",null,{\"children\":\"org.springframework.cloud:spring-cloud-starter-bootstrap\"}],\" dependency to your project.\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"https://docs.spring.io/spring-cloud-config/docs/current/reference/html/#config-first-bootstrap\",\"children\":\"Spring Cloud Config - Config First Bootstrap\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"Spring Boot 2.4 introduced a new way to import configuration data via the spring.config.import property. This is now the default way to bind to Config Server.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"To optionally connect to config server set the following in application.properties:\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"application.properties\"}]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-java\",\"children\":\"spring.config.import=optional:configserver:\\n\"}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"延伸閱讀：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://spring.io/blog/2020/08/14/config-file-processing-in-spring-boot-2-4\",\"children\":\"Spring 官方 blog - Config file processing in Spring Boot 2.4\"}]}],\"\\n\"]}]],null,[\"$\",\"$L10\",null,{\"children\":\"$L11\"}]]}],{},null,false]},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"yGiOaq-nakPTxS8cI4l3A\",{\"children\":[[\"$\",\"$L12\",null,{\"children\":\"$L13\"}],[\"$\",\"$L14\",null,{\"children\":\"$L15\"}],null]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$16\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"15:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n13:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Michael Chung's e-Portfolio\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Powered by Next.js and React\"}]]\n"])</script><script>self.__next_f.push([1,"11:null\n"])</script></body></html>