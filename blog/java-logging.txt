1:"$Sreact.fragment"
2:I[8287,["7829","static/chunks/7829-b7b9eb1dbe0d40e4.js","2153","static/chunks/2153-45fd9844831c6348.js","7177","static/chunks/app/layout-ea91c2d128ec48c2.js"],"default"]
3:I[3339,["7829","static/chunks/7829-b7b9eb1dbe0d40e4.js","8974","static/chunks/app/page-c8b940db14fac9a0.js"],"default"]
4:I[1367,["7829","static/chunks/7829-b7b9eb1dbe0d40e4.js","2153","static/chunks/2153-45fd9844831c6348.js","7177","static/chunks/app/layout-ea91c2d128ec48c2.js"],"default"]
5:I[5244,[],""]
6:I[3866,[],""]
7:I[4798,["7829","static/chunks/7829-b7b9eb1dbe0d40e4.js","8974","static/chunks/app/page-c8b940db14fac9a0.js"],"default"]
8:I[6121,["7829","static/chunks/7829-b7b9eb1dbe0d40e4.js","8974","static/chunks/app/page-c8b940db14fac9a0.js"],"default"]
9:I[3667,["7829","static/chunks/7829-b7b9eb1dbe0d40e4.js","8974","static/chunks/app/page-c8b940db14fac9a0.js"],"default"]
a:I[8407,["7829","static/chunks/7829-b7b9eb1dbe0d40e4.js","2153","static/chunks/2153-45fd9844831c6348.js","7177","static/chunks/app/layout-ea91c2d128ec48c2.js"],"default"]
b:I[8173,["7829","static/chunks/7829-b7b9eb1dbe0d40e4.js","8974","static/chunks/app/page-c8b940db14fac9a0.js"],""]
c:I[3197,["7829","static/chunks/7829-b7b9eb1dbe0d40e4.js","2153","static/chunks/2153-45fd9844831c6348.js","7177","static/chunks/app/layout-ea91c2d128ec48c2.js"],"default"]
d:I[7933,["7829","static/chunks/7829-b7b9eb1dbe0d40e4.js","2153","static/chunks/2153-45fd9844831c6348.js","7177","static/chunks/app/layout-ea91c2d128ec48c2.js"],"default"]
e:I[3800,["7829","static/chunks/7829-b7b9eb1dbe0d40e4.js","2153","static/chunks/2153-45fd9844831c6348.js","7177","static/chunks/app/layout-ea91c2d128ec48c2.js"],"default"]
f:I[6213,[],"OutletBoundary"]
11:I[6213,[],"MetadataBoundary"]
13:I[6213,[],"ViewportBoundary"]
15:I[4835,[],""]
:HL["/e2-next/_next/static/css/d3df112486f97f47.css","style"]
:HL["/e2-next/_next/static/css/c3624a693ae5a0c4.css","style"]
0:{"P":null,"b":"wfZ4FdS4ntgGvzjeKJhfw","p":"/e2-next","c":["","blog","java-logging"],"i":false,"f":[[["",{"children":["blog",{"children":["(2021-09)",{"children":["java-logging",{"children":["__PAGE__",{}]}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/e2-next/_next/static/css/d3df112486f97f47.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","link","1",{"rel":"stylesheet","href":"/e2-next/_next/static/css/c3624a693ae5a0c4.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","children":[["$","head",null,{"children":[["$","link",null,{"href":"https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap","rel":"stylesheet"}],["$","link",null,{"rel":"stylesheet","href":"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"}]]}],["$","body",null,{"children":["$","$L2",null,{"children":["$","$L3",null,{"gap":5,"children":[["$","$L3",null,{"gap":5,"className":"text-center","children":[["$","div",null,{"children":[["$","code",null,{"className":"SiteHeader_name__cwQmL","children":"Chung Cheuk Hang Michael"}],["$","code",null,{"className":"SiteHeader_title__CCfvI","children":"Java Web Developer"}]]}],["$","$L4",null,{}]]}],["$","$L5",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[],[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]]],"forbidden":"$undefined","unauthorized":"$undefined"}],["$","hr",null,{}],["$","$L3",null,{"gap":3,"children":["$","$L7",null,{"className":"text-center","children":["$","$L8",null,{"xs":1,"sm":2,"md":3,"className":"justify-content-center g-3","children":[["$","$L9","0",{"children":["$","$La",null,{"as":"$b","href":"tel:+85263301333","target":"_blank","rel":"external nofollow noopener noreferrer","className":"SiteFooter_contact-item__2JRRr","children":["$","$Lc",null,{"children":[["$","$Ld",null,{"children":["$","i",null,{"className":"fa-solid fa-phone","style":{"color":"#009688"}}]}],["$","$Le",null,{"className":"text-muted","children":["6330 1333"," "]}]]}]}]}],["$","$L9","1",{"children":["$","$La",null,{"as":"$b","href":"mailto:michaelboyboy@gmail.com","target":"_blank","rel":"external nofollow noopener noreferrer","className":"SiteFooter_contact-item__2JRRr","children":["$","$Lc",null,{"children":[["$","$Ld",null,{"children":["$","i",null,{"className":"fa-solid fa-envelope","style":{"color":"#f44336"}}]}],["$","$Le",null,{"className":"text-muted","children":["michaelboyboy@gmail.com"," "]}]]}]}]}],["$","$L9","2",{"children":["$","$La",null,{"as":"$b","href":"https://www.linkedin.com/in/mickchung","target":"_blank","rel":"external nofollow noopener noreferrer","className":"SiteFooter_contact-item__2JRRr","children":["$","$Lc",null,{"children":[["$","$Ld",null,{"children":["$","i",null,{"className":"fa-brands fa-linkedin","style":{"color":"#2196f3"}}]}],["$","$Le",null,{"className":"text-muted","children":["www.linkedin.com/in/mickchung"," "]}]]}]}]}]]}]}]}]]}]}]}]]}]]}],{"children":["blog",["$","$1","c",{"children":[null,["$","$L5",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["(2021-09)",["$","$1","c",{"children":[null,["$","$L5",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","(2021-09)","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["java-logging",["$","$1","c",{"children":[null,["$","$L5",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","(2021-09)","children","java-logging","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":[[["$","h1",null,{"children":"1 Logging 簡介"}],"\n",["$","p",null,{"children":"一個程式運行既時候係咩狀態、以前處理過啲咩、有冇曾經出 exceptions，如果我地唔做 logging 就冇辦法知道，然後就唔可能有系統地去 troubleshoot 或者 debug 到個程式。"}],"\n",["$","p",null,{"children":["Java 既基礎班有教我地用 ",["$","code",null,{"children":"System.out"}]," 或者 ",["$","code",null,{"children":"System.err"}],"（同為 ",["$","code",null,{"children":"PrintStream"}]," type）既 ",["$","code",null,{"children":"println(...)"}]," 或者 ",["$","code",null,{"children":"printf(...)"}]," 去令個程式喺 runtime 時候喺 console 度顯示到 log，但問題係 console 既 log 只能喺果個 console session 仍然存在既時候 keep 到紀錄，而如果 console session 完結左，我地係冇辦法睇得返啲 log。"]}],"\n",["$","p",null,{"children":"因此，我地必須將啲 log save 落 file 度。除此之外，用 console 去做 logging 仲有唔少問題，所以就要用啲 logging libraries 去做 logging，亦需要用啲工具去幫手管理啲 log。"}],"\n",["$","hr",null,{}],"\n",["$","h1",null,{"children":"2 如何做好 logging"}],"\n",["$","p",null,{"children":"好既 logging practices 至少包括以下幾點："}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["可以自行配置格式","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"包括由邊一個 Java class 既邊一行生產出黎、生產既 timestamp 資料"}],"\n",["$","li",null,{"children":"包括額外數據（例如 microservice architecture 既 web applications 之間如果用 per-HTTP-request trace ID 溝通，日後就可以用 trace ID 追蹤到成個 flow，知道先後 call 左邊啲 microservices）。"}],"\n",["$","li",null,{"children":"一個 Java 程式可以產生多個 threads，如果係 web application 既程式而 log entry 度又冇加到 per-HTTP-request 既 trace ID 或者 session ID，我地就只能以 thread name 黎分返開啲 log，從而串連啲 log 去跟住個 flow debug。"}],"\n",["$","li",null,{"children":"可以做到 log message 只係一個 log entry"}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":["根據日期、檔案大小拆檔，並且識自動管理","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"假如我地個程式有好多野 log，亦有好多 users 用我地個 web service，咁我地個 web application 程式就可以生產到勁多 log。咁既情況下，最好係我地可以將啲 log 根據日期自動開新檔案儲存啲 log，甚或再根據檔案大小拆分檔案。"}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":["可以配合搜尋工具","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["如果我地既程式係一個提供 web service 既 web application，而我地又得一個或者一堆 log files，但冇工具去管理佢地，咁我地係好難可以搵返特定既 log 出黎，所以我地亦要用啲專門管理 log 既工具。","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["Open source 既工具有 Elastic 既 ELK stack","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"Elasticsearch - 儲存 log、搜尋引擎"}],"\n",["$","li",null,{"children":"Logstash - 讀 log、處理 log"}],"\n",["$","li",null,{"children":"Kibana - 搜尋 log 既用戶介面、視覺化或者圖像化搜尋結果"}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":"收費 cloud 既工具有 Sumo Logic"}],"\n"]}],"\n"]}],"\n"]}],"\n"]}],"\n"]}],"\n",["$","hr",null,{}],"\n",["$","h1",null,{"children":"3 Logging libraries"}],"\n",["$","p",null,{"children":"Logging 可以分為 API 以及實現既 libraries。我地可以喺程式裡面用唔同既配搭："}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"Log4j2 Core（API）、Log4j2 API（實現）"}],"\n",["$","li",null,{"children":"Slf4j（API）、Logback（實現）"}],"\n",["$","li",null,{"children":["Apache Commons Logging（API）、Log4j2（實現）","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"需要使用 Commons Logging Bridge"}],"\n"]}],"\n"]}],"\n"]}],"\n",["$","p",null,{"children":["$","img",null,{"src":"blog/2021-09/java-logging/bridging-legacy-apis.png","alt":""}]}],"\n",["$","h2",null,{"children":"3.1 Log4j2 漏洞"}],"\n",["$","p",null,{"children":["時間線：",["$","a",null,{"href":"https://orangecyberdefense.com/nl/blog/threat/log4j-vulnerability/","children":"Log4j Vulnerability"}]]}],"\n",["$","h3",null,{"children":"3.1.1 JNDI lookup 遠程代碼執行漏洞（2021 年 12 月）"}],"\n",["$","p",null,{"children":["喺 2021 年 12 月，Log4j2 畀人發現有遠程代碼執行漏洞（Log4Shell／",["$","code",null,{"children":"CVE-2021-44228"}],"）。呢個漏洞係利用 Log4j 既一個 JNDI lookup 功能。"]}],"\n",["$","p",null,{"children":["通常啲 logging libraries 都可以畀我地將 object value substitute 落帶有 ",["$","code",null,{"children":"{}"}]," placeholder 既 log message format 裡面，而如果呢個 object 係一個 JNDI URL 既 string，因為 Log4j2 本來默認左 JNDI lookup 既關係，Log4j2 就會連接到呢個 JNDI URL。如果個 JNDI URL 係一個上載喺黑客 server 上面既一個惡意 Java class 既網址，咁就有可能令到 Log4j2 call 左果個惡意網址去下載同埋執行果個惡意 Java class，從而達到最危險既資訊安全漏洞——遠程代碼執行漏洞（remote code execution）。"]}],"\n",["$","p",null,{"children":["受影響既版本由 ",["$","code",null,{"children":"2.0-beta-9"}]," 至到 ",["$","code",null,{"children":"2.14.1"}],"，然後 Apache 推出左 ",["$","code",null,{"children":"2.15.0"}]," 去解決呢個漏洞。"]}],"\n",["$","p",null,{"children":["如果冇辦法升級到最新版本，只要用既版本係 ",["$","code",null,{"children":"2.10.0"}]," 或以上，就可以能用呢啲參數："]}],"\n",["$","table",null,{"children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"style":{"textAlign":"center"},"children":"參數類別"}],["$","th",null,{"style":{"textAlign":"center"},"children":"參數名稱"}],["$","th",null,{"style":{"textAlign":"center"},"children":"參數值"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"style":{"textAlign":"center"},"children":"System property"}],["$","td",null,{"style":{"textAlign":"center"},"children":["$","code",null,{"children":"log4j2.formatMsgNoLookups"}]}],["$","td",null,{"style":{"textAlign":"center"},"children":["$","code",null,{"children":"true"}]}]]}],["$","tr",null,{"children":[["$","td",null,{"style":{"textAlign":"center"},"children":"Environment variable"}],["$","td",null,{"style":{"textAlign":"center"},"children":["$","code",null,{"children":"LOG4J_FORMAT_MSG_NO_LOOKUPS"}]}],["$","td",null,{"style":{"textAlign":"center"},"children":["$","code",null,{"children":"true"}]}]]}]]}]]}],"\n",["$","p",null,{"children":"參考資料："}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["$","a",null,{"href":"https://www.reddit.com/r/blueteamsec/comments/rd38z9/log4j_0day_being_exploited/","children":"Reddit - Log4j 0day being exploited"}]}],"\n",["$","li",null,{"children":[["$","a",null,{"href":"https://securityboulevard.com/2021/12/log4shell-jndi-injection-via-attackable-log4j/","children":"Log4Shell: JNDI Injection via Attackable Log4J"}],"（",["$","a",null,{"href":"https://web.archive.org/web/20230503012532/https://securityboulevard.com/2021/12/log4shell-jndi-injection-via-attackable-log4j/","children":"備用一"}],"／",["$","a",null,{"href":"https://archive.ph/HNwfs","children":"備用二"}],"）"]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"https://www.youtube.com/watch?v=uyq8yxWO1ls","children":"Youtube - Log4J Vulnerability (Log4Shell) Explained - for Java developers"}]}],"\n",["$","li",null,{"children":[["$","a",null,{"href":"https://www.pcmag.com/news/countless-serves-are-vulnerable-to-apache-log4j-zero-day-exploit","children":"Countless Servers Are Vulnerable to Apache Log4j Zero-Day Exploit"}],"（",["$","a",null,{"href":"https://web.archive.org/web/20230503055429/https://www.pcmag.com/news/countless-serves-are-vulnerable-to-apache-log4j-zero-day-exploit","children":"備用一"}],"／",["$","a",null,{"href":"https://archive.ph/sLjQh","children":"備用二"}],"）"]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"https://blog.cloudflare.com/inside-the-log4j2-vulnerability-cve-2021-44228/","children":"Inside the Log4j2 vulnerability (CVE-2021-44228)"}]}],"\n",["$","li",null,{"children":[["$","a",null,{"href":"https://www.anquanke.com/post/id/262668","children":"Apache Log4j2 遠程代碼執行漏洞分析"}],"（",["$","a",null,{"href":"https://web.archive.org/web/20230503012709/https://www.anquanke.com/post/id/262668","children":"備用一"}],"／",["$","a",null,{"href":"https://archive.ph/PtDnt","children":"備用二"}],"）"]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"https://spring.io/blog/2021/12/10/log4j2-vulnerability-and-spring-boot","children":"Log4J2 Vulnerability and Spring Boot"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"https://logging.apache.org/log4j/2.x/","children":"Log4j2 官網"}]}],"\n",["$","li",null,{"children":[["$","a",null,{"href":"https://www.cnblogs.com/yyhuni/p/15088134.html","children":"8u191 後的 JNDI 注入利用"}],"（",["$","a",null,{"href":"https://web.archive.org/web/20230503012839/https://www.cnblogs.com/yyhuni/p/15088134.html","children":"備用一"}],"／",["$","a",null,{"href":"https://archive.ph/03McJ","children":"備用二"}],"）"]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"https://www.youtube.com/watch?v=Y8a5nB-vy78","children":"Youtube - A Journey From JNDI/LDAP Manipulation to Remote Code Execution Dream Land"}]}],"\n"]}],"\n",["$","hr",null,{}],"\n",["$","h3",null,{"children":"3.1.2 Infinite recursion DoS 漏洞（2021 年 12 月）"}],"\n",["$","p",null,{"children":["不過之後又有人發現 Log4j2 仲有 DoS 漏洞（",["$","code",null,{"children":"CVE-2021-45105"}],"），情況就好似 iPhone 既 iMessage 輸入特定文字有機會令到個程式 crash 咁。要解決呢個問題，就要升級 Log4j2 到 ",["$","code",null,{"children":"2.17.0"}],"（到底有完沒完？）。"]}],"\n",["$","p",null,{"children":"參考資料："}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["$","a",null,{"href":"https://issues.apache.org/jira/browse/LOG4J2-3230","children":"Log4j2 JIRA - Certain strings can cause infinite recursion"}]}],"\n"]}],"\n",["$","hr",null,{}],"\n",["$","h1",null,{"children":"4 動手寫"}],"\n",["$","h2",null,{"children":"4.1 普通 Java 程式（非 Spring）"}],"\n",["$","p",null,{"children":"我地會用到 Lombok、Slf4j 以及 Logback。"}],"\n",["$","h3",null,{"children":"4.1.1 Maven dependencies"}],"\n",["$","p",null,{"children":["我地會用到 Lombok 既 ",["$","code",null,{"children":"@Slf4j"}]," annotation 去 generate construct logger object 既 code。"]}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-xml","children":"<dependencies>\r\n\r\n\t<dependency>\r\n\t\t<groupId>org.projectlombok</groupId>\r\n\t\t<artifactId>lombok</artifactId>\r\n\t\t<version>1.18.24</version>\r\n\t\t<scope>provided</scope>\r\n\t</dependency>\r\n\r\n\t<dependency>\r\n\t\t<groupId>org.slf4j</groupId>\r\n\t\t<artifactId>slf4j-api</artifactId>\r\n\t\t<version>1.7.36</version>\r\n\t</dependency>\r\n\r\n\t<dependency>\r\n\t\t<groupId>ch.qos.logback</groupId>\r\n\t\t<artifactId>logback-classic</artifactId>\r\n\t\t<version>1.2.11</version>\r\n\t</dependency>\r\n\r\n</dependencies>\n"}]}],"\n",["$","hr",null,{}],"\n",["$","h2",null,{"children":"4.2 Spring Boot web application"}],"\n",["$","p",null,{"children":"我地會用到 Spring Boot、Lombok、Slf4j 以及 Logback。"}],"\n",["$","h3",null,{"children":"4.2.1 Maven dependencies"}],"\n",["$","p",null,{"children":["我地會用到 Lombok 既 ",["$","code",null,{"children":"@Slf4j"}]," annotation 去 generate create construct object 既 code。"]}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-xml","children":"<parent>\r\n\t<groupId>org.springframework.boot</groupId>\r\n\t<artifactId>spring-boot-starter-parent</artifactId>\r\n\t<version>2.6.1</version>\r\n</parent>\r\n\r\n<dependencies>\r\n\r\n\t<dependency>\r\n\t\t<groupId>org.projectlombok</groupId>\r\n\t\t<artifactId>lombok</artifactId>\r\n\t</dependency>\r\n\r\n\t<dependency>\r\n\t\t<groupId>org.springframework.boot</groupId>\r\n\t\t<artifactId>spring-boot-starter-web</artifactId>\r\n\t</dependency>\r\n\r\n\t<dependency>\r\n\t\t<groupId>net.logstash.logback</groupId>\r\n\t\t<artifactId>logstash-logback-encoder</artifactId>\r\n\t\t<version>7.0.1</version>\r\n\t</dependency>\r\n\r\n</dependencies>\n"}]}],"\n",["$","hr",null,{}],"\n",["$","h2",null,{"children":"4.3 Logback 配置"}],"\n",["$","p",null,{"children":"喺我地既 Maven project 度建立一個配置檔："}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","code",null,{"children":"main/resources"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["$","code",null,{"children":"logback.xml"}]}],"\n"]}],"\n"]}],"\n"]}],"\n",["$","p",null,{"children":"檔案內容："}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-xml","children":"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<configuration>\r\n    <appender name=\"console\" class=\"ch.qos.logback.core.ConsoleAppender\">\r\n        <encoder>\r\n            <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} (%file:%line\\) - %msg%n</pattern>\r\n\t\t\t<charset>UTF-8</charset>\r\n        </encoder>\r\n    </appender>\r\n\r\n    <appender name=\"stash\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\r\n        <file>logs/app.log</file>\r\n\r\n        <rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\">\r\n            <fileNamePattern>logs/archived/app.%d{yyyy-MM-dd}.%i.log</fileNamePattern>\r\n            <maxHistory>30</maxHistory>\r\n            <maxFileSize>100MB</maxFileSize>\r\n            <totalSizeCap>1GB</totalSizeCap>\r\n        </rollingPolicy>\r\n\r\n        <encoder class=\"net.logstash.logback.encoder.LogstashEncoder\" />\r\n    </appender>\r\n\r\n    <root level=\"INFO\">\r\n        <appender-ref ref=\"console\" />\r\n        <appender-ref ref=\"stash\" />\r\n    </root>\r\n</configuration>\n"}]}],"\n",["$","p",null,{"children":"解釋："}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["呢度配置左 ",["$","code",null,{"children":"2"}]," 個 log appenders","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"當有 log 出現，每個 appender 都會接收到相同既 log"}],"\n",["$","li",null,{"children":["Console","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"仍然會喺 console 度出到 log，方便 local 啟動個 web application 既時候喺 IDE 或者 OS 自帶既 console（Windows 既 Command Prompt 或者 macOS 既 Terminal）睇到 log"}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":["Logstash","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["Encoder 會指定用現成黎自 ",["$","code",null,{"children":"logstash-logback-encoder"}]," 既 ",["$","code",null,{"children":"LogstashEncoder"}]]}],"\n",["$","li",null,{"children":"呢個係為左畀 Elastic 既 ELK stack 裡面既 Logstash 工具睇得明我地既 log"}],"\n",["$","li",null,{"children":"每一行都係 JSON 格式"}],"\n"]}],"\n"]}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"rollingPolicy"}]," 可以畀我地配置點樣拆分檔案，到底係根據日期（每月一個或每日一個），又或者日期 + 檔案大小。","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["Logback 提供既 implementations","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["$","code",null,{"children":"TimeBasedRollingPolicy"}]}],"\n",["$","li",null,{"children":["$","code",null,{"children":"SizeAndTimeBasedRollingPolicy"}]}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"fileNamePattern"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["用 ",["$","code",null,{"children":"TimeBasedRollingPolicy"}]," 既話，可以係以月拆分（用 ",["$","code",null,{"children":"{yyyy-MM}"}],"）或者以日拆分（用 ",["$","code",null,{"children":"{yyyy-MM-dd}"}],"）。"]}],"\n",["$","li",null,{"children":["用 ",["$","code",null,{"children":"SizeAndTimeBasedRollingPolicy"}]," 既話，需要再加上 ",["$","code",null,{"children":"%i"}],"（第幾個分檔）。"]}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"maxHistory"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"儲存最近幾耐既 log 檔"}],"\n",["$","li",null,{"children":["如果 log 檔以月拆分，呢個數字就以月計（想一個月就寫 ",["$","code",null,{"children":"1"}],"）"]}],"\n",["$","li",null,{"children":["如果 log 檔以日拆分，呢個數字就以日計（想一個月就寫 ",["$","code",null,{"children":"30"}],"）"]}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"maxFileSize"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"每個 log 檔既大小上限"}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"totalSizeCap"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"所有舊既 log 檔既大小總數上限"}],"\n",["$","li",null,{"children":"一旦超出上限，會自動刪除日期最舊既 log 檔"}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":["Logback 會先睇 ",["$","code",null,{"children":"maxHistory"}],"，之後再睇 ",["$","code",null,{"children":"totalSizeCap"}]," 去決定刪除舊既 log 檔。"]}],"\n"]}],"\n"]}],"\n"]}],"\n",["$","hr",null,{}],"\n",["$","h2",null,{"children":"4.4 寫 Java code"}],"\n",["$","p",null,{"children":["我地需要喺每個需要做 logging 既 class 加上 Lombok 既 ",["$","code",null,{"children":"@Slf4j"}]," annotation，然後用 Lombok 幫我地改好左叫 ",["$","code",null,{"children":"log"}]," 既 ",["$","code",null,{"children":"org.slf4j.Logger"}]," object 黎 log 我地既 log message。"]}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-java","children":"@Slf4j\r\n@Service\r\npublic class MyService {\r\n\r\n    public void foo() {\r\n        log.debug(\"This is DEBUG log.\");\r\n        log.info(\"This is INFO log.\");\r\n        log.trace(\"This is TRACE log.\");\r\n\r\n        try {\r\n            throw new RuntimeException();\r\n        } catch (Exception e) {\r\n            log.warn(\"This is WARN log.\", e);\r\n            log.error(\"This is ERROR log.\", e);\r\n        }\r\n    }\r\n}\n"}]}],"\n",["$","p",null,{"children":["註：如果係喺有 exception 既情況下要 log，又想包括埋 stack trace，可以喺任何一個出 log 既 method call 既最後一個 argument 畀個 ",["$","code",null,{"children":"Throwable"}]," object 佢。"]}],"\n",["$","p",null,{"children":["用左 ",["$","code",null,{"children":"@Slf4j"}]," 就可以取代一般寫法："]}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-java","children":"@Service\r\npublic class MyService {\r\n    private Logger log = LoggerFactory.getLogger(getClass());\r\n}\n"}]}],"\n",["$","hr",null,{}],"\n",["$","h1",null,{"children":"5 參考資料"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["$","a",null,{"href":"http://www.slf4j.org/legacy.html","children":"Slf4j 官網 - Bridging legacy APIs"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"http://logback.qos.ch/manual/appenders.html","children":"Logback 官網：Appenders"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"https://www.liaoxuefeng.com/wiki/1252599548343744/1264739155914176","children":"使用 SLF4J 和 Logback"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"https://www.logicbig.com/tutorials/misc/java-logging/jcl-log4j2.html","children":"Apache Commons Logging + log4j 2 Example"}]}],"\n"]}]],null,["$","$Lf",null,{"children":"$L10"}]]}],{},null,false]},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","Rx1KyDO9Y6xAiIB6jSRWi",{"children":[["$","$L11",null,{"children":"$L12"}],["$","$L13",null,{"children":"$L14"}],null]}]]}],false]],"m":"$undefined","G":["$15","$undefined"],"s":false,"S":true}
14:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
12:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Michael Chung's e-Portfolio"}],["$","meta","2",{"name":"description","content":"Powered by Next.js and React"}]]
10:null
