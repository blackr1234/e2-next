<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/e2-next/_next/static/css/d3df112486f97f47.css" data-precedence="next"/><link rel="stylesheet" href="/e2-next/_next/static/css/c3624a693ae5a0c4.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/e2-next/_next/static/chunks/webpack-f088da4552bcc253.js"/><script src="/e2-next/_next/static/chunks/4bd1b696-120f4d9c40d223dd.js" async=""></script><script src="/e2-next/_next/static/chunks/1517-c8d232d43a11224c.js" async=""></script><script src="/e2-next/_next/static/chunks/main-app-05c45cc8f30d6cea.js" async=""></script><script src="/e2-next/_next/static/chunks/7829-b7b9eb1dbe0d40e4.js" async=""></script><script src="/e2-next/_next/static/chunks/2153-45fd9844831c6348.js" async=""></script><script src="/e2-next/_next/static/chunks/app/layout-ea91c2d128ec48c2.js" async=""></script><script src="/e2-next/_next/static/chunks/app/page-c8b940db14fac9a0.js" async=""></script><title>Michael Chung&#x27;s e-Portfolio</title><meta name="description" content="Powered by Next.js and React"/><link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&amp;display=swap" rel="stylesheet"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"/><script src="/e2-next/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><div class="vstack gap-5"><div class="text-center vstack gap-5"><div><code class="SiteHeader_name__cwQmL">Chung Cheuk Hang Michael</code><code class="SiteHeader_title__CCfvI">Java Web Developer</code></div><nav class="justify-content-center navbar navbar-expand-md navbar-dark"><button type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="justify-content-center navbar-collapse collapse"><div class="justify-content-center navbar-nav nav-underline"><div class="nav-item"><a draggable="false" data-rr-ui-event-key="/" class="nav-link" href="/e2-next">Home</a></div><div class="nav-item"><a draggable="false" data-rr-ui-event-key="/work" class="nav-link" href="/e2-next/work">Work</a></div><div class="nav-item"><a draggable="false" data-rr-ui-event-key="/hobbyProjects" class="nav-link" href="/e2-next/hobbyProjects">Hobby projects</a></div><div class="nav-item"><a draggable="false" data-rr-ui-event-key="/personality" class="nav-link" href="/e2-next/personality">Personality</a></div><div class="nav-item"><a draggable="false" data-rr-ui-event-key="/blog" class="nav-link" href="/e2-next/blog">Blog</a></div></div></div></nav></div><h1>1 JMH 簡介</h1>
<p>Java Microbenchmark Harness（JMH）係一個用黎做 benchmark Java 程式既一套 library。</p>
<p>佢可以話畀我地知一個 Java method：</p>
<ul>
<li>平均需要幾長時間去執行（average time）</li>
<li>一秒鐘執行到幾多次（throughput）</li>
</ul>
<h2>1.1 使用場景</h2>
<ol>
<li>想改善某個 method 既執行速度，例如寫 algorithm。</li>
<li>想比較 Java 或者 Maven dependency 版本 upgrade 帶黎既性能差別。</li>
</ol>
<hr/>
<h1>2 動手寫</h1>
<p>Project structure：</p>
<ul>
<li><code>src/main/java</code>
<ul>
<li><code>/code</code>
<ul>
<li><code>/jmh</code>
<ul>
<li><code>/benchmarks</code>
<ul>
<li><code>AppStartupBenchmark.java</code></li>
<li><code>BenchmarkPackageRef.java</code></li>
</ul>
</li>
<li><code>JmhApplication.java</code></li>
</ul>
</li>
<li><code>ApplicationController.java</code></li>
<li><code>MainApplication.java</code></li>
</ul>
</li>
</ul>
</li>
<li><code>src/main/resources</code>
<ul>
<li><code>application.yml</code></li>
</ul>
</li>
</ul>
<h2>2.1 Maven dependencies</h2>
<pre><code class="language-xml">&lt;parent&gt;
	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
	&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
	&lt;version&gt;3.0.6&lt;/version&gt;
&lt;/parent&gt;

&lt;dependencyManagement&gt;
	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
			&lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
			&lt;version&gt;2022.0.2&lt;/version&gt;
			&lt;type&gt;pom&lt;/type&gt;
			&lt;scope&gt;import&lt;/scope&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;
&lt;/dependencyManagement&gt;

&lt;dependencies&gt;
	&lt;dependency&gt;
		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
		&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
	&lt;/dependency&gt;

	&lt;dependency&gt;
		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
		&lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
	&lt;/dependency&gt;
	&lt;dependency&gt;
		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
		&lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
	&lt;/dependency&gt;

	&lt;dependency&gt;
		&lt;groupId&gt;commons-io&lt;/groupId&gt;
		&lt;artifactId&gt;commons-io&lt;/artifactId&gt;
		&lt;version&gt;2.11.0&lt;/version&gt;
	&lt;/dependency&gt;

	&lt;dependency&gt;
		&lt;groupId&gt;org.openjdk.jmh&lt;/groupId&gt;
		&lt;artifactId&gt;jmh-core&lt;/artifactId&gt;
		&lt;version&gt;1.36&lt;/version&gt;
	&lt;/dependency&gt;
	&lt;dependency&gt;
		&lt;groupId&gt;org.openjdk.jmh&lt;/groupId&gt;
		&lt;artifactId&gt;jmh-generator-annprocess&lt;/artifactId&gt;
		&lt;version&gt;1.36&lt;/version&gt;
	&lt;/dependency&gt;
&lt;/dependencies&gt;

&lt;build&gt;
	&lt;plugins&gt;
		&lt;plugin&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
			&lt;version&gt;3.0.6&lt;/version&gt;
			&lt;configuration&gt;
				&lt;mainClass&gt;code.jmh.JmhApplication&lt;/mainClass&gt; &lt;!-- 只限測試用 --&gt;
			&lt;/configuration&gt;
			&lt;executions&gt;
				&lt;execution&gt;
					&lt;goals&gt;
						&lt;goal&gt;repackage&lt;/goal&gt;
					&lt;/goals&gt;
				&lt;/execution&gt;
			&lt;/executions&gt;
		&lt;/plugin&gt;
	&lt;/plugins&gt;
&lt;/build&gt;
</code></pre>
<hr/>
<h2>2.2 Java code</h2>
<p><code>JmhApplication.java</code>：</p>
<pre><code class="language-java">public class JmhApplication {

    public static void main(String [] args) throws Exception {

        final File resultFile = createResultFile();

        final Options opt = new OptionsBuilder()
                .include(BenchmarkPackageRef.class.getPackageName())
                .shouldDoGC(true)
                .shouldFailOnError(true)
                .resultFormat(ResultFormatType.JSON)
                .result(resultFile.getAbsolutePath())
                .build();

        new Runner(opt).run();

        printResultFile(resultFile);
    }

    private static File createResultFile() throws Exception {
        try {
            final File file = Files.createTempFile(&quot;jmh-results&quot;, &quot;.json&quot;).toFile();
            file.deleteOnExit();
            System.out.println(&quot;Created JMH result file: &quot; + file.getAbsolutePath());

            return file;
        } catch (Exception e) {
            System.err.println(&quot;Failed to create result file for JMH.&quot;);
            throw e;
        }
    }

    private static void printResultFile(File resultFile) throws Exception {
        System.out.println(&quot;Printing file content of &quot; + resultFile.getAbsolutePath() + &quot;:&quot;);
        System.out.println(FileUtils.readFileToString(resultFile, &quot;UTF-8&quot;));
    }
}
</code></pre>
<p><code>BenchmarkPackageRef.java</code>：</p>
<pre><code class="language-java">public final class BenchmarkPackageRef {

    private BenchmarkPackageRef() {}
}
</code></pre>
<p><code>AppStartupBenchmark.java</code>：</p>
<pre><code class="language-java">@Warmup(iterations = 5)
@Measurement(iterations = 20)
@State(Scope.Benchmark)
@BenchmarkMode(Mode.AverageTime)
@OutputTimeUnit(TimeUnit.MILLISECONDS)
@Threads(1)
@Fork(value = 1, jvmArgs = { &quot;-server&quot; })
public class AppStartupBenchmark {

    ConfigurableApplicationContext context;

    @Setup(Level.Invocation)
    public void init() {

    }

    @TearDown(Level.Invocation)
    public void finish() {
        if (context!=null &amp;&amp; context.isRunning()) {
            context.close();
        }
    }

    // 我地測試緊 Spring Boot startup 以及 Spring context 初始化
    @Benchmark
    public void benchmarkAppStartup() {
        context = SpringApplication.run(MainApplication.class);
        Assert.notNull(context.getBean(MyController.class), &quot;Controller bean should not be null.&quot;);
    }
}
</code></pre>
<p><code>MainApplication.java</code>：</p>
<pre><code class="language-java">@SpringBootApplication
public class MainApplication {

    public static void main(String[] args) {
        SpringApplication.run(MainApplication.class, args);
    }
}
</code></pre>
<p><code>MyController.java</code>：</p>
<pre><code class="language-java">@RestController
public class MyController {

    @GetMapping
    public String helloWorld() {
        return &quot;hello world&quot;;
    }
}
</code></pre>
<p><code>application.yml</code>：</p>
<pre><code class="language-yaml">logging.level.root: ERROR
spring.main.banner-mode: off
</code></pre>
<hr/>
<h1>3 執行 benchmark</h1>
<p>有兩個方式：</p>
<ol>
<li>IDE 裡面作為 Java app 咁執行</li>
<li>Build 左 JAR 檔之後執行</li>
</ol>
<h2>3.1 IDE 裡面執行</h2>
<p>（以下適用於 Eclipse）</p>
<p>先確保 Eclipse 有安裝到 <code>m2e-apt</code>，亦都 enable 左 annotation processing。</p>
<ol>
<li>Update 個 Maven project。</li>
<li>將 <code>JmhApplication</code> class 作為 Java app 咁執行。</li>
</ol>
<hr/>
<h2>3.2 執行 JAR artifact</h2>
<p>我地要 build 左個 JAR 檔出黎，然後執行佢：</p>
<pre><code class="language-bash">mvn clean package
</code></pre>
<pre><code class="language-bash">cd target
java -jar spring-boot-jmh-1.0.0.jar
</code></pre>
<hr/>
<h1>4 Benchmark 結果樣本</h1>
<p>註：</p>
<ul>
<li>我地用既 benchmark mode 係 average time。<!-- -->
<ul>
<li>所以 score 既單位係 <code>ms/op</code>，呢個數字係越低越好。</li>
<li>每個 iteration 執行既 operations 次數由 JMH 決定。</li>
<li>如果 benchmark mode 用 all，佢會用唔同既 benchmark mode 執行同一個 benchmark。</li>
</ul>
</li>
</ul>
<h2>4.1 Console log</h2>
<pre><code class="language-plaintext"># JMH version: 1.36
# VM version: JDK 17.0.7, OpenJDK 64-Bit Server VM, 17.0.7+7-LTS
# VM invoker: C:\Users\Michael\Desktop\Apps\msjdk17\bin\java.exe
# VM options: -server
# Blackhole mode: compiler (auto-detected, use -Djmh.blackhole.autoDetect=false to disable)
# Warmup: 5 iterations, 10 s each
# Measurement: 20 iterations, 10 s each
# Timeout: 10 min per iteration
# Threads: 1 thread, will synchronize iterations
# Benchmark mode: Average time, time/op
# Benchmark: code.jmh.benchmarks.AppStartupBenchmark.benchmarkAppStartup

# Run progress: 0.00% complete, ETA 00:04:10
# Fork: 1 of 1
# Warmup Iteration   1: 220.079 ms/op
# Warmup Iteration   2: 129.138 ms/op
# Warmup Iteration   3: 105.157 ms/op
# Warmup Iteration   4: 97.996 ms/op
# Warmup Iteration   5: 89.844 ms/op
Iteration   1: 89.442 ms/op
Iteration   2: 89.301 ms/op
Iteration   3: 87.922 ms/op
Iteration   4: 86.586 ms/op
Iteration   5: 87.189 ms/op
Iteration   6: 85.913 ms/op
Iteration   7: 88.044 ms/op
Iteration   8: 86.758 ms/op
Iteration   9: 86.637 ms/op
Iteration  10: 86.204 ms/op
Iteration  11: 87.040 ms/op
Iteration  12: 87.521 ms/op
Iteration  13: 87.171 ms/op
Iteration  14: 89.843 ms/op
Iteration  15: 85.210 ms/op
Iteration  16: 84.815 ms/op
Iteration  17: 84.768 ms/op
Iteration  18: 88.859 ms/op
Iteration  19: 84.887 ms/op
Iteration  20: 87.541 ms/op


Result &quot;code.jmh.benchmarks.AppStartupBenchmark.benchmarkAppStartup&quot;:
  87.083 ±(99.9%) 1.334 ms/op [Average]
  (min, avg, max) = (84.768, 87.083, 89.843), stdev = 1.536
  CI (99.9%): [85.749, 88.416] (assumes normal distribution)


# Run complete. Total time: 00:04:55

REMEMBER: The numbers below are just data. To gain reusable insights, you need to follow up on
why the numbers are the way they are. Use profilers (see -prof, -lprof), design factorial
experiments, perform baseline and negative tests that provide experimental control, make sure
the benchmarking environment is safe on JVM/OS/HW level, ask for reviews from the domain experts.
Do not assume the numbers tell you what you want them to tell.

NOTE: Current JVM experimentally supports Compiler Blackholes, and they are in use. Please exercise
extra caution when trusting the results, look into the generated code to check the benchmark still
works, and factor in a small probability of new VM bugs. Additionally, while comparisons between
different JVMs are already problematic, the performance difference caused by different Blackhole
modes can be very significant. Please make sure you use the consistent Blackhole mode for comparisons.

Benchmark                                Mode  Cnt   Score   Error  Units
AppStartupBenchmark.benchmarkAppStartup  avgt   20  87.083 ± 1.334  ms/op
</code></pre>
<hr/>
<h2>4.2 JMH result 檔案</h2>
<pre><code class="language-json">[
	{
		&quot;jmhVersion&quot;: &quot;1.36&quot;,
		&quot;benchmark&quot;: &quot;code.jmh.benchmarks.AppStartupBenchmark.benchmarkAppStartup&quot;,
		&quot;mode&quot;: &quot;avgt&quot;,
		&quot;threads&quot;: 1,
		&quot;forks&quot;: 1,
		&quot;jvm&quot;: &quot;C:\\Users\\Michael\\Desktop\\Apps\\msjdk17\\bin\\java.exe&quot;,
		&quot;jvmArgs&quot;: [&quot;-server&quot;],
		&quot;jdkVersion&quot;: &quot;17.0.7&quot;,
		&quot;vmName&quot;: &quot;OpenJDK 64-Bit Server VM&quot;,
		&quot;vmVersion&quot;: &quot;17.0.7+7-LTS&quot;,
		&quot;warmupIterations&quot;: 5,
		&quot;warmupTime&quot;: &quot;10 s&quot;,
		&quot;warmupBatchSize&quot;: 1,
		&quot;measurementIterations&quot;: 20,
		&quot;measurementTime&quot;: &quot;10 s&quot;,
		&quot;measurementBatchSize&quot;: 1,
		&quot;primaryMetric&quot;: {
			&quot;score&quot;: 87.08259406398619,
			&quot;scoreError&quot;: 1.3338545207641799,
			&quot;scoreConfidence&quot;: [85.74873954322202, 88.41644858475037],
			&quot;scorePercentiles&quot;: {
				&quot;0.0&quot;: 84.76841401869159,
				&quot;50.0&quot;: 87.10552132326006,
				&quot;90.0&quot;: 89.42742431372548,
				&quot;95.0&quot;: 89.82311887254902,
				&quot;99.0&quot;: 89.84320392156863,
				&quot;99.9&quot;: 89.84320392156863,
				&quot;99.99&quot;: 89.84320392156863,
				&quot;99.999&quot;: 89.84320392156863,
				&quot;99.9999&quot;: 89.84320392156863,
				&quot;100.0&quot;: 89.84320392156863
			},
			&quot;scoreUnit&quot;: &quot;ms/op&quot;,
			&quot;rawData&quot;: [
				[
					89.44150294117647, 89.30071666666667, 87.92223269230769, 86.58622761904762, 87.18889134615385,
					85.91300943396226, 88.0441, 86.75808476190477, 86.63733428571429, 86.20367047619048,
					87.03976476190476, 87.52096153846153, 87.17127788461538, 89.84320392156863, 85.20977196261683,
					84.81511214953271, 84.76841401869159, 88.85933203883495, 84.88701028037383, 87.5412625
				]
			]
		},
		&quot;secondaryMetrics&quot;: {}
	}
]
</code></pre>
<hr/>
<h1>5 已知問題</h1>
<h2>5.1 ClassNotFoundException：ForkedMain</h2>
<p>當我地用舊版既 Spring Boot <code>2.7.x</code> 而又配置左 <code>@Fork(value = 1)</code> 既話，當我地 build 左個 JAR 檔然後執行佢，就會出現下面既 error。</p>
<pre><code class="language-plaintext">Error: Could not find or load main class org.openjdk.jmh.runner.ForkedMain
Caused by: java.lang.ClassNotFoundException: org.openjdk.jmh.runner.ForkedMain
&lt;forked VM failed with exit code 1&gt;
&lt;stdout last=&#x27;20 lines&#x27;&gt;
&lt;/stdout&gt;
&lt;stderr last=&#x27;20 lines&#x27;&gt;
Error: Could not find or load main class org.openjdk.jmh.runner.ForkedMain
Caused by: java.lang.ClassNotFoundException: org.openjdk.jmh.runner.ForkedMain
&lt;/stderr&gt;

Benchmark had encountered error, and fail on error was requested
Exception in thread &quot;main&quot; java.lang.reflect.InvocationTargetException
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:566)
        at org.springframework.boot.loader.MainMethodRunner.run(MainMethodRunner.java:49)
        at org.springframework.boot.loader.Launcher.launch(Launcher.java:108)
        at org.springframework.boot.loader.Launcher.launch(Launcher.java:58)
        at org.springframework.boot.loader.JarLauncher.main(JarLauncher.java:65)
Caused by: org.openjdk.jmh.runner.RunnerException: Benchmark caught the exception
        at org.openjdk.jmh.runner.Runner.runBenchmarks(Runner.java:575)
        at org.openjdk.jmh.runner.Runner.internalRun(Runner.java:310)
        at org.openjdk.jmh.runner.Runner.run(Runner.java:209)
        at code.jmh.JmhApplication.main(JmhApplication.java:28)
        ... 8 more
Caused by: org.openjdk.jmh.runner.BenchmarkException: Benchmark error
        at org.openjdk.jmh.runner.Runner.doFork(Runner.java:768)
        at org.openjdk.jmh.runner.Runner.runSeparate(Runner.java:660)
        at org.openjdk.jmh.runner.Runner.runBenchmarks(Runner.java:558)
        ... 11 more
        Suppressed: java.lang.IllegalStateException: Forked VM failed with exit code 1
                ... 14 more
</code></pre>
<p>最快捷既解決方法係配置 <code>@Fork(value = 0)</code>，但係 JMH 只係建議喺 debug 既時候唔用 fork。另外唔用 fork 都有個壞處，就係我地會 apply 唔到 JVM args。</p>
<pre><code class="language-plaintext"># Fork: N/A, test runs in the host VM
# *** WARNING: Non-forked runs may silently omit JVM options, mess up profilers, disable compiler hints, etc. ***
# *** WARNING: Use non-forked runs only for debugging purposes, not for actual performance runs. ***
</code></pre>
<hr/>
<h1>6 參考資料</h1>
<ul>
<li><a href="https://mkyong.com/java/java-jmh-benchmark-tutorial/">Java JMH Benchmark Tutorial</a></li>
<li><a href="https://jenkov.com/tutorials/java-performance/jmh.html">JMH - Java Microbenchmark Harness</a></li>
<li><a href="https://gist.github.com/msievers/ce80d343fc15c44bea6cbb741dde7e45">[Spring, JMH] Howto integrate JMH benchmarks with Spring</a></li>
</ul><hr/><div class="vstack gap-3"><div class="text-center container"><div class="justify-content-center g-3 row row-cols-md-3 row-cols-sm-2 row-cols-1"><div class="col"><a target="_blank" rel="external nofollow noopener noreferrer" class="SiteFooter_contact-item__2JRRr card" href="tel:+85263301333"><div class="card-body"><div class="card-title h5"><i class="fa-solid fa-phone" style="color:#009688"></i></div><p class="text-muted card-text">6330 1333<!-- --> </p></div></a></div><div class="col"><a target="_blank" rel="external nofollow noopener noreferrer" class="SiteFooter_contact-item__2JRRr card" href="mailto:michaelboyboy@gmail.com"><div class="card-body"><div class="card-title h5"><i class="fa-solid fa-envelope" style="color:#f44336"></i></div><p class="text-muted card-text">michaelboyboy@gmail.com<!-- --> </p></div></a></div><div class="col"><a target="_blank" rel="external nofollow noopener noreferrer" class="SiteFooter_contact-item__2JRRr card" href="https://www.linkedin.com/in/mickchung"><div class="card-body"><div class="card-title h5"><i class="fa-brands fa-linkedin" style="color:#2196f3"></i></div><p class="text-muted card-text">www.linkedin.com/in/mickchung<!-- --> </p></div></a></div></div></div></div></div><script src="/e2-next/_next/static/chunks/webpack-f088da4552bcc253.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[8287,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"2153\",\"static/chunks/2153-45fd9844831c6348.js\",\"7177\",\"static/chunks/app/layout-ea91c2d128ec48c2.js\"],\"default\"]\n3:I[3339,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"8974\",\"static/chunks/app/page-c8b940db14fac9a0.js\"],\"default\"]\n4:I[1367,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"2153\",\"static/chunks/2153-45fd9844831c6348.js\",\"7177\",\"static/chunks/app/layout-ea91c2d128ec48c2.js\"],\"default\"]\n5:I[5244,[],\"\"]\n6:I[3866,[],\"\"]\n7:I[4798,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"8974\",\"static/chunks/app/page-c8b940db14fac9a0.js\"],\"default\"]\n8:I[6121,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"8974\",\"static/chunks/app/page-c8b940db14fac9a0.js\"],\"default\"]\n9:I[3667,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"8974\",\"static/chunks/app/page-c8b940db14fac9a0.js\"],\"default\"]\na:I[8407,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"2153\",\"static/chunks/2153-45fd9844831c6348.js\",\"7177\",\"static/chunks/app/layout-ea91c2d128ec48c2.js\"],\"default\"]\nb:I[8173,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"8974\",\"static/chunks/app/page-c8b940db14fac9a0.js\"],\"\"]\nc:I[3197,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"2153\",\"static/chunks/2153-45fd9844831c6348.js\",\"7177\",\"static/chunks/app/layout-ea91c2d128ec48c2.js\"],\"default\"]\nd:I[7933,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"2153\",\"static/chunks/2153-45fd9844831c6348.js\",\"7177\",\"static/chunks/app/layout-ea91c2d128ec48c2.js\"],\"default\"]\ne:I[3800,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"2153\",\"static/chunks/2153-45fd9844831c6348.js\",\"7177\",\"static/chunks/app/layout-ea91c2d128ec48c2.js\"],\"default\"]\n14:I[6213,[],\"OutletBoundary\"]\n16:I[6213,[],\"MetadataBoundary\"]\n18:I[6213,[],\"ViewportBoundary\"]\n1a:I[4835,[],\"\"]\n:HL[\"/e2-next/_next/static/css/d3df112486f97f47.css\",\"style\"]\n:HL[\"/e2-next/_next/static/css/c3624a693ae5a0c4.css\",\"style\"]\nf:T6d1,\u003cparent\u003e\r\n\t\u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e\r\n\t\u003cartifactId\u003espring-boot-starter-parent\u003c/artifactId\u003e\r\n\t\u003cver"])</script><script>self.__next_f.push([1,"sion\u003e3.0.6\u003c/version\u003e\r\n\u003c/parent\u003e\r\n\r\n\u003cdependencyManagement\u003e\r\n\t\u003cdependencies\u003e\r\n\t\t\u003cdependency\u003e\r\n\t\t\t\u003cgroupId\u003eorg.springframework.cloud\u003c/groupId\u003e\r\n\t\t\t\u003cartifactId\u003espring-cloud-dependencies\u003c/artifactId\u003e\r\n\t\t\t\u003cversion\u003e2022.0.2\u003c/version\u003e\r\n\t\t\t\u003ctype\u003epom\u003c/type\u003e\r\n\t\t\t\u003cscope\u003eimport\u003c/scope\u003e\r\n\t\t\u003c/dependency\u003e\r\n\t\u003c/dependencies\u003e\r\n\u003c/dependencyManagement\u003e\r\n\r\n\u003cdependencies\u003e\r\n\t\u003cdependency\u003e\r\n\t\t\u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e\r\n\t\t\u003cartifactId\u003espring-boot-starter-web\u003c/artifactId\u003e\r\n\t\u003c/dependency\u003e\r\n\r\n\t\u003cdependency\u003e\r\n\t\t\u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e\r\n\t\t\u003cartifactId\u003espring-boot-starter-actuator\u003c/artifactId\u003e\r\n\t\u003c/dependency\u003e\r\n\t\u003cdependency\u003e\r\n\t\t\u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e\r\n\t\t\u003cartifactId\u003espring-boot-devtools\u003c/artifactId\u003e\r\n\t\u003c/dependency\u003e\r\n\r\n\t\u003cdependency\u003e\r\n\t\t\u003cgroupId\u003ecommons-io\u003c/groupId\u003e\r\n\t\t\u003cartifactId\u003ecommons-io\u003c/artifactId\u003e\r\n\t\t\u003cversion\u003e2.11.0\u003c/version\u003e\r\n\t\u003c/dependency\u003e\r\n\r\n\t\u003cdependency\u003e\r\n\t\t\u003cgroupId\u003eorg.openjdk.jmh\u003c/groupId\u003e\r\n\t\t\u003cartifactId\u003ejmh-core\u003c/artifactId\u003e\r\n\t\t\u003cversion\u003e1.36\u003c/version\u003e\r\n\t\u003c/dependency\u003e\r\n\t\u003cdependency\u003e\r\n\t\t\u003cgroupId\u003eorg.openjdk.jmh\u003c/groupId\u003e\r\n\t\t\u003cartifactId\u003ejmh-generator-annprocess\u003c/artifactId\u003e\r\n\t\t\u003cversion\u003e1.36\u003c/version\u003e\r\n\t\u003c/dependency\u003e\r\n\u003c/dependencies\u003e\r\n\r\n\u003cbuild\u003e\r\n\t\u003cplugins\u003e\r\n\t\t\u003cplugin\u003e\r\n\t\t\t\u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e\r\n\t\t\t\u003cartifactId\u003espring-boot-maven-plugin\u003c/artifactId\u003e\r\n\t\t\t\u003cversion\u003e3.0.6\u003c/version\u003e\r\n\t\t\t\u003cconfiguration\u003e\r\n\t\t\t\t\u003cmainClass\u003ecode.jmh.JmhApplication\u003c/mainClass\u003e \u003c!-- 只限測試用 --\u003e\r\n\t\t\t\u003c/configuration\u003e\r\n\t\t\t\u003cexecutions\u003e\r\n\t\t\t\t\u003cexecution\u003e\r\n\t\t\t\t\t\u003cgoals\u003e\r\n\t\t\t\t\t\t\u003cgoal\u003erepackage\u003c/goal\u003e\r\n\t\t\t\t\t\u003c/goals\u003e\r\n\t\t\t\t\u003c/execution\u003e\r\n\t\t\t\u003c/executions\u003e\r\n\t\t\u003c/plugin\u003e\r\n\t\u003c/plugins\u003e\r\n\u003c/build\u003e\n10:T50b,public class JmhApplication {\r\n\r\n    public static void main(String [] args) throws Exception {\r\n\r\n        final File resultFile = createResultFile();\r\n\r\n        final Options opt = new OptionsBuilder()\r\n                .include(BenchmarkPackageRef.class.getPackageName())\r\n                .shouldDoGC(true)\r\n                .shouldFailOnError(true)\r\n                .resultFormat(ResultFormatType.JSON)\r\n     "])</script><script>self.__next_f.push([1,"           .result(resultFile.getAbsolutePath())\r\n                .build();\r\n\r\n        new Runner(opt).run();\r\n\r\n        printResultFile(resultFile);\r\n    }\r\n\r\n    private static File createResultFile() throws Exception {\r\n        try {\r\n            final File file = Files.createTempFile(\"jmh-results\", \".json\").toFile();\r\n            file.deleteOnExit();\r\n            System.out.println(\"Created JMH result file: \" + file.getAbsolutePath());\r\n\r\n            return file;\r\n        } catch (Exception e) {\r\n            System.err.println(\"Failed to create result file for JMH.\");\r\n            throw e;\r\n        }\r\n    }\r\n\r\n    private static void printResultFile(File resultFile) throws Exception {\r\n        System.out.println(\"Printing file content of \" + resultFile.getAbsolutePath() + \":\");\r\n        System.out.println(FileUtils.readFileToString(resultFile, \"UTF-8\"));\r\n    }\r\n}\n11:Tacc,"])</script><script>self.__next_f.push([1,"# JMH version: 1.36\r\n# VM version: JDK 17.0.7, OpenJDK 64-Bit Server VM, 17.0.7+7-LTS\r\n# VM invoker: C:\\Users\\Michael\\Desktop\\Apps\\msjdk17\\bin\\java.exe\r\n# VM options: -server\r\n# Blackhole mode: compiler (auto-detected, use -Djmh.blackhole.autoDetect=false to disable)\r\n# Warmup: 5 iterations, 10 s each\r\n# Measurement: 20 iterations, 10 s each\r\n# Timeout: 10 min per iteration\r\n# Threads: 1 thread, will synchronize iterations\r\n# Benchmark mode: Average time, time/op\r\n# Benchmark: code.jmh.benchmarks.AppStartupBenchmark.benchmarkAppStartup\r\n\r\n# Run progress: 0.00% complete, ETA 00:04:10\r\n# Fork: 1 of 1\r\n# Warmup Iteration   1: 220.079 ms/op\r\n# Warmup Iteration   2: 129.138 ms/op\r\n# Warmup Iteration   3: 105.157 ms/op\r\n# Warmup Iteration   4: 97.996 ms/op\r\n# Warmup Iteration   5: 89.844 ms/op\r\nIteration   1: 89.442 ms/op\r\nIteration   2: 89.301 ms/op\r\nIteration   3: 87.922 ms/op\r\nIteration   4: 86.586 ms/op\r\nIteration   5: 87.189 ms/op\r\nIteration   6: 85.913 ms/op\r\nIteration   7: 88.044 ms/op\r\nIteration   8: 86.758 ms/op\r\nIteration   9: 86.637 ms/op\r\nIteration  10: 86.204 ms/op\r\nIteration  11: 87.040 ms/op\r\nIteration  12: 87.521 ms/op\r\nIteration  13: 87.171 ms/op\r\nIteration  14: 89.843 ms/op\r\nIteration  15: 85.210 ms/op\r\nIteration  16: 84.815 ms/op\r\nIteration  17: 84.768 ms/op\r\nIteration  18: 88.859 ms/op\r\nIteration  19: 84.887 ms/op\r\nIteration  20: 87.541 ms/op\r\n\r\n\r\nResult \"code.jmh.benchmarks.AppStartupBenchmark.benchmarkAppStartup\":\r\n  87.083 ±(99.9%) 1.334 ms/op [Average]\r\n  (min, avg, max) = (84.768, 87.083, 89.843), stdev = 1.536\r\n  CI (99.9%): [85.749, 88.416] (assumes normal distribution)\r\n\r\n\r\n# Run complete. Total time: 00:04:55\r\n\r\nREMEMBER: The numbers below are just data. To gain reusable insights, you need to follow up on\r\nwhy the numbers are the way they are. Use profilers (see -prof, -lprof), design factorial\r\nexperiments, perform baseline and negative tests that provide experimental control, make sure\r\nthe benchmarking environment is safe on JVM/OS/HW level, ask for reviews from the domain experts.\r\nDo not assume the numbers tell you what you want them to tell.\r\n\r\nNOTE: Current JVM experimentally supports Compiler Blackholes, and they are in use. Please exercise\r\nextra caution when trusting the results, look into the generated code to check the benchmark still\r\nworks, and factor in a small probability of new VM bugs. Additionally, while comparisons between\r\ndifferent JVMs are already problematic, the performance difference caused by different Blackhole\r\nmodes can be very significant. Please make sure you use the consistent Blackhole mode for comparisons.\r\n\r\nBenchmark                                Mode  Cnt   Score   Error  Units\r\nAppStartupBenchmark.benchmarkAppStartup  avgt   20  87.083 ± 1.334  ms/op\n"])</script><script>self.__next_f.push([1,"12:T5f8,[\r\n\t{\r\n\t\t\"jmhVersion\": \"1.36\",\r\n\t\t\"benchmark\": \"code.jmh.benchmarks.AppStartupBenchmark.benchmarkAppStartup\",\r\n\t\t\"mode\": \"avgt\",\r\n\t\t\"threads\": 1,\r\n\t\t\"forks\": 1,\r\n\t\t\"jvm\": \"C:\\\\Users\\\\Michael\\\\Desktop\\\\Apps\\\\msjdk17\\\\bin\\\\java.exe\",\r\n\t\t\"jvmArgs\": [\"-server\"],\r\n\t\t\"jdkVersion\": \"17.0.7\",\r\n\t\t\"vmName\": \"OpenJDK 64-Bit Server VM\",\r\n\t\t\"vmVersion\": \"17.0.7+7-LTS\",\r\n\t\t\"warmupIterations\": 5,\r\n\t\t\"warmupTime\": \"10 s\",\r\n\t\t\"warmupBatchSize\": 1,\r\n\t\t\"measurementIterations\": 20,\r\n\t\t\"measurementTime\": \"10 s\",\r\n\t\t\"measurementBatchSize\": 1,\r\n\t\t\"primaryMetric\": {\r\n\t\t\t\"score\": 87.08259406398619,\r\n\t\t\t\"scoreError\": 1.3338545207641799,\r\n\t\t\t\"scoreConfidence\": [85.74873954322202, 88.41644858475037],\r\n\t\t\t\"scorePercentiles\": {\r\n\t\t\t\t\"0.0\": 84.76841401869159,\r\n\t\t\t\t\"50.0\": 87.10552132326006,\r\n\t\t\t\t\"90.0\": 89.42742431372548,\r\n\t\t\t\t\"95.0\": 89.82311887254902,\r\n\t\t\t\t\"99.0\": 89.84320392156863,\r\n\t\t\t\t\"99.9\": 89.84320392156863,\r\n\t\t\t\t\"99.99\": 89.84320392156863,\r\n\t\t\t\t\"99.999\": 89.84320392156863,\r\n\t\t\t\t\"99.9999\": 89.84320392156863,\r\n\t\t\t\t\"100.0\": 89.84320392156863\r\n\t\t\t},\r\n\t\t\t\"scoreUnit\": \"ms/op\",\r\n\t\t\t\"rawData\": [\r\n\t\t\t\t[\r\n\t\t\t\t\t89.44150294117647, 89.30071666666667, 87.92223269230769, 86.58622761904762, 87.18889134615385,\r\n\t\t\t\t\t85.91300943396226, 88.0441, 86.75808476190477, 86.63733428571429, 86.20367047619048,\r\n\t\t\t\t\t87.03976476190476, 87.52096153846153, 87.17127788461538, 89.84320392156863, 85.20977196261683,\r\n\t\t\t\t\t84.81511214953271, 84.76841401869159, 88.85933203883495, 84.88701028037383, 87.5412625\r\n\t\t\t\t]\r\n\t\t\t]\r\n\t\t},\r\n\t\t\"secondaryMetrics\": {}\r\n\t}\r\n]\n13:T81a,"])</script><script>self.__next_f.push([1,"Error: Could not find or load main class org.openjdk.jmh.runner.ForkedMain\r\nCaused by: java.lang.ClassNotFoundException: org.openjdk.jmh.runner.ForkedMain\r\n\u003cforked VM failed with exit code 1\u003e\r\n\u003cstdout last='20 lines'\u003e\r\n\u003c/stdout\u003e\r\n\u003cstderr last='20 lines'\u003e\r\nError: Could not find or load main class org.openjdk.jmh.runner.ForkedMain\r\nCaused by: java.lang.ClassNotFoundException: org.openjdk.jmh.runner.ForkedMain\r\n\u003c/stderr\u003e\r\n\r\nBenchmark had encountered error, and fail on error was requested\r\nException in thread \"main\" java.lang.reflect.InvocationTargetException\r\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n        at java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n        at org.springframework.boot.loader.MainMethodRunner.run(MainMethodRunner.java:49)\r\n        at org.springframework.boot.loader.Launcher.launch(Launcher.java:108)\r\n        at org.springframework.boot.loader.Launcher.launch(Launcher.java:58)\r\n        at org.springframework.boot.loader.JarLauncher.main(JarLauncher.java:65)\r\nCaused by: org.openjdk.jmh.runner.RunnerException: Benchmark caught the exception\r\n        at org.openjdk.jmh.runner.Runner.runBenchmarks(Runner.java:575)\r\n        at org.openjdk.jmh.runner.Runner.internalRun(Runner.java:310)\r\n        at org.openjdk.jmh.runner.Runner.run(Runner.java:209)\r\n        at code.jmh.JmhApplication.main(JmhApplication.java:28)\r\n        ... 8 more\r\nCaused by: org.openjdk.jmh.runner.BenchmarkException: Benchmark error\r\n        at org.openjdk.jmh.runner.Runner.doFork(Runner.java:768)\r\n        at org.openjdk.jmh.runner.Runner.runSeparate(Runner.java:660)\r\n        at org.openjdk.jmh.runner.Runner.runBenchmarks(Runner.java:558)\r\n        ... 11 more\r\n        Suppressed: java.lang.IllegalStateException: Forked VM failed with exit code 1\r\n                ... 14 more\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"wfZ4FdS4ntgGvzjeKJhfw\",\"p\":\"/e2-next\",\"c\":[\"\",\"blog\",\"jmh-benchmark\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[\"(2023-05)\",{\"children\":[\"jmh-benchmark\",{\"children\":[\"__PAGE__\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/e2-next/_next/static/css/d3df112486f97f47.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/e2-next/_next/static/css/c3624a693ae5a0c4.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"href\":\"https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900\u0026display=swap\",\"rel\":\"stylesheet\"}],[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css\"}]]}],[\"$\",\"body\",null,{\"children\":[\"$\",\"$L2\",null,{\"children\":[\"$\",\"$L3\",null,{\"gap\":5,\"children\":[[\"$\",\"$L3\",null,{\"gap\":5,\"className\":\"text-center\",\"children\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"code\",null,{\"className\":\"SiteHeader_name__cwQmL\",\"children\":\"Chung Cheuk Hang Michael\"}],[\"$\",\"code\",null,{\"className\":\"SiteHeader_title__CCfvI\",\"children\":\"Java Web Developer\"}]]}],[\"$\",\"$L4\",null,{}]]}],[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}],[\"$\",\"hr\",null,{}],[\"$\",\"$L3\",null,{\"gap\":3,\"children\":[\"$\",\"$L7\",null,{\"className\":\"text-center\",\"children\":[\"$\",\"$L8\",null,{\"xs\":1,\"sm\":2,\"md\":3,\"className\":\"justify-content-center g-3\",\"children\":[[\"$\",\"$L9\",\"0\",{\"children\":[\"$\",\"$La\",null,{\"as\":\"$b\",\"href\":\"tel:+85263301333\",\"target\":\"_blank\",\"rel\":\"external nofollow noopener noreferrer\",\"className\":\"SiteFooter_contact-item__2JRRr\",\"children\":[\"$\",\"$Lc\",null,{\"children\":[[\"$\",\"$Ld\",null,{\"children\":[\"$\",\"i\",null,{\"className\":\"fa-solid fa-phone\",\"style\":{\"color\":\"#009688\"}}]}],[\"$\",\"$Le\",null,{\"className\":\"text-muted\",\"children\":[\"6330 1333\",\" \"]}]]}]}]}],[\"$\",\"$L9\",\"1\",{\"children\":[\"$\",\"$La\",null,{\"as\":\"$b\",\"href\":\"mailto:michaelboyboy@gmail.com\",\"target\":\"_blank\",\"rel\":\"external nofollow noopener noreferrer\",\"className\":\"SiteFooter_contact-item__2JRRr\",\"children\":[\"$\",\"$Lc\",null,{\"children\":[[\"$\",\"$Ld\",null,{\"children\":[\"$\",\"i\",null,{\"className\":\"fa-solid fa-envelope\",\"style\":{\"color\":\"#f44336\"}}]}],[\"$\",\"$Le\",null,{\"className\":\"text-muted\",\"children\":[\"michaelboyboy@gmail.com\",\" \"]}]]}]}]}],[\"$\",\"$L9\",\"2\",{\"children\":[\"$\",\"$La\",null,{\"as\":\"$b\",\"href\":\"https://www.linkedin.com/in/mickchung\",\"target\":\"_blank\",\"rel\":\"external nofollow noopener noreferrer\",\"className\":\"SiteFooter_contact-item__2JRRr\",\"children\":[\"$\",\"$Lc\",null,{\"children\":[[\"$\",\"$Ld\",null,{\"children\":[\"$\",\"i\",null,{\"className\":\"fa-brands fa-linkedin\",\"style\":{\"color\":\"#2196f3\"}}]}],[\"$\",\"$Le\",null,{\"className\":\"text-muted\",\"children\":[\"www.linkedin.com/in/mickchung\",\" \"]}]]}]}]}]]}]}]}]]}]}]}]]}]]}],{\"children\":[\"blog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"(2023-05)\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"(2023-05)\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"jmh-benchmark\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"(2023-05)\",\"children\",\"jmh-benchmark\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"h1\",null,{\"children\":\"1 JMH 簡介\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Java Microbenchmark Harness（JMH）係一個用黎做 benchmark Java 程式既一套 library。\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"佢可以話畀我地知一個 Java method：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"平均需要幾長時間去執行（average time）\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"一秒鐘執行到幾多次（throughput）\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"1.1 使用場景\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"想改善某個 method 既執行速度，例如寫 algorithm。\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"想比較 Java 或者 Maven dependency 版本 upgrade 帶黎既性能差別。\"}],\"\\n\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"2 動手寫\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Project structure：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"src/main/java\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"/code\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"/jmh\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"/benchmarks\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AppStartupBenchmark.java\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"BenchmarkPackageRef.java\"}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"JmhApplication.java\"}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"ApplicationController.java\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"MainApplication.java\"}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"src/main/resources\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"application.yml\"}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"2.1 Maven dependencies\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-xml\",\"children\":\"$f\"}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"2.2 Java code\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"JmhApplication.java\"}],\"：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-java\",\"children\":\"$10\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"BenchmarkPackageRef.java\"}],\"：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-java\",\"children\":\"public final class BenchmarkPackageRef {\\r\\n\\r\\n    private BenchmarkPackageRef() {}\\r\\n}\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"AppStartupBenchmark.java\"}],\"：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-java\",\"children\":\"@Warmup(iterations = 5)\\r\\n@Measurement(iterations = 20)\\r\\n@State(Scope.Benchmark)\\r\\n@BenchmarkMode(Mode.AverageTime)\\r\\n@OutputTimeUnit(TimeUnit.MILLISECONDS)\\r\\n@Threads(1)\\r\\n@Fork(value = 1, jvmArgs = { \\\"-server\\\" })\\r\\npublic class AppStartupBenchmark {\\r\\n\\r\\n    ConfigurableApplicationContext context;\\r\\n\\r\\n    @Setup(Level.Invocation)\\r\\n    public void init() {\\r\\n\\r\\n    }\\r\\n\\r\\n    @TearDown(Level.Invocation)\\r\\n    public void finish() {\\r\\n        if (context!=null \u0026\u0026 context.isRunning()) {\\r\\n            context.close();\\r\\n        }\\r\\n    }\\r\\n\\r\\n    // 我地測試緊 Spring Boot startup 以及 Spring context 初始化\\r\\n    @Benchmark\\r\\n    public void benchmarkAppStartup() {\\r\\n        context = SpringApplication.run(MainApplication.class);\\r\\n        Assert.notNull(context.getBean(MyController.class), \\\"Controller bean should not be null.\\\");\\r\\n    }\\r\\n}\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"MainApplication.java\"}],\"：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-java\",\"children\":\"@SpringBootApplication\\r\\npublic class MainApplication {\\r\\n\\r\\n    public static void main(String[] args) {\\r\\n        SpringApplication.run(MainApplication.class, args);\\r\\n    }\\r\\n}\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"MyController.java\"}],\"：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-java\",\"children\":\"@RestController\\r\\npublic class MyController {\\r\\n\\r\\n    @GetMapping\\r\\n    public String helloWorld() {\\r\\n        return \\\"hello world\\\";\\r\\n    }\\r\\n}\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"application.yml\"}],\"：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-yaml\",\"children\":\"logging.level.root: ERROR\\r\\nspring.main.banner-mode: off\\n\"}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"3 執行 benchmark\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"有兩個方式：\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"IDE 裡面作為 Java app 咁執行\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Build 左 JAR 檔之後執行\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"3.1 IDE 裡面執行\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"（以下適用於 Eclipse）\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"先確保 Eclipse 有安裝到 \",[\"$\",\"code\",null,{\"children\":\"m2e-apt\"}],\"，亦都 enable 左 annotation processing。\"]}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Update 個 Maven project。\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"將 \",[\"$\",\"code\",null,{\"children\":\"JmhApplication\"}],\" class 作為 Java app 咁執行。\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"3.2 執行 JAR artifact\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"我地要 build 左個 JAR 檔出黎，然後執行佢：\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-bash\",\"children\":\"mvn clean package\\n\"}]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-bash\",\"children\":\"cd target\\r\\njava -jar spring-boot-jmh-1.0.0.jar\\n\"}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"4 Benchmark 結果樣本\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"註：\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"我地用既 benchmark mode 係 average time。\",\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"所以 score 既單位係 \",[\"$\",\"code\",null,{\"children\":\"ms/op\"}],\"，呢個數字係越低越好。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"每個 iteration 執行既 operations 次數由 JMH 決定。\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"如果 benchmark mode 用 all，佢會用唔同既 benchmark mode 執行同一個 benchmark。\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"4.1 Console log\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-plaintext\",\"children\":\"$11\"}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"4.2 JMH result 檔案\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-json\",\"children\":\"$12\"}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"5 已知問題\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"5.1 ClassNotFoundException：ForkedMain\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"當我地用舊版既 Spring Boot \",[\"$\",\"code\",null,{\"children\":\"2.7.x\"}],\" 而又配置左 \",[\"$\",\"code\",null,{\"children\":\"@Fork(value = 1)\"}],\" 既話，當我地 build 左個 JAR 檔然後執行佢，就會出現下面既 error。\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-plaintext\",\"children\":\"$13\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"最快捷既解決方法係配置 \",[\"$\",\"code\",null,{\"children\":\"@Fork(value = 0)\"}],\"，但係 JMH 只係建議喺 debug 既時候唔用 fork。另外唔用 fork 都有個壞處，就係我地會 apply 唔到 JVM args。\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-plaintext\",\"children\":\"# Fork: N/A, test runs in the host VM\\r\\n# *** WARNING: Non-forked runs may silently omit JVM options, mess up profilers, disable compiler hints, etc. ***\\r\\n# *** WARNING: Use non-forked runs only for debugging purposes, not for actual performance runs. ***\\n\"}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"6 參考資料\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://mkyong.com/java/java-jmh-benchmark-tutorial/\",\"children\":\"Java JMH Benchmark Tutorial\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://jenkov.com/tutorials/java-performance/jmh.html\",\"children\":\"JMH - Java Microbenchmark Harness\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://gist.github.com/msievers/ce80d343fc15c44bea6cbb741dde7e45\",\"children\":\"[Spring, JMH] Howto integrate JMH benchmarks with Spring\"}]}],\"\\n\"]}]],null,[\"$\",\"$L14\",null,{\"children\":\"$L15\"}]]}],{},null,false]},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"q6Epsop7j7iCAuefaApAC\",{\"children\":[[\"$\",\"$L16\",null,{\"children\":\"$L17\"}],[\"$\",\"$L18\",null,{\"children\":\"$L19\"}],null]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$1a\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"19:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n17:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Michael Chung's e-Portfolio\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Powered by Next.js and React\"}]]\n"])</script><script>self.__next_f.push([1,"15:null\n"])</script></body></html>