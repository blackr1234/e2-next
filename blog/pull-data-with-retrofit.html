<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="blog/2021-04/pull-data-with-retrofit/jumbo-http-response.png"/><link rel="preload" as="image" href="blog/2021-04/pull-data-with-retrofit/jumbo-http-request.png"/><link rel="preload" as="image" href="blog/2021-04/pull-data-with-retrofit/postman.png"/><link rel="stylesheet" href="/e2-next/_next/static/css/d3df112486f97f47.css" data-precedence="next"/><link rel="stylesheet" href="/e2-next/_next/static/css/c3624a693ae5a0c4.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/e2-next/_next/static/chunks/webpack-f088da4552bcc253.js"/><script src="/e2-next/_next/static/chunks/4bd1b696-120f4d9c40d223dd.js" async=""></script><script src="/e2-next/_next/static/chunks/1517-c8d232d43a11224c.js" async=""></script><script src="/e2-next/_next/static/chunks/main-app-05c45cc8f30d6cea.js" async=""></script><script src="/e2-next/_next/static/chunks/7829-b7b9eb1dbe0d40e4.js" async=""></script><script src="/e2-next/_next/static/chunks/2153-45fd9844831c6348.js" async=""></script><script src="/e2-next/_next/static/chunks/app/layout-ea91c2d128ec48c2.js" async=""></script><script src="/e2-next/_next/static/chunks/app/page-c8b940db14fac9a0.js" async=""></script><title>Michael Chung&#x27;s e-Portfolio</title><meta name="description" content="Powered by Next.js and React"/><link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&amp;display=swap" rel="stylesheet"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"/><script src="/e2-next/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><div class="vstack gap-5"><div class="text-center vstack gap-5"><div><code class="SiteHeader_name__cwQmL">Chung Cheuk Hang Michael</code><code class="SiteHeader_title__CCfvI">Java Web Developer</code></div><nav class="justify-content-center navbar navbar-expand-md navbar-dark"><button type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="justify-content-center navbar-collapse collapse"><div class="justify-content-center navbar-nav nav-underline"><div class="nav-item"><a draggable="false" data-rr-ui-event-key="/" class="nav-link" href="/e2-next">Home</a></div><div class="nav-item"><a draggable="false" data-rr-ui-event-key="/work" class="nav-link" href="/e2-next/work">Work</a></div><div class="nav-item"><a draggable="false" data-rr-ui-event-key="/hobbyProjects" class="nav-link" href="/e2-next/hobbyProjects">Hobby projects</a></div><div class="nav-item"><a draggable="false" data-rr-ui-event-key="/personality" class="nav-link" href="/e2-next/personality">Personality</a></div><div class="nav-item"><a draggable="false" data-rr-ui-event-key="/blog" class="nav-link" href="/e2-next/blog">Blog</a></div></div></div></nav></div><h2>1 關於 Retrofit</h2>
<p>Retrofit 係一個 HTTP client 既 Java library，可以幫我地做到 HTTP call，有啲似 Spring Cloud OpenFeign，都係行 declarative approach，透過 interface methods 既 annotations 以及 parameters 黎定義 HTTP 請求。</p>
<hr/>
<h2>2 動手使用 Retrofit 下載資料</h2>
<h3>2.1 需求情境</h3>
<p>試想像我地而家想寫一個程式，可以幫我地喺 Jumbo Computer 網站獲取電腦零件報價資訊。</p>
<p>Jumbo Computer 既網址係：<a href="https://shoponjc.com/quote.php">https://shoponjc.com/quote.php</a></p>
<p>透過 Chrome developer tools 既 Network 分頁，我地可以見到，當我地喺頁面選擇左「產品類型」之後，Jumbo Computer 會喺 XHR 分類下有個 <code>getprod.php</code> 既 HTTP POST request，而 response body 係 JSON 格式。</p>
<p><img src="blog/2021-04/pull-data-with-retrofit/jumbo-http-response.png" alt=""/></p>
<hr/>
<h3>2.2 分析</h3>
<h4>2.2.1 必填的 <code>session</code> form data</h4>
<p>我地可以見到 Jumbo Computer 拎資料用既 HTTP POST request 係需要一個 <code>session</code> 既 form data entry。</p>
<p>經 Postman 一試，我地會發現如果個 HTTP request 缺少左 <code>session</code>，又或者個 <code>session</code> 值係我地自己改出黎既話，都會收到 error response，咁係因為 Jumbo Computer 既 server 會驗證呢個 <code>session</code> 值。</p>
<p>至於呢個 <code>session</code> 值要點樣先可以拎到？實驗話畀我地知，呢個 <code>session</code> 值好似唔會 expire，咁即係我地可以直接用已知既 <code>session</code> 值。不過，穩陣起見，我地都係睇下佢係點樣攞到或者計到呢個 <code>session</code> 值比較好。</p>
<p><img src="blog/2021-04/pull-data-with-retrofit/jumbo-http-request.png" alt=""/></p>
<p><img src="blog/2021-04/pull-data-with-retrofit/postman.png" alt=""/></p>
<hr/>
<h4>2.2.2 如何取得新的 <code>session</code> 值</h4>
<p>喺 Chrome developer tools 既 Application 分頁下面，我地可以見到 Local Storage 分類下，<code>shoponjc.com</code> 有一個 <code>Key</code> 為 <code>Session ID</code> 既 entry。</p>
<p>另外，喺 Chrome developer tools 既 Sources 分頁下面，我地可以見到 <code>shoponjc.com</code> 有一個 JavaScript 檔叫 <code>quo.js?d83scwsoejkx6</code>，裡面有以下一段：</p>
<pre><code class="language-js">if (window.localStorage) {
	storage = window.localStorage;
	storage.setItem(&quot;Version&quot;, &quot;1.0&quot;);
	storage.setItem(&quot;Session ID&quot;, document.getElementById(&quot;sid&quot;).value);
}
</code></pre>
<p>咁即係我地可以用 <code>sid</code> 作為 DOM element ID 黎喺個網頁上搵 DOM element，而結果如下：</p>
<pre><code class="language-html">&lt;input type=&quot;hidden&quot; id=&quot;sid&quot; value=&quot;wpjfi557nqf75&quot; /&gt;
</code></pre>
<p><strong>解讀：</strong> 每當我地瀏覽呢個網頁既時候，佢 server 會返回一個帶有隨機 session ID 既 DOM element 既 HTML 檔，然後 JavaScript 會令 Local Storage 裡面多左一個名為 <code>Session ID</code> 既 entry。</p>
<p>另外，我地都可以從個 JavaScript 檔見到個 <code>session</code> 值係黎自於 <code>this.$refs.sid</code>。因為個網頁係用 Vue.js library 黎寫，而 <code>this.$refs.sid</code> 就即係指緊 DOM element ID 為 <code>sid</code> 既 DOM element。</p>
<pre><code class="language-js">var vm = new Vue({
	// ... 省略 500 幾行
	mounted: function () {
		this.session = this.$refs.sid.value;
		// ... 省略幾行
	},
});
</code></pre>
<p><strong>解讀：</strong> 喺個 <code>sid</code> DOM element mount 左之後，Vue.js 既 <code>session</code>（<code>this.session</code>）就會變成 <code>sid</code> DOM element 既 <code>value</code>。</p>
<p>再睇下佢係點樣組裝 POST request 同 call 出去：</p>
<pre><code class="language-js">actualSearch: function (pnum) {
    /*
    if (this.ptype == &#x27;&#x27;) {
        alert(&quot;Please select 產品類型 Product Type first.&quot;);
        return;
    }
    if (this.ptypeval.length &gt; 40) {
        alert(&quot;關鍵字 Key words are too long, please re-enter first.&quot;);
        return;
    }
    */
    if (this.searchFired == false) {
        this.searchFired = true;
        var form_data = new FormData();
        form_data.append(&#x27;session&#x27;, this.session);
        form_data.append(&#x27;sort&#x27;, this.nsort);
        form_data.append(&#x27;link&#x27;, this.linkpicks);
        form_data.append(&#x27;ptype&#x27;, this.ptype);
        form_data.append(&#x27;pmin&#x27;, this.range[0]);
        form_data.append(&#x27;pmax&#x27;, this.range[1]);
        form_data.append(&#x27;pwords&#x27;, this.ptypeval);
        form_data.append(&#x27;prow&#x27;, this.pagerow);
        form_data.append(&#x27;pnum&#x27;, pnum);
        ajax({
            method: &#x27;post&#x27;,
            url: &#x27;getprod.php&#x27;,
            data: form_data
        }).then(response =&gt; {
            this.searchFired = false;
            this.$nextTick(function () {
                let json = response.data;
                this.havedata = false;
                if (json.status == &#x27;Error&#x27;) {
                    alert(&quot;No product found!!&quot;);
                } else {
                    this.plist = json.plist;
                    if (json.plist.length &gt;= 10)
                        this.havedata = true;
                }
            });
        });
    }
},
</code></pre>
<p><strong>解讀：</strong> 可以見到拎資料既 POST request 既 <code>session</code> 係黎自於 Vue.js 既 <code>session</code>（<code>this.session</code>）。</p>
<p>成件事就係咁簡單！我地每次用 jsoup 下載個新既 HTML 落黎就可以拎到新既 session ID 值。</p>
<hr/>
<h3>2.3 添加 Maven dependencies</h3>
<p>我地會用到以下 Maven dependencies，當中包括 jsoup：</p>
<pre><code class="language-xml">&lt;!-- ##### jsoup ##### --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.jsoup&lt;/groupId&gt;
    &lt;artifactId&gt;jsoup&lt;/artifactId&gt;
    &lt;version&gt;1.13.1&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- ##### retrofit ##### --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.squareup.retrofit2&lt;/groupId&gt;
    &lt;artifactId&gt;retrofit&lt;/artifactId&gt;
    &lt;version&gt;2.9.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.squareup.retrofit2&lt;/groupId&gt;
    &lt;artifactId&gt;converter-scalars&lt;/artifactId&gt;
    &lt;version&gt;2.9.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.squareup.retrofit2&lt;/groupId&gt;
    &lt;artifactId&gt;converter-gson&lt;/artifactId&gt;
    &lt;version&gt;2.9.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<hr/>
<h3>2.4 寫 Java code</h3>
<p><code>ProductsResponse.java</code>：</p>
<pre><code class="language-java">@Data
@Accessors(chain = true)
@FieldDefaults(level = PRIVATE)
public class ProductsResponse {
    String status;
    String session;

    @SerializedName(&quot;plist&quot;)
    List&lt;Product&gt; products;
}
</code></pre>
<p><code>JumboClient.java</code>：</p>
<pre><code class="language-java">public interface JumboClient {

    @FormUrlEncoded
    @POST(&quot;getprod.php&quot;)
    Call&lt;ProductsResponse&gt; getProductsByCategory(
        @Field(&quot;session&quot;) String session,
        @Field(&quot;sort&quot;)    Integer sortType,
        @Field(&quot;link&quot;)    Boolean link,
        @Field(&quot;ptype&quot;)   Integer productType,
        @Field(&quot;pmin&quot;)    Long priceMin,
        @Field(&quot;pmax&quot;)    Long priceMax,
        @Field(&quot;pwords&quot;)  String productKeywords,
        @Field(&quot;prow&quot;)    Long pageRowCount,
        @Field(&quot;pnum&quot;)    Long pageNum
    );
}
</code></pre>
<p><code>RetrofitHelper.java</code>：</p>
<pre><code class="language-java">public final class RetrofitHelper {

    private static RetrofitHelper retrofitHelper;

    private RetrofitHelper() {

    }

    public static RetrofitHelper getInstance() {
        return retrofitHelper==null ? (retrofitHelper = new RetrofitHelper())
                                    : retrofitHelper;
    }

    public JumboClient createJumboClient() {
        return createRetrofit(&quot;https://shoponjc.com&quot;).create(JumboClient.class);
    }

    private Retrofit createRetrofit(String baseUrl) {
        return new Retrofit.Builder()
                   .baseUrl(baseUrl)
                   .client(new OkHttpClient.Builder()
                               .readTimeout(10, SECONDS)
                               .connectTimeout(10, SECONDS)
                               .build())
                   .addConverterFactory(ScalarsConverterFactory.create())
                   .addConverterFactory(GsonConverterFactory.create(new GsonBuilder().setLenient().create()))
                   .build();
    }
}
</code></pre>
<p><code>Main.java</code>：</p>
<pre><code class="language-java">@Slf4j
public class Main {

    public static void main(String[] args) throws Exception {

        final JumboClient jumboClient = RetrofitHelper.getInstance().createJumboClient();

        // 拎資料
        jumboClient.getProductsByCategory(
            getSessionIdWithJsoup(), // sessionId
            3, // sortType
            true, // link
            5, // productType
            1L, // priceMin
            200000L, // priceMax
            &quot;&quot;, // productKeywords
            10000L, // pageRowCount
            0L // pageNum
        ).execute().body();
    }

    private static String getSessionIdWithJsoup() {

        try {
            final String html = Jsoup.connect(&quot;https://shoponjc.com/quote.php&quot;).get().html();

            final Matcher matcher = Pattern.compile(&quot;&lt;input type=\&quot;hidden\&quot; id=\&quot;sid\&quot; ref=\&quot;sid\&quot; value=\&quot;(?&lt;sessionId&gt;\\w+)\&quot;&quot;).matcher(html);
            final String sessionId = matcher.find() ? matcher.group(&quot;sessionId&quot;) : null;

            return sessionId;
        } catch (Exception e) {
            log.error(&quot;Failed to download Jumbo webpage.&quot;, e);
        }

        return null;
    }
}
</code></pre><hr/><div class="vstack gap-3"><div class="text-center container"><div class="justify-content-center g-3 row row-cols-md-3 row-cols-sm-2 row-cols-1"><div class="col"><a target="_blank" rel="external nofollow noopener noreferrer" class="SiteFooter_contact-item__2JRRr card" href="tel:+85263301333"><div class="card-body"><div class="card-title h5"><i class="fa-solid fa-phone" style="color:#009688"></i></div><p class="text-muted card-text">6330 1333<!-- --> </p></div></a></div><div class="col"><a target="_blank" rel="external nofollow noopener noreferrer" class="SiteFooter_contact-item__2JRRr card" href="mailto:michaelboyboy@gmail.com"><div class="card-body"><div class="card-title h5"><i class="fa-solid fa-envelope" style="color:#f44336"></i></div><p class="text-muted card-text">michaelboyboy@gmail.com<!-- --> </p></div></a></div><div class="col"><a target="_blank" rel="external nofollow noopener noreferrer" class="SiteFooter_contact-item__2JRRr card" href="https://www.linkedin.com/in/mickchung"><div class="card-body"><div class="card-title h5"><i class="fa-brands fa-linkedin" style="color:#2196f3"></i></div><p class="text-muted card-text">www.linkedin.com/in/mickchung<!-- --> </p></div></a></div></div></div></div></div><script src="/e2-next/_next/static/chunks/webpack-f088da4552bcc253.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[8287,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"2153\",\"static/chunks/2153-45fd9844831c6348.js\",\"7177\",\"static/chunks/app/layout-ea91c2d128ec48c2.js\"],\"default\"]\n3:I[3339,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"8974\",\"static/chunks/app/page-c8b940db14fac9a0.js\"],\"default\"]\n4:I[1367,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"2153\",\"static/chunks/2153-45fd9844831c6348.js\",\"7177\",\"static/chunks/app/layout-ea91c2d128ec48c2.js\"],\"default\"]\n5:I[5244,[],\"\"]\n6:I[3866,[],\"\"]\n7:I[4798,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"8974\",\"static/chunks/app/page-c8b940db14fac9a0.js\"],\"default\"]\n8:I[6121,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"8974\",\"static/chunks/app/page-c8b940db14fac9a0.js\"],\"default\"]\n9:I[3667,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"8974\",\"static/chunks/app/page-c8b940db14fac9a0.js\"],\"default\"]\na:I[8407,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"2153\",\"static/chunks/2153-45fd9844831c6348.js\",\"7177\",\"static/chunks/app/layout-ea91c2d128ec48c2.js\"],\"default\"]\nb:I[8173,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"8974\",\"static/chunks/app/page-c8b940db14fac9a0.js\"],\"\"]\nc:I[3197,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"2153\",\"static/chunks/2153-45fd9844831c6348.js\",\"7177\",\"static/chunks/app/layout-ea91c2d128ec48c2.js\"],\"default\"]\nd:I[7933,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"2153\",\"static/chunks/2153-45fd9844831c6348.js\",\"7177\",\"static/chunks/app/layout-ea91c2d128ec48c2.js\"],\"default\"]\ne:I[3800,[\"7829\",\"static/chunks/7829-b7b9eb1dbe0d40e4.js\",\"2153\",\"static/chunks/2153-45fd9844831c6348.js\",\"7177\",\"static/chunks/app/layout-ea91c2d128ec48c2.js\"],\"default\"]\n12:I[6213,[],\"OutletBoundary\"]\n14:I[6213,[],\"MetadataBoundary\"]\n16:I[6213,[],\"ViewportBoundary\"]\n18:I[4835,[],\"\"]\n:HL[\"/e2-next/_next/static/css/d3df112486f97f47.css\",\"style\"]\n:HL[\"/e2-next/_next/static/css/c3624a693ae5a0c4.css\",\"style\"]\nf:T5ce,actualSearch: function (pnum) {\r\n    /*\r\n    if (this.ptype == '') {\r\n        alert(\"Please select 產品類型 Pro"])</script><script>self.__next_f.push([1,"duct Type first.\");\r\n        return;\r\n    }\r\n    if (this.ptypeval.length \u003e 40) {\r\n        alert(\"關鍵字 Key words are too long, please re-enter first.\");\r\n        return;\r\n    }\r\n    */\r\n    if (this.searchFired == false) {\r\n        this.searchFired = true;\r\n        var form_data = new FormData();\r\n        form_data.append('session', this.session);\r\n        form_data.append('sort', this.nsort);\r\n        form_data.append('link', this.linkpicks);\r\n        form_data.append('ptype', this.ptype);\r\n        form_data.append('pmin', this.range[0]);\r\n        form_data.append('pmax', this.range[1]);\r\n        form_data.append('pwords', this.ptypeval);\r\n        form_data.append('prow', this.pagerow);\r\n        form_data.append('pnum', pnum);\r\n        ajax({\r\n            method: 'post',\r\n            url: 'getprod.php',\r\n            data: form_data\r\n        }).then(response =\u003e {\r\n            this.searchFired = false;\r\n            this.$nextTick(function () {\r\n                let json = response.data;\r\n                this.havedata = false;\r\n                if (json.status == 'Error') {\r\n                    alert(\"No product found!!\");\r\n                } else {\r\n                    this.plist = json.plist;\r\n                    if (json.plist.length \u003e= 10)\r\n                        this.havedata = true;\r\n                }\r\n            });\r\n        });\r\n    }\r\n},\n10:T40e,public final class RetrofitHelper {\r\n\r\n    private static RetrofitHelper retrofitHelper;\r\n\r\n    private RetrofitHelper() {\r\n\r\n    }\r\n\r\n    public static RetrofitHelper getInstance() {\r\n        return retrofitHelper==null ? (retrofitHelper = new RetrofitHelper())\r\n                                    : retrofitHelper;\r\n    }\r\n\r\n    public JumboClient createJumboClient() {\r\n        return createRetrofit(\"https://shoponjc.com\").create(JumboClient.class);\r\n    }\r\n\r\n    private Retrofit createRetrofit(String baseUrl) {\r\n        return new Retrofit.Builder()\r\n                   .baseUrl(baseUrl)\r\n                   .client(new OkHttpClient.Builder()\r\n                 "])</script><script>self.__next_f.push([1,"              .readTimeout(10, SECONDS)\r\n                               .connectTimeout(10, SECONDS)\r\n                               .build())\r\n                   .addConverterFactory(ScalarsConverterFactory.create())\r\n                   .addConverterFactory(GsonConverterFactory.create(new GsonBuilder().setLenient().create()))\r\n                   .build();\r\n    }\r\n}\n11:T492,@Slf4j\r\npublic class Main {\r\n\r\n    public static void main(String[] args) throws Exception {\r\n\r\n        final JumboClient jumboClient = RetrofitHelper.getInstance().createJumboClient();\r\n\r\n        // 拎資料\r\n        jumboClient.getProductsByCategory(\r\n            getSessionIdWithJsoup(), // sessionId\r\n            3, // sortType\r\n            true, // link\r\n            5, // productType\r\n            1L, // priceMin\r\n            200000L, // priceMax\r\n            \"\", // productKeywords\r\n            10000L, // pageRowCount\r\n            0L // pageNum\r\n        ).execute().body();\r\n    }\r\n\r\n    private static String getSessionIdWithJsoup() {\r\n\r\n        try {\r\n            final String html = Jsoup.connect(\"https://shoponjc.com/quote.php\").get().html();\r\n\r\n            final Matcher matcher = Pattern.compile(\"\u003cinput type=\\\"hidden\\\" id=\\\"sid\\\" ref=\\\"sid\\\" value=\\\"(?\u003csessionId\u003e\\\\w+)\\\"\").matcher(html);\r\n            final String sessionId = matcher.find() ? matcher.group(\"sessionId\") : null;\r\n\r\n            return sessionId;\r\n        } catch (Exception e) {\r\n            log.error(\"Failed to download Jumbo webpage.\", e);\r\n        }\r\n\r\n        return null;\r\n    }\r\n}\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"wfZ4FdS4ntgGvzjeKJhfw\",\"p\":\"/e2-next\",\"c\":[\"\",\"blog\",\"pull-data-with-retrofit\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[\"(2021-04)\",{\"children\":[\"pull-data-with-retrofit\",{\"children\":[\"__PAGE__\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/e2-next/_next/static/css/d3df112486f97f47.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/e2-next/_next/static/css/c3624a693ae5a0c4.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"href\":\"https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900\u0026display=swap\",\"rel\":\"stylesheet\"}],[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css\"}]]}],[\"$\",\"body\",null,{\"children\":[\"$\",\"$L2\",null,{\"children\":[\"$\",\"$L3\",null,{\"gap\":5,\"children\":[[\"$\",\"$L3\",null,{\"gap\":5,\"className\":\"text-center\",\"children\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"code\",null,{\"className\":\"SiteHeader_name__cwQmL\",\"children\":\"Chung Cheuk Hang Michael\"}],[\"$\",\"code\",null,{\"className\":\"SiteHeader_title__CCfvI\",\"children\":\"Java Web Developer\"}]]}],[\"$\",\"$L4\",null,{}]]}],[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}],[\"$\",\"hr\",null,{}],[\"$\",\"$L3\",null,{\"gap\":3,\"children\":[\"$\",\"$L7\",null,{\"className\":\"text-center\",\"children\":[\"$\",\"$L8\",null,{\"xs\":1,\"sm\":2,\"md\":3,\"className\":\"justify-content-center g-3\",\"children\":[[\"$\",\"$L9\",\"0\",{\"children\":[\"$\",\"$La\",null,{\"as\":\"$b\",\"href\":\"tel:+85263301333\",\"target\":\"_blank\",\"rel\":\"external nofollow noopener noreferrer\",\"className\":\"SiteFooter_contact-item__2JRRr\",\"children\":[\"$\",\"$Lc\",null,{\"children\":[[\"$\",\"$Ld\",null,{\"children\":[\"$\",\"i\",null,{\"className\":\"fa-solid fa-phone\",\"style\":{\"color\":\"#009688\"}}]}],[\"$\",\"$Le\",null,{\"className\":\"text-muted\",\"children\":[\"6330 1333\",\" \"]}]]}]}]}],[\"$\",\"$L9\",\"1\",{\"children\":[\"$\",\"$La\",null,{\"as\":\"$b\",\"href\":\"mailto:michaelboyboy@gmail.com\",\"target\":\"_blank\",\"rel\":\"external nofollow noopener noreferrer\",\"className\":\"SiteFooter_contact-item__2JRRr\",\"children\":[\"$\",\"$Lc\",null,{\"children\":[[\"$\",\"$Ld\",null,{\"children\":[\"$\",\"i\",null,{\"className\":\"fa-solid fa-envelope\",\"style\":{\"color\":\"#f44336\"}}]}],[\"$\",\"$Le\",null,{\"className\":\"text-muted\",\"children\":[\"michaelboyboy@gmail.com\",\" \"]}]]}]}]}],[\"$\",\"$L9\",\"2\",{\"children\":[\"$\",\"$La\",null,{\"as\":\"$b\",\"href\":\"https://www.linkedin.com/in/mickchung\",\"target\":\"_blank\",\"rel\":\"external nofollow noopener noreferrer\",\"className\":\"SiteFooter_contact-item__2JRRr\",\"children\":[\"$\",\"$Lc\",null,{\"children\":[[\"$\",\"$Ld\",null,{\"children\":[\"$\",\"i\",null,{\"className\":\"fa-brands fa-linkedin\",\"style\":{\"color\":\"#2196f3\"}}]}],[\"$\",\"$Le\",null,{\"className\":\"text-muted\",\"children\":[\"www.linkedin.com/in/mickchung\",\" \"]}]]}]}]}]]}]}]}]]}]}]}]]}]]}],{\"children\":[\"blog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"(2021-04)\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"(2021-04)\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"pull-data-with-retrofit\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"(2021-04)\",\"children\",\"pull-data-with-retrofit\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"h2\",null,{\"children\":\"1 關於 Retrofit\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Retrofit 係一個 HTTP client 既 Java library，可以幫我地做到 HTTP call，有啲似 Spring Cloud OpenFeign，都係行 declarative approach，透過 interface methods 既 annotations 以及 parameters 黎定義 HTTP 請求。\"}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"2 動手使用 Retrofit 下載資料\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"2.1 需求情境\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"試想像我地而家想寫一個程式，可以幫我地喺 Jumbo Computer 網站獲取電腦零件報價資訊。\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Jumbo Computer 既網址係：\",[\"$\",\"a\",null,{\"href\":\"https://shoponjc.com/quote.php\",\"children\":\"https://shoponjc.com/quote.php\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"透過 Chrome developer tools 既 Network 分頁，我地可以見到，當我地喺頁面選擇左「產品類型」之後，Jumbo Computer 會喺 XHR 分類下有個 \",[\"$\",\"code\",null,{\"children\":\"getprod.php\"}],\" 既 HTTP POST request，而 response body 係 JSON 格式。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"blog/2021-04/pull-data-with-retrofit/jumbo-http-response.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"2.2 分析\"}],\"\\n\",[\"$\",\"h4\",null,{\"children\":[\"2.2.1 必填的 \",[\"$\",\"code\",null,{\"children\":\"session\"}],\" form data\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"我地可以見到 Jumbo Computer 拎資料用既 HTTP POST request 係需要一個 \",[\"$\",\"code\",null,{\"children\":\"session\"}],\" 既 form data entry。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"經 Postman 一試，我地會發現如果個 HTTP request 缺少左 \",[\"$\",\"code\",null,{\"children\":\"session\"}],\"，又或者個 \",[\"$\",\"code\",null,{\"children\":\"session\"}],\" 值係我地自己改出黎既話，都會收到 error response，咁係因為 Jumbo Computer 既 server 會驗證呢個 \",[\"$\",\"code\",null,{\"children\":\"session\"}],\" 值。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"至於呢個 \",[\"$\",\"code\",null,{\"children\":\"session\"}],\" 值要點樣先可以拎到？實驗話畀我地知，呢個 \",[\"$\",\"code\",null,{\"children\":\"session\"}],\" 值好似唔會 expire，咁即係我地可以直接用已知既 \",[\"$\",\"code\",null,{\"children\":\"session\"}],\" 值。不過，穩陣起見，我地都係睇下佢係點樣攞到或者計到呢個 \",[\"$\",\"code\",null,{\"children\":\"session\"}],\" 值比較好。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"blog/2021-04/pull-data-with-retrofit/jumbo-http-request.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"blog/2021-04/pull-data-with-retrofit/postman.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h4\",null,{\"children\":[\"2.2.2 如何取得新的 \",[\"$\",\"code\",null,{\"children\":\"session\"}],\" 值\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"喺 Chrome developer tools 既 Application 分頁下面，我地可以見到 Local Storage 分類下，\",[\"$\",\"code\",null,{\"children\":\"shoponjc.com\"}],\" 有一個 \",[\"$\",\"code\",null,{\"children\":\"Key\"}],\" 為 \",[\"$\",\"code\",null,{\"children\":\"Session ID\"}],\" 既 entry。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"另外，喺 Chrome developer tools 既 Sources 分頁下面，我地可以見到 \",[\"$\",\"code\",null,{\"children\":\"shoponjc.com\"}],\" 有一個 JavaScript 檔叫 \",[\"$\",\"code\",null,{\"children\":\"quo.js?d83scwsoejkx6\"}],\"，裡面有以下一段：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-js\",\"children\":\"if (window.localStorage) {\\r\\n\\tstorage = window.localStorage;\\r\\n\\tstorage.setItem(\\\"Version\\\", \\\"1.0\\\");\\r\\n\\tstorage.setItem(\\\"Session ID\\\", document.getElementById(\\\"sid\\\").value);\\r\\n}\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"咁即係我地可以用 \",[\"$\",\"code\",null,{\"children\":\"sid\"}],\" 作為 DOM element ID 黎喺個網頁上搵 DOM element，而結果如下：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-html\",\"children\":\"\u003cinput type=\\\"hidden\\\" id=\\\"sid\\\" value=\\\"wpjfi557nqf75\\\" /\u003e\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"解讀：\"}],\" 每當我地瀏覽呢個網頁既時候，佢 server 會返回一個帶有隨機 session ID 既 DOM element 既 HTML 檔，然後 JavaScript 會令 Local Storage 裡面多左一個名為 \",[\"$\",\"code\",null,{\"children\":\"Session ID\"}],\" 既 entry。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"另外，我地都可以從個 JavaScript 檔見到個 \",[\"$\",\"code\",null,{\"children\":\"session\"}],\" 值係黎自於 \",[\"$\",\"code\",null,{\"children\":\"this.$refs.sid\"}],\"。因為個網頁係用 Vue.js library 黎寫，而 \",[\"$\",\"code\",null,{\"children\":\"this.$refs.sid\"}],\" 就即係指緊 DOM element ID 為 \",[\"$\",\"code\",null,{\"children\":\"sid\"}],\" 既 DOM element。\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-js\",\"children\":\"var vm = new Vue({\\r\\n\\t// ... 省略 500 幾行\\r\\n\\tmounted: function () {\\r\\n\\t\\tthis.session = this.$refs.sid.value;\\r\\n\\t\\t// ... 省略幾行\\r\\n\\t},\\r\\n});\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"解讀：\"}],\" 喺個 \",[\"$\",\"code\",null,{\"children\":\"sid\"}],\" DOM element mount 左之後，Vue.js 既 \",[\"$\",\"code\",null,{\"children\":\"session\"}],\"（\",[\"$\",\"code\",null,{\"children\":\"this.session\"}],\"）就會變成 \",[\"$\",\"code\",null,{\"children\":\"sid\"}],\" DOM element 既 \",[\"$\",\"code\",null,{\"children\":\"value\"}],\"。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"再睇下佢係點樣組裝 POST request 同 call 出去：\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-js\",\"children\":\"$f\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"解讀：\"}],\" 可以見到拎資料既 POST request 既 \",[\"$\",\"code\",null,{\"children\":\"session\"}],\" 係黎自於 Vue.js 既 \",[\"$\",\"code\",null,{\"children\":\"session\"}],\"（\",[\"$\",\"code\",null,{\"children\":\"this.session\"}],\"）。\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"成件事就係咁簡單！我地每次用 jsoup 下載個新既 HTML 落黎就可以拎到新既 session ID 值。\"}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"2.3 添加 Maven dependencies\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"我地會用到以下 Maven dependencies，當中包括 jsoup：\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-xml\",\"children\":\"\u003c!-- ##### jsoup ##### --\u003e\\r\\n\u003cdependency\u003e\\r\\n    \u003cgroupId\u003eorg.jsoup\u003c/groupId\u003e\\r\\n    \u003cartifactId\u003ejsoup\u003c/artifactId\u003e\\r\\n    \u003cversion\u003e1.13.1\u003c/version\u003e\\r\\n\u003c/dependency\u003e\\r\\n\\r\\n\u003c!-- ##### retrofit ##### --\u003e\\r\\n\u003cdependency\u003e\\r\\n    \u003cgroupId\u003ecom.squareup.retrofit2\u003c/groupId\u003e\\r\\n    \u003cartifactId\u003eretrofit\u003c/artifactId\u003e\\r\\n    \u003cversion\u003e2.9.0\u003c/version\u003e\\r\\n\u003c/dependency\u003e\\r\\n\u003cdependency\u003e\\r\\n    \u003cgroupId\u003ecom.squareup.retrofit2\u003c/groupId\u003e\\r\\n    \u003cartifactId\u003econverter-scalars\u003c/artifactId\u003e\\r\\n    \u003cversion\u003e2.9.0\u003c/version\u003e\\r\\n\u003c/dependency\u003e\\r\\n\u003cdependency\u003e\\r\\n    \u003cgroupId\u003ecom.squareup.retrofit2\u003c/groupId\u003e\\r\\n    \u003cartifactId\u003econverter-gson\u003c/artifactId\u003e\\r\\n    \u003cversion\u003e2.9.0\u003c/version\u003e\\r\\n\u003c/dependency\u003e\\n\"}]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"2.4 寫 Java code\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"ProductsResponse.java\"}],\"：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-java\",\"children\":\"@Data\\r\\n@Accessors(chain = true)\\r\\n@FieldDefaults(level = PRIVATE)\\r\\npublic class ProductsResponse {\\r\\n    String status;\\r\\n    String session;\\r\\n\\r\\n    @SerializedName(\\\"plist\\\")\\r\\n    List\u003cProduct\u003e products;\\r\\n}\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"JumboClient.java\"}],\"：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-java\",\"children\":\"public interface JumboClient {\\r\\n\\r\\n    @FormUrlEncoded\\r\\n    @POST(\\\"getprod.php\\\")\\r\\n    Call\u003cProductsResponse\u003e getProductsByCategory(\\r\\n        @Field(\\\"session\\\") String session,\\r\\n        @Field(\\\"sort\\\")    Integer sortType,\\r\\n        @Field(\\\"link\\\")    Boolean link,\\r\\n        @Field(\\\"ptype\\\")   Integer productType,\\r\\n        @Field(\\\"pmin\\\")    Long priceMin,\\r\\n        @Field(\\\"pmax\\\")    Long priceMax,\\r\\n        @Field(\\\"pwords\\\")  String productKeywords,\\r\\n        @Field(\\\"prow\\\")    Long pageRowCount,\\r\\n        @Field(\\\"pnum\\\")    Long pageNum\\r\\n    );\\r\\n}\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"RetrofitHelper.java\"}],\"：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-java\",\"children\":\"$10\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"Main.java\"}],\"：\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-java\",\"children\":\"$11\"}]}]],null,[\"$\",\"$L12\",null,{\"children\":\"$L13\"}]]}],{},null,false]},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"mcaerwj_Xia2ukdKXo_8O\",{\"children\":[[\"$\",\"$L14\",null,{\"children\":\"$L15\"}],[\"$\",\"$L16\",null,{\"children\":\"$L17\"}],null]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$18\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"17:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n15:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Michael Chung's e-Portfolio\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Powered by Next.js and React\"}]]\n"])</script><script>self.__next_f.push([1,"13:null\n"])</script></body></html>