1:"$Sreact.fragment"
2:I[8287,["7829","static/chunks/7829-b7b9eb1dbe0d40e4.js","2153","static/chunks/2153-45fd9844831c6348.js","7177","static/chunks/app/layout-ea91c2d128ec48c2.js"],"default"]
3:I[3339,["7829","static/chunks/7829-b7b9eb1dbe0d40e4.js","8974","static/chunks/app/page-c8b940db14fac9a0.js"],"default"]
4:I[1367,["7829","static/chunks/7829-b7b9eb1dbe0d40e4.js","2153","static/chunks/2153-45fd9844831c6348.js","7177","static/chunks/app/layout-ea91c2d128ec48c2.js"],"default"]
5:I[5244,[],""]
6:I[3866,[],""]
7:I[4798,["7829","static/chunks/7829-b7b9eb1dbe0d40e4.js","8974","static/chunks/app/page-c8b940db14fac9a0.js"],"default"]
8:I[6121,["7829","static/chunks/7829-b7b9eb1dbe0d40e4.js","8974","static/chunks/app/page-c8b940db14fac9a0.js"],"default"]
9:I[3667,["7829","static/chunks/7829-b7b9eb1dbe0d40e4.js","8974","static/chunks/app/page-c8b940db14fac9a0.js"],"default"]
a:I[8407,["7829","static/chunks/7829-b7b9eb1dbe0d40e4.js","2153","static/chunks/2153-45fd9844831c6348.js","7177","static/chunks/app/layout-ea91c2d128ec48c2.js"],"default"]
b:I[8173,["7829","static/chunks/7829-b7b9eb1dbe0d40e4.js","8974","static/chunks/app/page-c8b940db14fac9a0.js"],""]
c:I[3197,["7829","static/chunks/7829-b7b9eb1dbe0d40e4.js","2153","static/chunks/2153-45fd9844831c6348.js","7177","static/chunks/app/layout-ea91c2d128ec48c2.js"],"default"]
d:I[7933,["7829","static/chunks/7829-b7b9eb1dbe0d40e4.js","2153","static/chunks/2153-45fd9844831c6348.js","7177","static/chunks/app/layout-ea91c2d128ec48c2.js"],"default"]
e:I[3800,["7829","static/chunks/7829-b7b9eb1dbe0d40e4.js","2153","static/chunks/2153-45fd9844831c6348.js","7177","static/chunks/app/layout-ea91c2d128ec48c2.js"],"default"]
f:I[6213,[],"OutletBoundary"]
11:I[6213,[],"MetadataBoundary"]
13:I[6213,[],"ViewportBoundary"]
15:I[4835,[],""]
:HL["/e2-next/_next/static/css/d3df112486f97f47.css","style"]
:HL["/e2-next/_next/static/css/c3624a693ae5a0c4.css","style"]
:HL["/e2-next/_next/static/css/952e59b04e0cf1ba.css","style"]
0:{"P":null,"b":"tXK536U4PDqeufRbPqEod","p":"/e2-next","c":["","blog","spring-boot-micrometer-tracing"],"i":false,"f":[[["",{"children":["blog",{"children":["(2024-03)",{"children":["spring-boot-micrometer-tracing",{"children":["__PAGE__",{}]}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/e2-next/_next/static/css/d3df112486f97f47.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","link","1",{"rel":"stylesheet","href":"/e2-next/_next/static/css/c3624a693ae5a0c4.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","children":[["$","head",null,{"children":[["$","link",null,{"href":"https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap","rel":"stylesheet"}],["$","link",null,{"rel":"stylesheet","href":"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"}]]}],["$","body",null,{"children":["$","$L2",null,{"children":["$","$L3",null,{"gap":5,"children":[["$","$L3",null,{"gap":5,"className":"text-center","children":[["$","div",null,{"children":[["$","code",null,{"className":"SiteHeader_name__cwQmL","children":"Chung Cheuk Hang Michael"}],["$","code",null,{"className":"SiteHeader_title__CCfvI","children":"Java Web Developer"}]]}],["$","$L4",null,{}]]}],["$","$L5",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[],[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]]],"forbidden":"$undefined","unauthorized":"$undefined"}],["$","hr",null,{}],["$","$L3",null,{"gap":3,"children":["$","$L7",null,{"className":"text-center","children":["$","$L8",null,{"xs":1,"sm":2,"md":3,"className":"justify-content-center g-3","children":[["$","$L9","0",{"children":["$","$La",null,{"as":"$b","href":"tel:+85263301333","target":"_blank","rel":"external nofollow noopener noreferrer","className":"SiteFooter_contact-item__2JRRr","children":["$","$Lc",null,{"children":[["$","$Ld",null,{"children":["$","i",null,{"className":"fa-solid fa-phone","style":{"color":"#009688"}}]}],["$","$Le",null,{"className":"text-muted","children":["6330 1333"," "]}]]}]}]}],["$","$L9","1",{"children":["$","$La",null,{"as":"$b","href":"mailto:michaelboyboy@gmail.com","target":"_blank","rel":"external nofollow noopener noreferrer","className":"SiteFooter_contact-item__2JRRr","children":["$","$Lc",null,{"children":[["$","$Ld",null,{"children":["$","i",null,{"className":"fa-solid fa-envelope","style":{"color":"#f44336"}}]}],["$","$Le",null,{"className":"text-muted","children":["michaelboyboy@gmail.com"," "]}]]}]}]}],["$","$L9","2",{"children":["$","$La",null,{"as":"$b","href":"https://www.linkedin.com/in/mickchung","target":"_blank","rel":"external nofollow noopener noreferrer","className":"SiteFooter_contact-item__2JRRr","children":["$","$Lc",null,{"children":[["$","$Ld",null,{"children":["$","i",null,{"className":"fa-brands fa-linkedin","style":{"color":"#2196f3"}}]}],["$","$Le",null,{"className":"text-muted","children":["www.linkedin.com/in/mickchung"," "]}]]}]}]}]]}]}]}]]}]}]}]]}]]}],{"children":["blog",["$","$1","c",{"children":[null,["$","$L5",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["(2024-03)",["$","$1","c",{"children":[null,["$","$L5",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","(2024-03)","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["spring-boot-micrometer-tracing",["$","$1","c",{"children":[null,["$","$L5",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","(2024-03)","children","spring-boot-micrometer-tracing","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":[[["$","h1",null,{"style":{"fontWeight":"bold"},"children":"1 Spring Boot 3 既 micrometer tracing"}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":"Spring Boot 3 既其中一個比較大既改變，就係唔再支援 Spring Boot Sleuth（又或者話 Spring Boot Sleuth 唔支援 Spring Boot 3）。"}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":["根據 ",["$","a",null,{"href":"https://docs.spring.io/spring-cloud-sleuth/docs/current/reference/html/","children":"Spring Cloud Sleuth 官方文檔"}],"："]}],"\n",["$","blockquote",null,{"children":["\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":"!!!! IMPORTANT !!!!"}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":"Spring Cloud Sleuth’s last minor version is 3.1. You can check the 3.1.x branch for the latest commits.\r\nSpring Cloud Sleuth will not work with Spring Boot 3.x onward. The last major version of Spring Boot that Sleuth will support is 2.x."}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":["The core of this project got moved to ",["$","a",null,{"href":"https://micrometer.io/docs/tracing","children":"Micrometer Tracing"}]," project and the instrumentations will be moved to ",["$","a",null,{"href":"https://micrometer.io/","children":"Micrometer"}]," and all respective projects (no longer all instrumentations will be done in a single repository."]}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":["You can check the ",["$","a",null,{"href":"https://github.com/micrometer-metrics/tracing/wiki/Spring-Cloud-Sleuth-3.1-Migration-Guide","children":"Micrometer Tracing migration guide"}]," to learn how to migrate from Spring Cloud Sleuth to Micrometer Tracing."]}],"\n"]}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":"即係話，如果我地想繼續喺 HTTP requests 度加入 trace ID、span ID，我地要改用 micrometer tracing。"}],"\n",["$","hr",null,{}],"\n",["$","h1",null,{"style":{"fontWeight":"bold"},"children":"2 定義"}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":"喺 distributed tracing 裡面，我地有 trace ID、span ID 呢兩個 terms。"}],"\n",["$","h2",null,{"style":{"fontWeight":"bold"},"children":"2.1 Trace ID"}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":"Trace ID 代表緊一個 distributed 既 request workflow，而呢個 request 會訪問好幾個 back-end microservices。利用同一個 trace ID 可以幫我地串連呢啲 back-end microservices，方便我地將同一個 request 既所有 microservices 既所有 application logs 搵出黎 troubleshoot 或者 debug。"}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":["進入一個新既 request workflow 既第一個 microservice 會負責生成 trace ID，然後當佢 send HTTP request 去佢既 downstream microservice 既時候，佢會喺個 HTTP request 加入一個 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"traceparent"}]," request header，而個 header value 既格式應該要符合 W3C 既 Trace Context 標準。"]}],"\n",["$","hr",null,{}],"\n",["$","h2",null,{"style":{"fontWeight":"bold"},"children":"2.2 Span ID"}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":"Span ID 代表緊一個 request workflow 裡面既其中一小個 operation，係某一個 microservice 既某一個 operation unit。"}],"\n",["$","hr",null,{}],"\n",["$","h1",null,{"style":{"fontWeight":"bold"},"children":"3 動手寫"}],"\n",["$","h2",null,{"style":{"fontWeight":"bold"},"children":"3.1 Maven dependencies"}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":"所有 microservices 都要有以下既 Maven dependencies："}],"\n",["$","pre",null,{"children":["$","div",null,{"className":"mdx-components_code__3gNm1","style":{"color":"black","background":"#f5f2f0","textShadow":"0 1px white","fontFamily":"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace","fontSize":"1em","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","wordWrap":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","padding":"1em","margin":".5em 0","overflow":"auto"},"children":["$","code",null,{"className":"language-xml","style":{"whiteSpace":"pre","color":"black","background":"none","textShadow":"0 1px white","fontFamily":"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace","fontSize":"1em","textAlign":"left","wordSpacing":"normal","wordBreak":"normal","wordWrap":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","code-segement0",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement1",{"className":"token","style":{"color":"#905"},"children":["parent"]}],["$","span","code-segement2",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement3",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement4",{"className":"$undefined","style":{},"children":["\t"]}],["$","span","code-segement5",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement6",{"className":"token","style":{"color":"#905"},"children":["groupId"]}],["$","span","code-segement7",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement8",{"className":"$undefined","style":{},"children":["org.springframework.boot"]}],["$","span","code-segement9",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement10",{"className":"token","style":{"color":"#905"},"children":["groupId"]}],["$","span","code-segement11",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement12",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement13",{"className":"$undefined","style":{},"children":["\t"]}],["$","span","code-segement14",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement15",{"className":"token","style":{"color":"#905"},"children":["artifactId"]}],["$","span","code-segement16",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement17",{"className":"$undefined","style":{},"children":["spring-boot-starter-parent"]}],["$","span","code-segement18",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement19",{"className":"token","style":{"color":"#905"},"children":["artifactId"]}],["$","span","code-segement20",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement21",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement22",{"className":"$undefined","style":{},"children":["\t"]}],["$","span","code-segement23",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement24",{"className":"token","style":{"color":"#905"},"children":["version"]}],["$","span","code-segement25",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement26",{"className":"$undefined","style":{},"children":["3.2.3"]}],["$","span","code-segement27",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement28",{"className":"token","style":{"color":"#905"},"children":["version"]}],["$","span","code-segement29",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement30",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement31",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement32",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement33",{"className":"token","style":{"color":"#905"},"children":["parent"]}],["$","span","code-segement34",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement35",{"className":"$undefined","style":{},"children":["\r\n"]}],"\r\n",["$","span","code-segement37",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement38",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement39",{"className":"token","style":{"color":"#905"},"children":["dependency"]}],["$","span","code-segement40",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement41",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement42",{"className":"$undefined","style":{},"children":["\t"]}],["$","span","code-segement43",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement44",{"className":"token","style":{"color":"#905"},"children":["groupId"]}],["$","span","code-segement45",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement46",{"className":"$undefined","style":{},"children":["io.micrometer"]}],["$","span","code-segement47",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement48",{"className":"token","style":{"color":"#905"},"children":["groupId"]}],["$","span","code-segement49",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement50",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement51",{"className":"$undefined","style":{},"children":["\t"]}],["$","span","code-segement52",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement53",{"className":"token","style":{"color":"#905"},"children":["artifactId"]}],["$","span","code-segement54",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement55",{"className":"$undefined","style":{},"children":["micrometer-registry-prometheus"]}],["$","span","code-segement56",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement57",{"className":"token","style":{"color":"#905"},"children":["artifactId"]}],["$","span","code-segement58",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement59",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement60",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement61",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement62",{"className":"token","style":{"color":"#905"},"children":["dependency"]}],["$","span","code-segement63",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement64",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement65",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement66",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement67",{"className":"token","style":{"color":"#905"},"children":["dependency"]}],["$","span","code-segement68",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement69",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement70",{"className":"$undefined","style":{},"children":["\t"]}],["$","span","code-segement71",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement72",{"className":"token","style":{"color":"#905"},"children":["groupId"]}],["$","span","code-segement73",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement74",{"className":"$undefined","style":{},"children":["io.micrometer"]}],["$","span","code-segement75",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement76",{"className":"token","style":{"color":"#905"},"children":["groupId"]}],["$","span","code-segement77",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement78",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement79",{"className":"$undefined","style":{},"children":["\t"]}],["$","span","code-segement80",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement81",{"className":"token","style":{"color":"#905"},"children":["artifactId"]}],["$","span","code-segement82",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement83",{"className":"$undefined","style":{},"children":["micrometer-tracing-bridge-brave"]}],["$","span","code-segement84",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement85",{"className":"token","style":{"color":"#905"},"children":["artifactId"]}],["$","span","code-segement86",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement87",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement88",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement89",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement90",{"className":"token","style":{"color":"#905"},"children":["dependency"]}],["$","span","code-segement91",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement92",{"className":"$undefined","style":{},"children":["\r\n"]}],"\r\n",["$","span","code-segement94",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement95",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement96",{"className":"token","style":{"color":"#905"},"children":["dependency"]}],["$","span","code-segement97",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement98",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement99",{"className":"$undefined","style":{},"children":["\t"]}],["$","span","code-segement100",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement101",{"className":"token","style":{"color":"#905"},"children":["groupId"]}],["$","span","code-segement102",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement103",{"className":"$undefined","style":{},"children":["net.logstash.logback"]}],["$","span","code-segement104",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement105",{"className":"token","style":{"color":"#905"},"children":["groupId"]}],["$","span","code-segement106",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement107",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement108",{"className":"$undefined","style":{},"children":["\t"]}],["$","span","code-segement109",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement110",{"className":"token","style":{"color":"#905"},"children":["artifactId"]}],["$","span","code-segement111",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement112",{"className":"$undefined","style":{},"children":["logstash-logback-encoder"]}],["$","span","code-segement113",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement114",{"className":"token","style":{"color":"#905"},"children":["artifactId"]}],["$","span","code-segement115",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement116",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement117",{"className":"$undefined","style":{},"children":["\t"]}],["$","span","code-segement118",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement119",{"className":"token","style":{"color":"#905"},"children":["version"]}],["$","span","code-segement120",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement121",{"className":"$undefined","style":{},"children":["7.2"]}],["$","span","code-segement122",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement123",{"className":"token","style":{"color":"#905"},"children":["version"]}],["$","span","code-segement124",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement125",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement126",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement127",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement128",{"className":"token","style":{"color":"#905"},"children":["dependency"]}],["$","span","code-segement129",{"className":"token","style":{"color":"#999"},"children":[">"]}]]]}]}]}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":["如果需要用 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"WebClient"}]," 去 call downstream microservice 既話就加："]}],"\n",["$","pre",null,{"children":["$","div",null,{"className":"mdx-components_code__3gNm1","style":{"color":"black","background":"#f5f2f0","textShadow":"0 1px white","fontFamily":"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace","fontSize":"1em","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","wordWrap":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","padding":"1em","margin":".5em 0","overflow":"auto"},"children":["$","code",null,{"className":"language-xml","style":{"whiteSpace":"pre","color":"black","background":"none","textShadow":"0 1px white","fontFamily":"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace","fontSize":"1em","textAlign":"left","wordSpacing":"normal","wordBreak":"normal","wordWrap":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","code-segement0",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement1",{"className":"token","style":{"color":"#905"},"children":["dependency"]}],["$","span","code-segement2",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement3",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement4",{"className":"$undefined","style":{},"children":["\t"]}],["$","span","code-segement5",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement6",{"className":"token","style":{"color":"#905"},"children":["groupId"]}],["$","span","code-segement7",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement8",{"className":"$undefined","style":{},"children":["org.springframework"]}],["$","span","code-segement9",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement10",{"className":"token","style":{"color":"#905"},"children":["groupId"]}],["$","span","code-segement11",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement12",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement13",{"className":"$undefined","style":{},"children":["\t"]}],["$","span","code-segement14",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement15",{"className":"token","style":{"color":"#905"},"children":["artifactId"]}],["$","span","code-segement16",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement17",{"className":"$undefined","style":{},"children":["spring-webflux"]}],["$","span","code-segement18",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement19",{"className":"token","style":{"color":"#905"},"children":["artifactId"]}],["$","span","code-segement20",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement21",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement22",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement23",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement24",{"className":"token","style":{"color":"#905"},"children":["dependency"]}],["$","span","code-segement25",{"className":"token","style":{"color":"#999"},"children":[">"]}]]]}]}]}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":"如果需要用 OpenFeign 去 call downstream microservice 既話就加："}],"\n",["$","pre",null,{"children":["$","div",null,{"className":"mdx-components_code__3gNm1","style":{"color":"black","background":"#f5f2f0","textShadow":"0 1px white","fontFamily":"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace","fontSize":"1em","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","wordWrap":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","padding":"1em","margin":".5em 0","overflow":"auto"},"children":["$","code",null,{"className":"language-xml","style":{"whiteSpace":"pre","color":"black","background":"none","textShadow":"0 1px white","fontFamily":"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace","fontSize":"1em","textAlign":"left","wordSpacing":"normal","wordBreak":"normal","wordWrap":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","code-segement0",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement1",{"className":"token","style":{"color":"#905"},"children":["dependency"]}],["$","span","code-segement2",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement3",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement4",{"className":"$undefined","style":{},"children":["\t"]}],["$","span","code-segement5",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement6",{"className":"token","style":{"color":"#905"},"children":["groupId"]}],["$","span","code-segement7",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement8",{"className":"$undefined","style":{},"children":["org.springframework.cloud"]}],["$","span","code-segement9",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement10",{"className":"token","style":{"color":"#905"},"children":["groupId"]}],["$","span","code-segement11",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement12",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement13",{"className":"$undefined","style":{},"children":["\t"]}],["$","span","code-segement14",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement15",{"className":"token","style":{"color":"#905"},"children":["artifactId"]}],["$","span","code-segement16",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement17",{"className":"$undefined","style":{},"children":["spring-cloud-starter-openfeign"]}],["$","span","code-segement18",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement19",{"className":"token","style":{"color":"#905"},"children":["artifactId"]}],["$","span","code-segement20",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement21",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement22",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement23",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement24",{"className":"token","style":{"color":"#905"},"children":["dependency"]}],["$","span","code-segement25",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement26",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement27",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement28",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement29",{"className":"token","style":{"color":"#905"},"children":["dependency"]}],["$","span","code-segement30",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement31",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement32",{"className":"$undefined","style":{},"children":["\t"]}],["$","span","code-segement33",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement34",{"className":"token","style":{"color":"#905"},"children":["groupId"]}],["$","span","code-segement35",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement36",{"className":"$undefined","style":{},"children":["io.github.openfeign"]}],["$","span","code-segement37",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement38",{"className":"token","style":{"color":"#905"},"children":["groupId"]}],["$","span","code-segement39",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement40",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement41",{"className":"$undefined","style":{},"children":["\t"]}],["$","span","code-segement42",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement43",{"className":"token","style":{"color":"#905"},"children":["artifactId"]}],["$","span","code-segement44",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement45",{"className":"$undefined","style":{},"children":["feign-micrometer"]}],["$","span","code-segement46",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement47",{"className":"token","style":{"color":"#905"},"children":["artifactId"]}],["$","span","code-segement48",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement49",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement50",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement51",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement52",{"className":"token","style":{"color":"#905"},"children":["dependency"]}],["$","span","code-segement53",{"className":"token","style":{"color":"#999"},"children":[">"]}]]]}]}]}],"\n",["$","hr",null,{}],"\n",["$","h2",null,{"style":{"fontWeight":"bold"},"children":"3.2 寫 Java code"}],"\n",["$","h3",null,{"style":{"fontWeight":"bold"},"children":["3.2.1 Spring ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"RestTemplate"}]]}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":["如果要令到 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"RestTemplate"}]," 識得喺 request header 度 forward micrometer tracing 既 data 去 downstream microservice 度，就要用 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"RestTemplateBuilder"}]," bean 去創建 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"RestTemplate"}],"："]}],"\n",["$","pre",null,{"children":["$","div",null,{"className":"mdx-components_code__3gNm1","style":{"color":"black","background":"#f5f2f0","textShadow":"0 1px white","fontFamily":"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace","fontSize":"1em","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","wordWrap":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","padding":"1em","margin":".5em 0","overflow":"auto"},"children":["$","code",null,{"className":"language-java","style":{"whiteSpace":"pre","color":"black","background":"none","textShadow":"0 1px white","fontFamily":"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace","fontSize":"1em","textAlign":"left","wordSpacing":"normal","wordBreak":"normal","wordWrap":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","code-segement0",{"className":"token annotation","style":{"color":"#999"},"children":["@Configuration"]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement2",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement3",{"className":"token","style":{"color":"#07a"},"children":["public"]}],["$","span","code-segement4",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement5",{"className":"token","style":{"color":"#07a"},"children":["class"]}],["$","span","code-segement6",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement7",{"className":"token","style":{"color":"#DD4A68"},"children":["RestTemplateConfig"]}],["$","span","code-segement8",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement9",{"className":"token","style":{"color":"#999"},"children":["{"]}],["$","span","code-segement10",{"className":"$undefined","style":{},"children":["\r\n"]}],"\r\n",["$","span","code-segement12",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segement13",{"className":"token annotation","style":{"color":"#999"},"children":["@Bean"]}],["$","span","code-segement14",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement15",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segement16",{"className":"token","style":{"color":"#DD4A68"},"children":["RestTemplate"]}],["$","span","code-segement17",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement18",{"className":"token","style":{"color":"#DD4A68"},"children":["restTemplate"]}],["$","span","code-segement19",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement20",{"className":"token","style":{"color":"#DD4A68"},"children":["RestTemplateBuilder"]}],["$","span","code-segement21",{"className":"$undefined","style":{},"children":[" builder"]}],["$","span","code-segement22",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement23",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement24",{"className":"token","style":{"color":"#999"},"children":["{"]}],["$","span","code-segement25",{"className":"$undefined","style":{},"children":["\r\n"]}],"\r\n",["$","span","code-segement27",{"className":"$undefined","style":{},"children":["        "]}],["$","span","code-segement28",{"className":"token","style":{"color":"#07a"},"children":["final"]}],["$","span","code-segement29",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement30",{"className":"token","style":{"color":"#DD4A68"},"children":["RestTemplate"]}],["$","span","code-segement31",{"className":"$undefined","style":{},"children":[" restTemplate "]}],["$","span","code-segement32",{"className":"token","style":{"color":"#9a6e3a","background":"hsla(0, 0%, 100%, .5)"},"children":["="]}],["$","span","code-segement33",{"className":"$undefined","style":{},"children":[" builder\r\n"]}],["$","span","code-segement34",{"className":"$undefined","style":{},"children":["            "]}],["$","span","code-segement35",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement36",{"className":"token","style":{"color":"#DD4A68"},"children":["setConnectTimeout"]}],["$","span","code-segement37",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement38",{"className":"token","style":{"color":"#DD4A68"},"children":["Duration"]}],["$","span","code-segement39",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement40",{"className":"token","style":{"color":"#DD4A68"},"children":["ofSeconds"]}],["$","span","code-segement41",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement42",{"className":"token","style":{"color":"#905"},"children":["10"]}],["$","span","code-segement43",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement44",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement45",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement46",{"className":"$undefined","style":{},"children":["            "]}],["$","span","code-segement47",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement48",{"className":"token","style":{"color":"#DD4A68"},"children":["basicAuthentication"]}],["$","span","code-segement49",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement50",{"className":"token","style":{"color":"#690"},"children":["\"username\""]}],["$","span","code-segement51",{"className":"token","style":{"color":"#999"},"children":[","]}],["$","span","code-segement52",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement53",{"className":"token","style":{"color":"#690"},"children":["\"password\""]}],["$","span","code-segement54",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement55",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement56",{"className":"$undefined","style":{},"children":["            "]}],["$","span","code-segement57",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement58",{"className":"token","style":{"color":"#DD4A68"},"children":["defaultHeader"]}],["$","span","code-segement59",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement60",{"className":"token","style":{"color":"#690"},"children":["\"header1\""]}],["$","span","code-segement61",{"className":"token","style":{"color":"#999"},"children":[","]}],["$","span","code-segement62",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement63",{"className":"token","style":{"color":"#690"},"children":["\"header1-value\""]}],["$","span","code-segement64",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement65",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement66",{"className":"$undefined","style":{},"children":["            "]}],["$","span","code-segement67",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement68",{"className":"token","style":{"color":"#DD4A68"},"children":["defaultHeader"]}],["$","span","code-segement69",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement70",{"className":"token","style":{"color":"#690"},"children":["\"header2\""]}],["$","span","code-segement71",{"className":"token","style":{"color":"#999"},"children":[","]}],["$","span","code-segement72",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement73",{"className":"token","style":{"color":"#690"},"children":["\"header2-value\""]}],["$","span","code-segement74",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement75",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement76",{"className":"$undefined","style":{},"children":["            "]}],["$","span","code-segement77",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement78",{"className":"token","style":{"color":"#DD4A68"},"children":["build"]}],["$","span","code-segement79",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement80",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement81",{"className":"token","style":{"color":"#999"},"children":[";"]}],["$","span","code-segement82",{"className":"$undefined","style":{},"children":["\r\n"]}],"\r\n",["$","span","code-segement84",{"className":"$undefined","style":{},"children":["        "]}],["$","span","code-segement85",{"className":"token","style":{"color":"slategray"},"children":["// 如果加入左 jackson-dataformat-xml"]}],["$","span","code-segement86",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement87",{"className":"$undefined","style":{},"children":["        "]}],["$","span","code-segement88",{"className":"token","style":{"color":"slategray"},"children":["// 令 RestTemplate 唔好喺 Accept request header 度加入 application/xml 或相關既 values"]}],["$","span","code-segement89",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement90",{"className":"$undefined","style":{},"children":["        restTemplate"]}],["$","span","code-segement91",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement92",{"className":"token","style":{"color":"#DD4A68"},"children":["getMessageConverters"]}],["$","span","code-segement93",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement94",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement95",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement96",{"className":"$undefined","style":{},"children":["            "]}],["$","span","code-segement97",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement98",{"className":"token","style":{"color":"#DD4A68"},"children":["removeIf"]}],["$","span","code-segement99",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement100",{"className":"$undefined","style":{},"children":["e "]}],["$","span","code-segement101",{"className":"token","style":{"color":"#9a6e3a","background":"hsla(0, 0%, 100%, .5)"},"children":["->"]}],["$","span","code-segement102",{"className":"$undefined","style":{},"children":[" e"]}],["$","span","code-segement103",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement104",{"className":"token","style":{"color":"#DD4A68"},"children":["getClass"]}],["$","span","code-segement105",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement106",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement107",{"className":"token","style":{"color":"#9a6e3a","background":"hsla(0, 0%, 100%, .5)"},"children":["=="]}],["$","span","code-segement108",{"className":"token","style":{"color":"#DD4A68"},"children":["MappingJackson2XmlHttpMessageConverter"]}],["$","span","code-segement109",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement110",{"className":"token","style":{"color":"#07a"},"children":["class"]}],["$","span","code-segement111",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement112",{"className":"token","style":{"color":"#999"},"children":[";"]}],["$","span","code-segement113",{"className":"$undefined","style":{},"children":["\r\n"]}],"\r\n",["$","span","code-segement115",{"className":"$undefined","style":{},"children":["        "]}],["$","span","code-segement116",{"className":"token","style":{"color":"#07a"},"children":["return"]}],["$","span","code-segement117",{"className":"$undefined","style":{},"children":[" restTemplate"]}],["$","span","code-segement118",{"className":"token","style":{"color":"#999"},"children":[";"]}],["$","span","code-segement119",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement120",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segement121",{"className":"token","style":{"color":"#999"},"children":["}"]}],["$","span","code-segement122",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement123",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement124",{"className":"token","style":{"color":"#999"},"children":["}"]}]]]}]}]}],"\n",["$","hr",null,{}],"\n",["$","h3",null,{"style":{"fontWeight":"bold"},"children":["3.2.2 Spring Webflux ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"WebClient"}]]}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":["如果要令到 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"WebClient"}]," 識得喺 request header 度 forward micrometer tracing 既 data 去 downstream microservice 度，就要用 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"WebClient.Builder"}]," bean 去創建 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"WebClient"}],"："]}],"\n",["$","pre",null,{"children":["$","div",null,{"className":"mdx-components_code__3gNm1","style":{"color":"black","background":"#f5f2f0","textShadow":"0 1px white","fontFamily":"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace","fontSize":"1em","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","wordWrap":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","padding":"1em","margin":".5em 0","overflow":"auto"},"children":["$","code",null,{"className":"language-java","style":{"whiteSpace":"pre","color":"black","background":"none","textShadow":"0 1px white","fontFamily":"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace","fontSize":"1em","textAlign":"left","wordSpacing":"normal","wordBreak":"normal","wordWrap":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","code-segement0",{"className":"token annotation","style":{"color":"#999"},"children":["@Configuration"]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement2",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement3",{"className":"token","style":{"color":"#07a"},"children":["public"]}],["$","span","code-segement4",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement5",{"className":"token","style":{"color":"#07a"},"children":["class"]}],["$","span","code-segement6",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement7",{"className":"token","style":{"color":"#DD4A68"},"children":["WebClientConfig"]}],["$","span","code-segement8",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement9",{"className":"token","style":{"color":"#999"},"children":["{"]}],["$","span","code-segement10",{"className":"$undefined","style":{},"children":["\r\n"]}],"\r\n",["$","span","code-segement12",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segement13",{"className":"token annotation","style":{"color":"#999"},"children":["@Bean"]}],["$","span","code-segement14",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement15",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segement16",{"className":"token","style":{"color":"#DD4A68"},"children":["WebClient"]}],["$","span","code-segement17",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement18",{"className":"token","style":{"color":"#DD4A68"},"children":["webClient"]}],["$","span","code-segement19",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement20",{"className":"token","style":{"color":"#DD4A68"},"children":["WebClient"]}],["$","span","code-segement21",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement22",{"className":"token","style":{"color":"#DD4A68"},"children":["Builder"]}],["$","span","code-segement23",{"className":"$undefined","style":{},"children":[" builder"]}],["$","span","code-segement24",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement25",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement26",{"className":"token","style":{"color":"#999"},"children":["{"]}],["$","span","code-segement27",{"className":"$undefined","style":{},"children":["\r\n"]}],"\r\n",["$","span","code-segement29",{"className":"$undefined","style":{},"children":["        "]}],["$","span","code-segement30",{"className":"token","style":{"color":"#07a"},"children":["final"]}],["$","span","code-segement31",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement32",{"className":"token","style":{"color":"#DD4A68"},"children":["HttpClient"]}],["$","span","code-segement33",{"className":"$undefined","style":{},"children":[" httpClient "]}],["$","span","code-segement34",{"className":"token","style":{"color":"#9a6e3a","background":"hsla(0, 0%, 100%, .5)"},"children":["="]}],["$","span","code-segement35",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement36",{"className":"token","style":{"color":"#DD4A68"},"children":["HttpClient"]}],["$","span","code-segement37",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement38",{"className":"token","style":{"color":"#DD4A68"},"children":["newBuilder"]}],["$","span","code-segement39",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement40",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement41",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement42",{"className":"$undefined","style":{},"children":["            "]}],["$","span","code-segement43",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement44",{"className":"token","style":{"color":"#DD4A68"},"children":["version"]}],["$","span","code-segement45",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement46",{"className":"token","style":{"color":"#DD4A68"},"children":["Version"]}],["$","span","code-segement47",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement48",{"className":"$undefined","style":{},"children":["HTTP_1_1"]}],["$","span","code-segement49",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement50",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement51",{"className":"$undefined","style":{},"children":["            "]}],["$","span","code-segement52",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement53",{"className":"token","style":{"color":"#DD4A68"},"children":["connectTimeout"]}],["$","span","code-segement54",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement55",{"className":"token","style":{"color":"#DD4A68"},"children":["Duration"]}],["$","span","code-segement56",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement57",{"className":"token","style":{"color":"#DD4A68"},"children":["ofSeconds"]}],["$","span","code-segement58",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement59",{"className":"token","style":{"color":"#905"},"children":["10"]}],["$","span","code-segement60",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement61",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement62",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement63",{"className":"$undefined","style":{},"children":["            "]}],["$","span","code-segement64",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement65",{"className":"token","style":{"color":"#DD4A68"},"children":["build"]}],["$","span","code-segement66",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement67",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement68",{"className":"token","style":{"color":"#999"},"children":[";"]}],["$","span","code-segement69",{"className":"$undefined","style":{},"children":["\r\n"]}],"\r\n",["$","span","code-segement71",{"className":"$undefined","style":{},"children":["        "]}],["$","span","code-segement72",{"className":"token","style":{"color":"#07a"},"children":["final"]}],["$","span","code-segement73",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement74",{"className":"token","style":{"color":"#DD4A68"},"children":["WebClient"]}],["$","span","code-segement75",{"className":"$undefined","style":{},"children":[" client "]}],["$","span","code-segement76",{"className":"token","style":{"color":"#9a6e3a","background":"hsla(0, 0%, 100%, .5)"},"children":["="]}],["$","span","code-segement77",{"className":"$undefined","style":{},"children":[" builder\r\n"]}],["$","span","code-segement78",{"className":"$undefined","style":{},"children":["                "]}],["$","span","code-segement79",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement80",{"className":"token","style":{"color":"#DD4A68"},"children":["clientConnector"]}],["$","span","code-segement81",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement82",{"className":"token","style":{"color":"#07a"},"children":["new"]}],["$","span","code-segement83",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement84",{"className":"token","style":{"color":"#DD4A68"},"children":["JdkClientHttpConnector"]}],["$","span","code-segement85",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement86",{"className":"$undefined","style":{},"children":["httpClient"]}],["$","span","code-segement87",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement88",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement89",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement90",{"className":"$undefined","style":{},"children":["                "]}],["$","span","code-segement91",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement92",{"className":"token","style":{"color":"#DD4A68"},"children":["defaultHeader"]}],["$","span","code-segement93",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement94",{"className":"token","style":{"color":"#DD4A68"},"children":["HttpHeaders"]}],["$","span","code-segement95",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement96",{"className":"$undefined","style":{},"children":["CONTENT_TYPE"]}],["$","span","code-segement97",{"className":"token","style":{"color":"#999"},"children":[","]}],["$","span","code-segement98",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement99",{"className":"token","style":{"color":"#DD4A68"},"children":["MediaType"]}],["$","span","code-segement100",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement101",{"className":"$undefined","style":{},"children":["APPLICATION_JSON_VALUE"]}],["$","span","code-segement102",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement103",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement104",{"className":"$undefined","style":{},"children":["                "]}],["$","span","code-segement105",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement106",{"className":"token","style":{"color":"#DD4A68"},"children":["defaultHeader"]}],["$","span","code-segement107",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement108",{"className":"token","style":{"color":"#690"},"children":["\"header1\""]}],["$","span","code-segement109",{"className":"token","style":{"color":"#999"},"children":[","]}],["$","span","code-segement110",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement111",{"className":"token","style":{"color":"#690"},"children":["\"header1-value\""]}],["$","span","code-segement112",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement113",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement114",{"className":"$undefined","style":{},"children":["                "]}],["$","span","code-segement115",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement116",{"className":"token","style":{"color":"#DD4A68"},"children":["defaultHeader"]}],["$","span","code-segement117",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement118",{"className":"token","style":{"color":"#690"},"children":["\"header2\""]}],["$","span","code-segement119",{"className":"token","style":{"color":"#999"},"children":[","]}],["$","span","code-segement120",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement121",{"className":"token","style":{"color":"#690"},"children":["\"header2-value\""]}],["$","span","code-segement122",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement123",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement124",{"className":"$undefined","style":{},"children":["                "]}],["$","span","code-segement125",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement126",{"className":"token","style":{"color":"#DD4A68"},"children":["build"]}],["$","span","code-segement127",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement128",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement129",{"className":"token","style":{"color":"#999"},"children":[";"]}],["$","span","code-segement130",{"className":"$undefined","style":{},"children":["\r\n"]}],"\r\n",["$","span","code-segement132",{"className":"$undefined","style":{},"children":["        "]}],["$","span","code-segement133",{"className":"token","style":{"color":"#07a"},"children":["return"]}],["$","span","code-segement134",{"className":"$undefined","style":{},"children":[" client"]}],["$","span","code-segement135",{"className":"token","style":{"color":"#999"},"children":[";"]}],["$","span","code-segement136",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement137",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segement138",{"className":"token","style":{"color":"#999"},"children":["}"]}],["$","span","code-segement139",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement140",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement141",{"className":"token","style":{"color":"#999"},"children":["}"]}]]]}]}]}],"\n",["$","hr",null,{}],"\n",["$","h3",null,{"style":{"fontWeight":"bold"},"children":["3.2.3 Spring 6.1 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"RestClient"}]]}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":["如果要令到 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"RestClient"}]," 識得喺 request header 度 forward micrometer tracing 既 data 去 downstream microservice 度，就要用 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"RestClient.Builder"}]," bean 去創建 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"RestClient"}],"："]}],"\n",["$","pre",null,{"children":["$","div",null,{"className":"mdx-components_code__3gNm1","style":{"color":"black","background":"#f5f2f0","textShadow":"0 1px white","fontFamily":"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace","fontSize":"1em","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","wordWrap":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","padding":"1em","margin":".5em 0","overflow":"auto"},"children":["$","code",null,{"className":"language-java","style":{"whiteSpace":"pre","color":"black","background":"none","textShadow":"0 1px white","fontFamily":"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace","fontSize":"1em","textAlign":"left","wordSpacing":"normal","wordBreak":"normal","wordWrap":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","code-segement0",{"className":"token annotation","style":{"color":"#999"},"children":["@Configuration"]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement2",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement3",{"className":"token","style":{"color":"#07a"},"children":["public"]}],["$","span","code-segement4",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement5",{"className":"token","style":{"color":"#07a"},"children":["class"]}],["$","span","code-segement6",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement7",{"className":"token","style":{"color":"#DD4A68"},"children":["RestClientConfig"]}],["$","span","code-segement8",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement9",{"className":"token","style":{"color":"#999"},"children":["{"]}],["$","span","code-segement10",{"className":"$undefined","style":{},"children":["\r\n"]}],"\r\n",["$","span","code-segement12",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segement13",{"className":"token annotation","style":{"color":"#999"},"children":["@Bean"]}],["$","span","code-segement14",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement15",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segement16",{"className":"token","style":{"color":"#DD4A68"},"children":["RestClient"]}],["$","span","code-segement17",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement18",{"className":"token","style":{"color":"#DD4A68"},"children":["restClient"]}],["$","span","code-segement19",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement20",{"className":"token","style":{"color":"#DD4A68"},"children":["RestClient"]}],["$","span","code-segement21",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement22",{"className":"token","style":{"color":"#DD4A68"},"children":["Builder"]}],["$","span","code-segement23",{"className":"$undefined","style":{},"children":[" builder"]}],["$","span","code-segement24",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement25",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement26",{"className":"token","style":{"color":"#999"},"children":["{"]}],["$","span","code-segement27",{"className":"$undefined","style":{},"children":["\r\n"]}],"\r\n",["$","span","code-segement29",{"className":"$undefined","style":{},"children":["        "]}],["$","span","code-segement30",{"className":"token","style":{"color":"#07a"},"children":["final"]}],["$","span","code-segement31",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement32",{"className":"token","style":{"color":"#DD4A68"},"children":["RestClient"]}],["$","span","code-segement33",{"className":"$undefined","style":{},"children":[" client "]}],["$","span","code-segement34",{"className":"token","style":{"color":"#9a6e3a","background":"hsla(0, 0%, 100%, .5)"},"children":["="]}],["$","span","code-segement35",{"className":"$undefined","style":{},"children":[" builder\r\n"]}],["$","span","code-segement36",{"className":"$undefined","style":{},"children":["                "]}],["$","span","code-segement37",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement38",{"className":"token","style":{"color":"#DD4A68"},"children":["defaultHeader"]}],["$","span","code-segement39",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement40",{"className":"token","style":{"color":"#DD4A68"},"children":["HttpHeaders"]}],["$","span","code-segement41",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement42",{"className":"$undefined","style":{},"children":["CONTENT_TYPE"]}],["$","span","code-segement43",{"className":"token","style":{"color":"#999"},"children":[","]}],["$","span","code-segement44",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement45",{"className":"token","style":{"color":"#DD4A68"},"children":["MediaType"]}],["$","span","code-segement46",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement47",{"className":"$undefined","style":{},"children":["APPLICATION_JSON_VALUE"]}],["$","span","code-segement48",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement49",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement50",{"className":"$undefined","style":{},"children":["                "]}],["$","span","code-segement51",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement52",{"className":"token","style":{"color":"#DD4A68"},"children":["defaultHeader"]}],["$","span","code-segement53",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement54",{"className":"token","style":{"color":"#690"},"children":["\"header1\""]}],["$","span","code-segement55",{"className":"token","style":{"color":"#999"},"children":[","]}],["$","span","code-segement56",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement57",{"className":"token","style":{"color":"#690"},"children":["\"header1-value\""]}],["$","span","code-segement58",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement59",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement60",{"className":"$undefined","style":{},"children":["                "]}],["$","span","code-segement61",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement62",{"className":"token","style":{"color":"#DD4A68"},"children":["defaultHeader"]}],["$","span","code-segement63",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement64",{"className":"token","style":{"color":"#690"},"children":["\"header2\""]}],["$","span","code-segement65",{"className":"token","style":{"color":"#999"},"children":[","]}],["$","span","code-segement66",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segement67",{"className":"token","style":{"color":"#690"},"children":["\"header2-value\""]}],["$","span","code-segement68",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement69",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement70",{"className":"$undefined","style":{},"children":["                "]}],["$","span","code-segement71",{"className":"token","style":{"color":"#999"},"children":["."]}],["$","span","code-segement72",{"className":"token","style":{"color":"#DD4A68"},"children":["build"]}],["$","span","code-segement73",{"className":"token","style":{"color":"#999"},"children":["("]}],["$","span","code-segement74",{"className":"token","style":{"color":"#999"},"children":[")"]}],["$","span","code-segement75",{"className":"token","style":{"color":"#999"},"children":[";"]}],["$","span","code-segement76",{"className":"$undefined","style":{},"children":["\r\n"]}],"\r\n",["$","span","code-segement78",{"className":"$undefined","style":{},"children":["        "]}],["$","span","code-segement79",{"className":"token","style":{"color":"#07a"},"children":["return"]}],["$","span","code-segement80",{"className":"$undefined","style":{},"children":[" client"]}],["$","span","code-segement81",{"className":"token","style":{"color":"#999"},"children":[";"]}],["$","span","code-segement82",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement83",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segement84",{"className":"token","style":{"color":"#999"},"children":["}"]}],["$","span","code-segement85",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement86",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement87",{"className":"token","style":{"color":"#999"},"children":["}"]}]]]}]}]}],"\n",["$","hr",null,{}],"\n",["$","h3",null,{"style":{"fontWeight":"bold"},"children":"3.2.4 Spring Cloud OpenFeign"}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":["如果要令到 OpenFeign 識得喺 request header 度 forward micrometer tracing 既 data 去目標既 microservice 度，只需要喺 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"pom.xml"}]," 加入 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"io.github.openfeign:feign-micrometer"}]," 既 Maven dependency。"]}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":"呢個 dependency 既版本由以下既 dependency management BOMs 控制。"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"org.springframework.cloud:spring-cloud-dependencies"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"org.springframework.cloud:spring-cloud-openfeign-dependencies"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"io.github.openfeign:feign-bom"}]}],"\n"]}],"\n"]}],"\n"]}],"\n"]}],"\n"]}],"\n",["$","hr",null,{}],"\n",["$","h2",null,{"style":{"fontWeight":"bold"},"children":"3.3 Logback 配置"}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":["最後一步，我地需要喺 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"logback.xml"}]," 裡面加入 trace ID 以及 span ID 既 MDC fields，咁喺 application logs 度就可以睇到佢地。"]}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":["因為係 distributed microservices 既關係，我地如果用好似 ELK 咁既 centralized logging platform 既話，一定要可以分得到唔同既 microservices 既 logs，咁就要喺 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"logback.xml"}]," 既 encoders 度配置好："]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["Host name，可以直接用 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"$${HOSTNAME:-}"}]," 或者 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"$${hostname:-}"}],"。"]}],"\n",["$","li",null,{"children":["Spring application name，可以加入以下既配置，之後就可以用 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"$${app_name:-}"}],"：","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["\n",["$","pre",null,{"children":["$","div",null,{"className":"mdx-components_code__3gNm1","style":{"color":"black","background":"#f5f2f0","textShadow":"0 1px white","fontFamily":"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace","fontSize":"1em","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","wordWrap":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","padding":"1em","margin":".5em 0","overflow":"auto"},"children":["$","code",null,{"className":"language-xml","style":{"whiteSpace":"pre","color":"black","background":"none","textShadow":"0 1px white","fontFamily":"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace","fontSize":"1em","textAlign":"left","wordSpacing":"normal","wordBreak":"normal","wordWrap":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","code-segement0",{"className":"token","style":{"color":"slategray"},"children":["<!-- 喺 configuration 裡面 -->"]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement2",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement3",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement4",{"className":"token","style":{"color":"#905"},"children":["springProperty"]}],["$","span","code-segement5",{"className":"token","style":{"color":"#905"},"children":[" "]}],["$","span","code-segement6",{"className":"token","style":{"color":"#690"},"children":["scope"]}],["$","span","code-segement7",{"className":"token attr-equals","style":{"color":"#999"},"children":["="]}],["$","span","code-segement8",{"className":"token","style":{"color":"#999"},"children":["\""]}],["$","span","code-segement9",{"className":"token","style":{"color":"#07a"},"children":["context"]}],["$","span","code-segement10",{"className":"token","style":{"color":"#999"},"children":["\""]}],["$","span","code-segement11",{"className":"token","style":{"color":"#905"},"children":[" "]}],["$","span","code-segement12",{"className":"token","style":{"color":"#690"},"children":["name"]}],["$","span","code-segement13",{"className":"token attr-equals","style":{"color":"#999"},"children":["="]}],["$","span","code-segement14",{"className":"token","style":{"color":"#999"},"children":["\""]}],["$","span","code-segement15",{"className":"token","style":{"color":"#07a"},"children":["app_name"]}],["$","span","code-segement16",{"className":"token","style":{"color":"#999"},"children":["\""]}],["$","span","code-segement17",{"className":"token","style":{"color":"#905"},"children":[" "]}],["$","span","code-segement18",{"className":"token","style":{"color":"#690"},"children":["source"]}],["$","span","code-segement19",{"className":"token attr-equals","style":{"color":"#999"},"children":["="]}],["$","span","code-segement20",{"className":"token","style":{"color":"#999"},"children":["\""]}],["$","span","code-segement21",{"className":"token","style":{"color":"#07a"},"children":["spring.application.name"]}],["$","span","code-segement22",{"className":"token","style":{"color":"#999"},"children":["\""]}],["$","span","code-segement23",{"className":"token","style":{"color":"#905"},"children":[" "]}],["$","span","code-segement24",{"className":"token","style":{"color":"#999"},"children":["/>"]}]]]}]}]}],"\n"]}],"\n"]}],"\n"]}],"\n"]}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":["詳情可以睇返呢篇：",["$","a",null,{"href":"/blog/spring-boot-elk-logging","children":"Spring 項目使用 ELK 做 logging"}],"。"]}],"\n",["$","h3",null,{"style":{"fontWeight":"bold"},"children":"3.3.1 自定義 encoder pattern"}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":"如果要喺自定義既 encoder pattern 裡面加入 trace ID 以及 span ID，我地可以用："}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"%X{traceId:-}"}]}],"\n",["$","li",null,{"children":["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"%X{spanId:-}"}]}],"\n"]}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":"例子："}],"\n",["$","pre",null,{"children":["$","div",null,{"className":"mdx-components_code__3gNm1","style":{"color":"black","background":"#f5f2f0","textShadow":"0 1px white","fontFamily":"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace","fontSize":"1em","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","wordWrap":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","padding":"1em","margin":".5em 0","overflow":"auto"},"children":["$","code",null,{"className":"language-xml","style":{"whiteSpace":"pre","color":"black","background":"none","textShadow":"0 1px white","fontFamily":"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace","fontSize":"1em","textAlign":"left","wordSpacing":"normal","wordBreak":"normal","wordWrap":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","code-segement0",{"className":"token","style":{"color":"slategray"},"children":["<!-- 喺 appender 裡面 -->"]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement2",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement3",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement4",{"className":"token","style":{"color":"#905"},"children":["encoder"]}],["$","span","code-segement5",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement6",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement7",{"className":"$undefined","style":{},"children":["\t"]}],["$","span","code-segement8",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement9",{"className":"token","style":{"color":"#905"},"children":["pattern"]}],["$","span","code-segement10",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement11",{"className":"$undefined","style":{},"children":["[${hostname:-} ${app_name:-}] [%X{traceId:-} %X{spanId:-}] %d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} (%file:%line\\) - %msg%n"]}],["$","span","code-segement12",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement13",{"className":"token","style":{"color":"#905"},"children":["pattern"]}],["$","span","code-segement14",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement15",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement16",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement17",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement18",{"className":"token","style":{"color":"#905"},"children":["encoder"]}],["$","span","code-segement19",{"className":"token","style":{"color":"#999"},"children":[">"]}]]]}]}]}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":"註："}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["呢度既 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":":-"}]," 係用黎分隔 key、value 既字符，佢既前面係 MDC key，後面係 value。","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["佢同 Spring 既 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":":"}]," 一樣意思，只不過係 Logback 揀左用 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":":-"}],"。"]}],"\n",["$","li",null,{"children":[["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"%X{key:-}"}]," 既意思係如果 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"key"}]," 呢個 MDC key 未有 data 既話就會出 empty string（唔好誤以為會出 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"-"}],"）。"]}],"\n",["$","li",null,{"children":[["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"%X{key:-foo}"}]," 既意思係如果 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"key"}]," 呢個 MDC key 未有 data 既話就會出 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"foo"}],"。"]}],"\n"]}],"\n"]}],"\n"]}],"\n",["$","hr",null,{}],"\n",["$","h3",null,{"style":{"fontWeight":"bold"},"children":"3.3.2 Logstash Logback Encoder"}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":["如果係用 Logstash Logback Encoder，亦即係 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"net.logstash.logback:logstash-logback-encoder"}]," 既 Maven dependency，咁我地就要用佢既 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"includeMdcKeyName"}]," XML element 去加入 trace ID 以及 span ID："]}],"\n",["$","pre",null,{"children":["$","div",null,{"className":"mdx-components_code__3gNm1","style":{"color":"black","background":"#f5f2f0","textShadow":"0 1px white","fontFamily":"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace","fontSize":"1em","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","wordWrap":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","padding":"1em","margin":".5em 0","overflow":"auto"},"children":["$","code",null,{"className":"language-xml","style":{"whiteSpace":"pre","color":"black","background":"none","textShadow":"0 1px white","fontFamily":"Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace","fontSize":"1em","textAlign":"left","wordSpacing":"normal","wordBreak":"normal","wordWrap":"normal","lineHeight":"1.5","MozTabSize":"4","OTabSize":"4","tabSize":"4","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","code-segement0",{"className":"token","style":{"color":"slategray"},"children":["<!-- 喺 appender 裡面 -->"]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement2",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement3",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement4",{"className":"token","style":{"color":"#905"},"children":["encoder"]}],["$","span","code-segement5",{"className":"token","style":{"color":"#905"},"children":[" "]}],["$","span","code-segement6",{"className":"token","style":{"color":"#690"},"children":["class"]}],["$","span","code-segement7",{"className":"token attr-equals","style":{"color":"#999"},"children":["="]}],["$","span","code-segement8",{"className":"token","style":{"color":"#999"},"children":["\""]}],["$","span","code-segement9",{"className":"token","style":{"color":"#07a"},"children":["net.logstash.logback.encoder.LogstashEncoder"]}],["$","span","code-segement10",{"className":"token","style":{"color":"#999"},"children":["\""]}],["$","span","code-segement11",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement12",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement13",{"className":"$undefined","style":{},"children":["\t"]}],["$","span","code-segement14",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement15",{"className":"token","style":{"color":"#905"},"children":["includeContext"]}],["$","span","code-segement16",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement17",{"className":"$undefined","style":{},"children":["false"]}],["$","span","code-segement18",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement19",{"className":"token","style":{"color":"#905"},"children":["includeContext"]}],["$","span","code-segement20",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement21",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement22",{"className":"$undefined","style":{},"children":["\t"]}],["$","span","code-segement23",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement24",{"className":"token","style":{"color":"#905"},"children":["includeMdcKeyName"]}],["$","span","code-segement25",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement26",{"className":"$undefined","style":{},"children":["traceId"]}],["$","span","code-segement27",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement28",{"className":"token","style":{"color":"#905"},"children":["includeMdcKeyName"]}],["$","span","code-segement29",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement30",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement31",{"className":"$undefined","style":{},"children":["\t"]}],["$","span","code-segement32",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement33",{"className":"token","style":{"color":"#905"},"children":["includeMdcKeyName"]}],["$","span","code-segement34",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement35",{"className":"$undefined","style":{},"children":["spanId"]}],["$","span","code-segement36",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement37",{"className":"token","style":{"color":"#905"},"children":["includeMdcKeyName"]}],["$","span","code-segement38",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement39",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement40",{"className":"$undefined","style":{},"children":["\t"]}],["$","span","code-segement41",{"className":"token","style":{"color":"#999"},"children":["<"]}],["$","span","code-segement42",{"className":"token","style":{"color":"#905"},"children":["customFields"]}],["$","span","code-segement43",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement44",{"className":"$undefined","style":{},"children":["{ \"host\": \"${hostname:-}\", \"app_name\": \"${app_name:-}\" }"]}],["$","span","code-segement45",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement46",{"className":"token","style":{"color":"#905"},"children":["customFields"]}],["$","span","code-segement47",{"className":"token","style":{"color":"#999"},"children":[">"]}],["$","span","code-segement48",{"className":"$undefined","style":{},"children":["\r\n"]}],["$","span","code-segement49",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segement50",{"className":"token","style":{"color":"#999"},"children":["</"]}],["$","span","code-segement51",{"className":"token","style":{"color":"#905"},"children":["encoder"]}],["$","span","code-segement52",{"className":"token","style":{"color":"#999"},"children":[">"]}]]]}]}]}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":["加左之後，每一個 log entry 既 JSON data 裡面都會多左 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"traceId"}]," 以及 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"spanId"}]," 既 key-value pairs。"]}],"\n",["$","hr",null,{}],"\n",["$","h1",null,{"style":{"fontWeight":"bold"},"children":"4 測試"}],"\n",["$","h2",null,{"style":{"fontWeight":"bold"},"children":"4.1 本地測試"}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":"我地需要 set up 至少兩個 Spring Boot microservices。"}],"\n",["$","li",null,{"children":"全部 microservices 都要 expose 至少一個 HTTP REST endpoints。"}],"\n",["$","li",null,{"children":["除左最後一個只會被 call 但唔會 initiate call 既 microservice，我地要為所有作為 upstream 既其他 microservices 寫 HTTP call 既 code。","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"HTTP REST call flow：Service A ➜ Service B ➜ Service C 等等。"}],"\n",["$","li",null,{"children":["HTTP REST call 既 implementation 可以係 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"RestTemplate"}],"、",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"WebClient"}],"、",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"RestClient"}]," 或者 OpenFeign。"]}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":"用 cURL call Service A 既 HTTP REST endpoint。"}],"\n",["$","li",null,{"children":["檢查所有 microservices 既 console logs。","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["應該會見到只有一個 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"32"}]," 個位長度 alphanumeric 既 trace ID。"]}],"\n",["$","li",null,{"children":["應該會見到每個 microservice 都有啲唔同既 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"16"}]," 個位長度 alphanumeric 既 span IDs。"]}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":"再用 cURL call Service A 既 HTTP REST endpoint。"}],"\n",["$","li",null,{"children":["再檢查所有 microservices 既 console logs。","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"應該會見到一個完全唔同既 trace ID。"}],"\n",["$","li",null,{"children":"應該會見到每個 microservice 又有啲唔同既 span IDs。"}],"\n"]}],"\n"]}],"\n"]}],"\n",["$","hr",null,{}],"\n",["$","h2",null,{"style":{"fontWeight":"bold"},"children":"4.2 測試發送 logs 去 ELK"}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":"我地需要 set up 至少兩個 Spring Boot microservices。"}],"\n",["$","li",null,{"children":["我地要配置好全部 microservices 既 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"logback.xml"}],"，將 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"<appender>"}]," 既 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"<destination>"}]," 配置為 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"127.0.0.1:5000"}],"，咁啲 logs 就會發送到本地部署既 Logstash。"]}],"\n",["$","li",null,{"children":"全部 microservices 都要 expose 至少一個 HTTP REST endpoints。"}],"\n",["$","li",null,{"children":["除左最後一個只會被 call 但唔會 initiate call 既 microservice，我地要為所有作為 upstream 既其他 microservices 寫 HTTP call 既 code。","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"HTTP REST call flow：Service A ➜ Service B ➜ Service C 等等。"}],"\n",["$","li",null,{"children":["HTTP REST call 既 implementation 可以係 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"RestTemplate"}],"、",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"WebClient"}],"、",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"RestClient"}]," 或者 OpenFeign。"]}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":"用 cURL call Service A 既 HTTP REST endpoint。"}],"\n",["$","li",null,{"children":["打開 ",["$","a",null,{"href":"http://localhost:5601","children":"http://localhost:5601"}]," 檢查我地喺 Kibana 既 data view。","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["應該會見到只有一個 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"32"}]," 個位長度 alphanumeric 既 trace ID。"]}],"\n",["$","li",null,{"children":["應該會見到每個 microservice 都有啲唔同既 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"16"}]," 個位長度 alphanumeric 既 span IDs。"]}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":"再用 cURL call Service A 既 HTTP REST endpoint。"}],"\n",["$","li",null,{"children":["再打開 ",["$","a",null,{"href":"http://localhost:5601","children":"http://localhost:5601"}]," 檢查我地喺 Kibana 既 data view。","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"應該會見到一個完全唔同既 trace ID。"}],"\n",["$","li",null,{"children":"應該會見到每個 microservice 又有啲唔同既 span IDs。"}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":["我地可以撳落 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"traceId"}]," column 既某一個 cell value 隔籬既 ",["$","code",null,{"className":"undefined mdx-components_normal-code__lOvs9","children":"⊕"}]," 號（「Filter for this traceId」），咁就可以睇曬所有同呢個 trace ID 有關係既 logs。"]}],"\n"]}],"\n",["$","p",null,{"className":"mdx-components_paragraph__AUxxF","children":["$","img",null,{"src":"/e2-next/blog/2024-03/spring-boot-micrometer-tracing/kibana-search-logs-with-traceId.png","className":"mdx-components_image__4jSiz"}]}],"\n",["$","hr",null,{}],"\n",["$","h1",null,{"style":{"fontWeight":"bold"},"children":"5 參考資料"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["$","a",null,{"href":"https://spring.io/blog/2022/10/12/observability-with-spring-boot-3","children":"Spring 官方 blog - Observability with Spring Boot 3"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"https://docs.spring.io/spring-framework/reference/integration/observability.html","children":"Spring 官方文檔 - Observability Support"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"https://github.com/logfellow/logstash-logback-encoder?tab=readme-ov-file#mdc-fields","children":"GitHub - logfellow/logstash-logback-encoder - Logstash Logback Encoder - MDC fields"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"https://opentelemetry.io/docs/concepts/signals/traces/","children":"OpenTelemetry - Traces"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"https://github.com/w3c/trace-context/blob/main/spec/20-http_request_header_format.md","children":"GitHub - w3c/trace-context - Trace Context HTTP Request Headers Format"}]}],"\n"]}]],[["$","link","0",{"rel":"stylesheet","href":"/e2-next/_next/static/css/952e59b04e0cf1ba.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","$Lf",null,{"children":"$L10"}]]}],{},null,false]},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","nl2jTSlRvkQA4mHFGkIIk",{"children":[["$","$L11",null,{"children":"$L12"}],["$","$L13",null,{"children":"$L14"}],null]}]]}],false]],"m":"$undefined","G":["$15","$undefined"],"s":false,"S":true}
14:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
12:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Michael Chung's e-Portfolio"}],["$","meta","2",{"name":"description","content":"Powered by Next.js and React"}]]
10:null
